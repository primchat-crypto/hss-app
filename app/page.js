"use client";
import{useState,useEffect,useRef,useCallback}from"react";
import{createClient}from"@supabase/supabase-js";

const SB_URL=process.env.NEXT_PUBLIC_SUPABASE_URL;
const SB_KEY=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const sb=(SB_URL&&SB_KEY)?createClient(SB_URL,SB_KEY):null;

const BRAND="Human System Studio";
const PLANS={free:{name:"Free",price:0,tag:"ğŸŸ¢",c:"#10B981",f:["identity","core5"]},deep:{name:"Deep Insight",price:99,tag:"ğŸŸ¡",c:"#F59E0B",badge:"à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡",f:["identity","core5","12d","shadow","weekly","energy"]},all:{name:"All Access",price:249,tag:"ğŸ”µ",c:"#3B82F6",badge:"à¸„à¸¸à¹‰à¸¡à¸—à¸µà¹ˆà¸ªà¸¸à¸”",f:["identity","core5","12d","shadow","weekly","energy","job","dasha","pdf","share"]}};
const FT=[["Identity Snapshot (AI)","identity",1,1,1],["5 Core Scores + AI à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ","core5",1,1,1],["à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡ / à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸² 12 à¸¡à¸´à¸•à¸´","12d",0,1,1],["Shadow Analysis à¹€à¸Šà¸´à¸‡à¸¥à¸¶à¸","shadow",0,1,1],["Do & Don't à¸£à¸²à¸¢à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ","weekly",0,1,1],["7-Day Energy Forecast","energy",0,1,1],["Job Matching AI","job",0,0,1],["Life Phase Map (Dasha)","dasha",0,0,1],["PDF Report à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”","pdf",0,0,1],["Shareable Profile Link","share",0,0,1]];

const QG={A:{t:"The Foundation",dims:{"Cognitive Processing":{icon:"ğŸ§ ",c:"#6366F1",pl:"à¸à¸¸à¸˜",q:["à¸à¹ˆà¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸‡à¸²à¸™ à¸‰à¸±à¸™à¸§à¸²à¸‡à¹à¸œà¸™à¸„à¸£à¹ˆà¸²à¸§à¹† à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸„à¸£à¸±à¹‰à¸‡","à¹€à¸¡à¸·à¹ˆà¸­à¸­à¸˜à¸´à¸šà¸²à¸¢à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸¢à¸²à¸ à¸‰à¸±à¸™à¸ªà¸£à¸¸à¸›à¹ƒà¸«à¹‰à¹€à¸«à¸¥à¸·à¸­à¸›à¸£à¸°à¹€à¸”à¹‡à¸™à¸«à¸¥à¸±à¸à¹„à¸”à¹‰","à¸à¹ˆà¸­à¸™à¸ªà¹ˆà¸‡à¸‡à¸²à¸™ à¸‰à¸±à¸™à¸•à¸£à¸§à¸ˆà¸—à¸²à¸™à¸ˆà¸¸à¸”à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¸ªà¸³à¸„à¸±à¸à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡"]},"Emotional Regulation":{icon:"ğŸŒŠ",c:"#0EA5E9",pl:"à¸ˆà¸±à¸™à¸—à¸£à¹Œ",q:["à¹€à¸¡à¸·à¹ˆà¸­à¸­à¸²à¸£à¸¡à¸“à¹Œà¹à¸£à¸‡ à¸‰à¸±à¸™à¸«à¸¢à¸¸à¸”à¸à¸±à¸à¸à¹ˆà¸­à¸™à¸•à¸­à¸šà¸«à¸£à¸·à¸­à¸à¹ˆà¸­à¸™à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ","à¹ƒà¸™à¸§à¸±à¸™à¸—à¸µà¹ˆà¸­à¸²à¸£à¸¡à¸“à¹Œà¹„à¸¡à¹ˆà¸”à¸µ à¸‰à¸±à¸™à¸¢à¸±à¸‡à¸—à¸³à¸‡à¸²à¸™à¸ˆà¸³à¹€à¸›à¹‡à¸™à¹ƒà¸«à¹‰à¹€à¸”à¸´à¸™à¸«à¸™à¹‰à¸²à¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸­à¸¢à¹ˆà¸²à¸‡","à¸«à¸¥à¸±à¸‡à¹€à¸ˆà¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸à¸£à¸°à¸—à¸šà¹ƒà¸ˆ à¸‰à¸±à¸™à¸à¸¥à¸±à¸šà¸¡à¸²à¹ƒà¸Šà¹‰à¸Šà¸µà¸§à¸´à¸•à¸›à¸à¸•à¸´à¹„à¸”à¹‰à¸ à¸²à¸¢à¹ƒà¸™ 1â€“2 à¸§à¸±à¸™"]},"Identity Stability":{icon:"âš“",c:"#EC4899",pl:"à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ+à¹€à¸ªà¸²à¸£à¹Œ",q:["à¸‰à¸±à¸™à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¸•à¸²à¸¡à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡ à¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¸—à¸³à¸•à¸²à¸¡à¹à¸£à¸‡à¸à¸”à¸”à¸±à¸™à¸ˆà¸²à¸à¸„à¸™à¸­à¸·à¹ˆà¸™","à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸„à¸™à¸•à¸´ à¸‰à¸±à¸™à¹‚à¸Ÿà¸à¸±à¸ªà¸—à¸µà¹ˆà¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚ à¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¸„à¸´à¸”à¸§à¹ˆà¸²à¸•à¸±à¸§à¹€à¸­à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¹ˆà¸²","à¸‰à¸±à¸™à¹‚à¸Ÿà¸à¸±à¸ªà¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢à¸«à¸¥à¸±à¸à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸™à¸¶à¹ˆà¸‡à¹„à¸”à¹‰à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 2 à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ"]}}},B:{t:"The Execution",dims:{"Energy Management":{icon:"âš¡",c:"#F59E0B",pl:"à¸­à¸±à¸‡à¸„à¸²à¸£",q:["à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸‡à¸²à¸™à¸ªà¸³à¸„à¸±à¸ à¸‰à¸±à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸¥à¸‡à¸¡à¸·à¸­à¸ à¸²à¸¢à¹ƒà¸™ 24 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡","à¸‰à¸±à¸™à¸—à¸³à¸‡à¸²à¸™à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡à¸•à¸²à¸¡à¹à¸œà¸™à¹„à¸”à¹‰ à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸«à¸¥à¸¸à¸”à¹‚à¸Ÿà¸à¸±à¸ªà¸šà¹ˆà¸­à¸¢","à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸£à¸´à¹ˆà¸¡à¸¥à¹‰à¸² à¸‰à¸±à¸™à¹€à¸¥à¸·à¸­à¸à¸à¸±à¸à¹€à¸à¸·à¹ˆà¸­à¸Ÿà¸·à¹‰à¸™à¸à¸¥à¸±à¸‡ à¹à¸—à¸™à¸à¸·à¸™à¸—à¸³à¸•à¹ˆà¸­"]},"Decision System":{icon:"âš–ï¸",c:"#3B82F6",pl:"à¸à¸¤à¸«à¸±à¸ª+à¹€à¸ªà¸²à¸£à¹Œ",q:["à¸à¹ˆà¸­à¸™à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¹€à¸£à¸·à¹ˆà¸­à¸‡à¸ªà¸³à¸„à¸±à¸ à¸‰à¸±à¸™à¸«à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 2 à¸¡à¸¸à¸¡à¸¡à¸­à¸‡","à¹€à¸¡à¸·à¹ˆà¸­à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¹à¸¥à¹‰à¸§ à¸‰à¸±à¸™à¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸¢à¹‰à¸­à¸™à¸¥à¸±à¸‡à¹€à¸¥à¸‹à¹‰à¸³","à¸‰à¸±à¸™à¸„à¸´à¸”à¸–à¸¶à¸‡à¸œà¸¥à¸£à¸°à¸¢à¸°à¸¢à¸²à¸§ à¸à¹ˆà¸­à¸™à¹€à¸¥à¸·à¸­à¸à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸¡à¸µà¸•à¹‰à¸™à¸—à¸¸à¸™à¸ªà¸¹à¸‡"]},"Responsibility Load":{icon:"ğŸ‹ï¸",c:"#8B5CF6",pl:"à¹€à¸ªà¸²à¸£à¹Œ",q:["à¸‰à¸±à¸™à¸—à¸³à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¸à¹ˆà¸­à¸™ à¹à¸¡à¹‰à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸‡à¸²à¸™à¸—à¸µà¹ˆà¸­à¸¢à¸²à¸à¸—à¸³","à¸–à¹‰à¸²à¸£à¸¹à¹‰à¸§à¹ˆà¸²à¸ˆà¸°à¹„à¸¡à¹ˆà¸—à¸±à¸™ à¸‰à¸±à¸™à¹à¸ˆà¹‰à¸‡à¸¥à¹ˆà¸§à¸‡à¸«à¸™à¹‰à¸²à¹à¸¥à¸°à¹€à¸ªà¸™à¸­à¸—à¸²à¸‡à¸­à¸­à¸","à¹à¸¡à¹‰à¹„à¸¡à¹ˆà¸¡à¸µà¸„à¸™à¸•à¸²à¸¡ à¸‰à¸±à¸™à¸¢à¸±à¸‡à¸—à¸³à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸£à¸±à¸šà¸›à¸²à¸à¹„à¸§à¹‰à¹ƒà¸«à¹‰à¹€à¸ªà¸£à¹‡à¸ˆ"]}}},C:{t:"The Interaction",dims:{"Motivation Driver":{icon:"ğŸ”¥",c:"#F97316",pl:"à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ",q:["à¸‰à¸±à¸™à¸£à¸¹à¹‰à¸§à¹ˆà¸²à¸—à¸³à¸ªà¸´à¹ˆà¸‡à¸™à¸µà¹‰à¹„à¸›à¹€à¸à¸·à¹ˆà¸­à¸­à¸°à¹„à¸£ à¹à¸¥à¸°à¸­à¸˜à¸´à¸šà¸²à¸¢à¹€à¸«à¸•à¸¸à¸œà¸¥à¹„à¸”à¹‰à¸Šà¸±à¸”","à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸«à¹‡à¸™à¸•à¹ˆà¸²à¸‡ à¸‰à¸±à¸™à¸à¸¥à¹‰à¸²à¹à¸ªà¸”à¸‡à¸„à¸§à¸²à¸¡à¹€à¸«à¹‡à¸™à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡","à¹€à¸¡à¸·à¹ˆà¸­à¸—à¸³à¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸‰à¸±à¸™à¸¢à¸­à¸¡à¸£à¸±à¸šà¸„à¸§à¸²à¸¡à¸ªà¸²à¸¡à¸²à¸£à¸–à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡"]},"Boundary System":{icon:"ğŸ›¡ï¸",c:"#10B981",pl:"à¹€à¸ªà¸²à¸£à¹Œ+à¸ˆà¸±à¸™à¸—à¸£à¹Œ",q:["à¹€à¸¡à¸·à¹ˆà¸­à¸–à¸¹à¸à¸‚à¸­à¹€à¸à¸´à¸™à¸à¸³à¸¥à¸±à¸‡ à¸‰à¸±à¸™à¸à¸¥à¹‰à¸²à¸›à¸à¸´à¹€à¸ªà¸˜à¸«à¸£à¸·à¸­à¸›à¸£à¸±à¸šà¸‚à¸­à¸šà¹€à¸‚à¸•","à¸‰à¸±à¸™à¸¡à¸µà¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¸à¸±à¸à¸ˆà¸£à¸´à¸‡à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸„à¸£à¸±à¹‰à¸‡à¸•à¹ˆà¸­à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ","à¸«à¸¥à¸±à¸‡à¹€à¸ˆà¸­à¸„à¸™à¸—à¸µà¹ˆà¸—à¸³à¹ƒà¸«à¹‰à¹€à¸„à¸£à¸µà¸¢à¸” à¸‰à¸±à¸™à¸¡à¸µà¸§à¸´à¸˜à¸µà¸£à¸µà¹€à¸‹à¹‡à¸•à¸•à¸±à¸§à¹€à¸­à¸‡"]},"Stress Response":{icon:"ğŸ§Š",c:"#64748B",pl:"à¹€à¸ªà¸²à¸£à¹Œ",q:["à¸ à¸²à¸¢à¹ƒà¸•à¹‰à¸„à¸§à¸²à¸¡à¸à¸”à¸”à¸±à¸™ à¸‰à¸±à¸™à¸¢à¸±à¸‡à¸£à¸±à¸à¸©à¸²à¸„à¸¸à¸“à¸ à¸²à¸à¸‡à¸²à¸™à¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³à¹„à¸”à¹‰","à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸ˆà¸­à¸›à¸±à¸à¸«à¸² à¸‰à¸±à¸™à¹€à¸£à¸´à¹ˆà¸¡à¹à¸à¹‰à¹„à¸‚à¸ à¸²à¸¢à¹ƒà¸™ 24 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡","à¹à¸¡à¹‰à¹„à¸¡à¹ˆà¸­à¸¢à¸²à¸à¸—à¸³ à¸‰à¸±à¸™à¸¢à¸±à¸‡à¸«à¸²à¸§à¸´à¸˜à¸µà¸à¸²à¸•à¸±à¸§à¹€à¸­à¸‡à¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³"]}}},D:{t:"The Evolution & Shadow",dims:{"Shadow Pattern":{icon:"ğŸŒ‘",c:"#1E293B",pl:"à¸£à¸²à¸«à¸¹/à¹€à¸à¸•à¸¸",rev:true,q:["à¸‰à¸±à¸™à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸ªà¸³à¸„à¸±à¸ à¹„à¸›à¸—à¸³à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸ªà¸šà¸²à¸¢à¸à¸§à¹ˆà¸²à¹à¸—à¸™","à¸‰à¸±à¸™à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¹€à¸à¸£à¸²à¸°à¸à¸¥à¸±à¸§à¸«à¸£à¸·à¸­à¸­à¸¢à¸²à¸à¹„à¸”à¹‰ à¹à¸¥à¹‰à¸§à¸¡à¸²à¸™à¸¶à¸à¹€à¸ªà¸µà¸¢à¹ƒà¸ˆà¸—à¸µà¸«à¸¥à¸±à¸‡","à¸‰à¸±à¸™à¸œà¸±à¸”à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸—à¸µà¹ˆà¸„à¸§à¸£à¹€à¸œà¸Šà¸´à¸ à¹à¸¡à¹‰à¸£à¸¹à¹‰à¸§à¹ˆà¸²à¸¡à¸±à¸™à¸à¸£à¸°à¸—à¸šà¸‹à¹‰à¸³"]},"Growth Orientation":{icon:"ğŸŒ±",c:"#10B981",pl:"à¸à¸¤à¸«à¸±à¸ª",q:["à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¸³à¹à¸™à¸°à¸™à¸³ à¸‰à¸±à¸™à¸–à¸²à¸¡à¸•à¹ˆà¸­à¹€à¸à¸·à¹ˆà¸­à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¹ƒà¸«à¹‰à¸Šà¸±à¸”","à¸‰à¸±à¸™à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸¥à¸° 30 à¸™à¸²à¸—à¸µà¸à¸±à¸’à¸™à¸²à¸•à¸±à¸§à¹€à¸­à¸‡","à¸«à¸¥à¸±à¸‡à¸—à¸³à¸à¸¥à¸²à¸” à¸‰à¸±à¸™à¸ªà¸£à¸¸à¸›à¸šà¸—à¹€à¸£à¸µà¸¢à¸™à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸„à¸£à¸±à¹‰à¸‡à¸•à¹ˆà¸­à¹„à¸›"]},"Integration Level":{icon:"ğŸ”®",c:"#A78BFA",pl:"à¸œà¸¥à¸£à¸§à¸¡à¸—à¸¸à¸à¸”à¸²à¸§",q:["à¸‰à¸±à¸™à¸¡à¸µà¸ªà¸´à¹ˆà¸‡à¸ªà¸³à¸„à¸±à¸à¸­à¸±à¸™à¸”à¸±à¸š 1 à¸—à¸µà¹ˆà¹‚à¸Ÿà¸à¸±à¸ªà¸Šà¸±à¸”à¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¸™à¸µà¹‰","à¸•à¸²à¸£à¸²à¸‡à¸Šà¸µà¸§à¸´à¸•à¸‰à¸±à¸™à¸¡à¸µà¸ˆà¸±à¸‡à¸«à¸§à¸°à¸à¸±à¸à¸—à¸µà¹ˆà¸Šà¹ˆà¸§à¸¢à¹„à¸¡à¹ˆà¹ƒà¸«à¹‰à¸¥à¹‰à¸²à¹€à¸£à¸·à¹‰à¸­à¸£à¸±à¸‡","à¸‰à¸±à¸™à¸£à¸¹à¹‰à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡à¹à¸¥à¸°à¸ˆà¸¸à¸”à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸‚à¸­à¸‡à¸•à¸±à¸§à¹€à¸­à¸‡ à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¸§à¸²à¸‡à¹à¸œà¸™à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸™à¸µà¹‰à¸ˆà¸£à¸´à¸‡"]}}}};

const flatQ=()=>{const f=[];Object.entries(QG).forEach(([,g])=>Object.entries(g.dims).forEach(([d,data])=>data.q.forEach((q,i)=>f.push({dim:d,q,icon:data.icon,c:data.c,rev:data.rev||false,qi:i,pl:data.pl}))));return f};
const ALL_Q=flatQ();
const SCALE=["à¹à¸—à¸šà¹„à¸¡à¹ˆà¸ˆà¸£à¸´à¸‡","à¸™à¸²à¸™à¹† à¸„à¸£à¸±à¹‰à¸‡","à¸šà¸²à¸‡à¸„à¸£à¸±à¹‰à¸‡","à¸šà¹ˆà¸­à¸¢","à¸ªà¸¡à¹ˆà¸³à¹€à¸ªà¸¡à¸­à¸¡à¸²à¸"];
const DM={};Object.values(QG).forEach(g=>Object.entries(g.dims).forEach(([k,v])=>{DM[k]=v}));
const DIMS=Object.keys(DM);
const TS=[{id:"dawn",l:"ğŸŒ… à¹€à¸Šà¹‰à¸²à¸¡à¸·à¸” (04:00â€“06:00)",d:"à¸à¸£à¸°à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œà¸à¸³à¸¥à¸±à¸‡à¸ˆà¸°à¸‚à¸¶à¹‰à¸™"},{id:"morning",l:"â˜€ï¸ à¸Šà¹ˆà¸§à¸‡à¸ªà¸²à¸¢ (09:00â€“11:00)",d:"à¸à¸£à¸°à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œà¸­à¸¢à¸¹à¹ˆà¸ªà¸¹à¸‡"},{id:"noon",l:"ğŸŒ à¹€à¸—à¸µà¹ˆà¸¢à¸‡/à¸šà¹ˆà¸²à¸¢à¸•à¹‰à¸™ (12:00â€“14:00)",d:"à¸à¸£à¸°à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œà¹€à¸«à¸™à¸·à¸­à¸¨à¸µà¸£à¸©à¸°"},{id:"evening",l:"ğŸŒ‡ à¹€à¸¢à¹‡à¸™/à¸à¸¥à¸šà¸„à¹ˆà¸³ (17:00â€“19:00)",d:"à¸à¸£à¸°à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œà¸•à¸"},{id:"night",l:"ğŸŒ™ à¸”à¸¶à¸ (22:00â€“24:00)",d:"à¹€à¸—à¸µà¹ˆà¸¢à¸‡à¸„à¸·à¸™"}];

// 77 à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”
const PV=["à¸à¸£à¸¸à¸‡à¹€à¸—à¸à¸¡à¸«à¸²à¸™à¸„à¸£","à¸à¸£à¸°à¸šà¸µà¹ˆ","à¸à¸²à¸à¸ˆà¸™à¸šà¸¸à¸£à¸µ","à¸à¸²à¸¬à¸ªà¸´à¸™à¸˜à¸¸à¹Œ","à¸à¸³à¹à¸à¸‡à¹€à¸à¸Šà¸£","à¸‚à¸­à¸™à¹à¸à¹ˆà¸™","à¸ˆà¸±à¸™à¸—à¸šà¸¸à¸£à¸µ","à¸‰à¸°à¹€à¸Šà¸´à¸‡à¹€à¸—à¸£à¸²","à¸Šà¸¥à¸šà¸¸à¸£à¸µ","à¸Šà¸±à¸¢à¸™à¸²à¸—","à¸Šà¸±à¸¢à¸ à¸¹à¸¡à¸´","à¸Šà¸¸à¸¡à¸à¸£","à¹€à¸Šà¸µà¸¢à¸‡à¸£à¸²à¸¢","à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ","à¸•à¸£à¸±à¸‡","à¸•à¸£à¸²à¸”","à¸•à¸²à¸","à¸™à¸„à¸£à¸™à¸²à¸¢à¸","à¸™à¸„à¸£à¸›à¸à¸¡","à¸™à¸„à¸£à¸à¸™à¸¡","à¸™à¸„à¸£à¸£à¸²à¸Šà¸ªà¸µà¸¡à¸²","à¸™à¸„à¸£à¸¨à¸£à¸µà¸˜à¸£à¸£à¸¡à¸£à¸²à¸Š","à¸™à¸„à¸£à¸ªà¸§à¸£à¸£à¸„à¹Œ","à¸™à¸™à¸—à¸šà¸¸à¸£à¸µ","à¸™à¸£à¸²à¸˜à¸´à¸§à¸²à¸ª","à¸™à¹ˆà¸²à¸™","à¸šà¸¶à¸‡à¸à¸²à¸¬","à¸šà¸¸à¸£à¸µà¸£à¸±à¸¡à¸¢à¹Œ","à¸›à¸—à¸¸à¸¡à¸˜à¸²à¸™à¸µ","à¸›à¸£à¸°à¸ˆà¸§à¸šà¸„à¸µà¸£à¸µà¸‚à¸±à¸™à¸˜à¹Œ","à¸›à¸£à¸²à¸ˆà¸µà¸™à¸šà¸¸à¸£à¸µ","à¸›à¸±à¸•à¸•à¸²à¸™à¸µ","à¸à¸£à¸°à¸™à¸„à¸£à¸¨à¸£à¸µà¸­à¸¢à¸¸à¸˜à¸¢à¸²","à¸à¸°à¹€à¸¢à¸²","à¸à¸±à¸‡à¸‡à¸²","à¸à¸±à¸—à¸¥à¸¸à¸‡","à¸à¸´à¸ˆà¸´à¸•à¸£","à¸à¸´à¸©à¸“à¸¸à¹‚à¸¥à¸","à¹€à¸à¸Šà¸£à¸šà¸¸à¸£à¸µ","à¹€à¸à¸Šà¸£à¸šà¸¹à¸£à¸“à¹Œ","à¹à¸à¸£à¹ˆ","à¸ à¸¹à¹€à¸à¹‡à¸•","à¸¡à¸«à¸²à¸ªà¸²à¸£à¸„à¸²à¸¡","à¸¡à¸¸à¸à¸”à¸²à¸«à¸²à¸£","à¹à¸¡à¹ˆà¸®à¹ˆà¸­à¸‡à¸ªà¸­à¸™","à¸¢à¹‚à¸ªà¸˜à¸£","à¸¢à¸°à¸¥à¸²","à¸£à¹‰à¸­à¸¢à¹€à¸­à¹‡à¸”","à¸£à¸°à¸™à¸­à¸‡","à¸£à¸°à¸¢à¸­à¸‡","à¸£à¸²à¸Šà¸šà¸¸à¸£à¸µ","à¸¥à¸à¸šà¸¸à¸£à¸µ","à¸¥à¸³à¸›à¸²à¸‡","à¸¥à¸³à¸à¸¹à¸™","à¹€à¸¥à¸¢","à¸¨à¸£à¸µà¸ªà¸°à¹€à¸à¸©","à¸ªà¸à¸¥à¸™à¸„à¸£","à¸ªà¸‡à¸‚à¸¥à¸²","à¸ªà¸•à¸¹à¸¥","à¸ªà¸¡à¸¸à¸—à¸£à¸›à¸£à¸²à¸à¸²à¸£","à¸ªà¸¡à¸¸à¸—à¸£à¸ªà¸‡à¸„à¸£à¸²à¸¡","à¸ªà¸¡à¸¸à¸—à¸£à¸ªà¸²à¸„à¸£","à¸ªà¸£à¸°à¹à¸à¹‰à¸§","à¸ªà¸£à¸°à¸šà¸¸à¸£à¸µ","à¸ªà¸´à¸‡à¸«à¹Œà¸šà¸¸à¸£à¸µ","à¸ªà¸¸à¹‚à¸‚à¸—à¸±à¸¢","à¸ªà¸¸à¸à¸£à¸£à¸“à¸šà¸¸à¸£à¸µ","à¸ªà¸¸à¸£à¸²à¸©à¸à¸£à¹Œà¸˜à¸²à¸™à¸µ","à¸ªà¸¸à¸£à¸´à¸™à¸—à¸£à¹Œ","à¸«à¸™à¸­à¸‡à¸„à¸²à¸¢","à¸«à¸™à¸­à¸‡à¸šà¸±à¸§à¸¥à¸³à¸ à¸¹","à¸­à¹ˆà¸²à¸‡à¸—à¸­à¸‡","à¸­à¸³à¸™à¸²à¸ˆà¹€à¸ˆà¸£à¸´à¸","à¸­à¸¸à¸”à¸£à¸˜à¸²à¸™à¸µ","à¸­à¸¸à¸•à¸£à¸”à¸´à¸•à¸–à¹Œ","à¸­à¸¸à¸—à¸±à¸¢à¸˜à¸²à¸™à¸µ","à¸­à¸¸à¸šà¸¥à¸£à¸²à¸Šà¸˜à¸²à¸™à¸µ"];

// Day Lord
const RASHI=["à¹€à¸¡à¸©","à¸à¸¤à¸©à¸ ","à¸¡à¸´à¸–à¸¸à¸™","à¸à¸£à¸à¸","à¸ªà¸´à¸‡à¸«à¹Œ","à¸à¸±à¸™à¸¢à¹Œ","à¸•à¸¸à¸¥à¸¢à¹Œ","à¸à¸´à¸ˆà¸´à¸","à¸˜à¸™à¸¹","à¸¡à¸à¸£","à¸à¸¸à¸¡à¸ à¹Œ","à¸¡à¸µà¸™"];
const NAKSHATRA=["à¸­à¸±à¸¨à¸§à¸´à¸™à¸µ","à¸ à¸£à¸“à¸µ","à¸à¸¤à¸•à¸•à¸´à¸à¸²","à¹‚à¸£à¸«à¸´à¸“à¸µ","à¸¡à¸¤à¸„à¸¨à¸´à¸£à¸²","à¸­à¸²à¸£à¸—à¸£à¸²","à¸›à¸¸à¸™à¸£à¸§à¸ªà¸¸","à¸›à¸¸à¸©à¸¢à¸°","à¸­à¸²à¸¨à¹€à¸¥à¸©à¸²","à¸¡à¸†à¸°","à¸›à¸¸à¸£à¸§à¸œà¸¥à¸„à¸¸à¸™à¸µ","à¸­à¸¸à¸•à¸•à¸£à¸œà¸¥à¸„à¸¸à¸™à¸µ","à¸«à¸±à¸ªà¸•à¸°","à¸ˆà¸´à¸•à¸£à¸²","à¸ªà¸§à¸²à¸•à¸´","à¸§à¸´à¸¨à¸²à¸‚à¸°","à¸­à¸™à¸¸à¸£à¸²à¸˜à¸°","à¹€à¸Šà¸©à¸à¸²","à¸¡à¸¹à¸¥à¸°","à¸›à¸¸à¸£à¸§à¸©à¸²à¸’à¸°","à¸­à¸¸à¸•à¸•à¸£à¸©à¸²à¸’à¸°","à¸¨à¸£à¸§à¸“à¸°","à¸˜à¸™à¸´à¸©à¸à¸²","à¸¨à¸•à¸ à¸´à¸©à¸²","à¸›à¸¸à¸£à¸§à¸ à¸±à¸—à¸£","à¸­à¸¸à¸•à¸•à¸£à¸ à¸±à¸—à¸£","à¹€à¸£à¸§à¸•à¸µ"];
const DAYNAME=["à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ","à¸ˆà¸±à¸™à¸—à¸£à¹Œ","à¸­à¸±à¸‡à¸„à¸²à¸£","à¸à¸¸à¸˜","à¸à¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ","à¸¨à¸¸à¸à¸£à¹Œ","à¹€à¸ªà¸²à¸£à¹Œ"];
const DAY_LORD=[{day:0,lord:"à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ",icon:"â˜€ï¸",planet:"su",gf:"à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ à¹€à¸£à¸´à¹ˆà¸¡à¸ªà¸´à¹ˆà¸‡à¹ƒà¸«à¸¡à¹ˆ"},{day:1,lord:"à¸ˆà¸±à¸™à¸—à¸£à¹Œ",icon:"ğŸŒ™",planet:"mo",gf:"à¸”à¸¹à¹à¸¥à¸•à¸±à¸§à¹€à¸­à¸‡ à¸‡à¸²à¸™à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸£à¸£à¸„à¹Œ"},{day:2,lord:"à¸­à¸±à¸‡à¸„à¸²à¸£",icon:"ğŸ”¥",planet:"ma",gf:"à¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³ à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²"},{day:3,lord:"à¸à¸¸à¸˜",icon:"ğŸ§ ",planet:"me",gf:"à¸›à¸£à¸°à¸Šà¸¸à¸¡ à¹€à¸‚à¸µà¸¢à¸™à¸‡à¸²à¸™ à¹€à¸ˆà¸£à¸ˆà¸²"},{day:4,lord:"à¸à¸¤à¸«à¸±à¸ª",icon:"ğŸ“š",planet:"ju",gf:"à¸§à¸²à¸‡à¹à¸œà¸™à¸£à¸°à¸¢à¸°à¸¢à¸²à¸§ à¸›à¸£à¸¶à¸à¸©à¸²à¸œà¸¹à¹‰à¸£à¸¹à¹‰"},{day:5,lord:"à¸¨à¸¸à¸à¸£à¹Œ",icon:"ğŸ’",planet:"ve",gf:"à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ à¸œà¹ˆà¸­à¸™à¸„à¸¥à¸²à¸¢"},{day:6,lord:"à¹€à¸ªà¸²à¸£à¹Œ",icon:"âš™ï¸",planet:"sa",gf:"à¸—à¸³à¸‡à¸²à¸™à¸„à¹‰à¸²à¸‡ à¸ªà¸£à¹‰à¸²à¸‡à¸§à¸´à¸™à¸±à¸¢"}];

const natalPStr=(bd)=>{const m=parseInt(bd?.split("-")?.[1])||6;const d=parseInt(bd?.split("-")?.[2])||15;const s=(m*31+d)%100;return{su:Math.min(10,(22+((s*7)%18))/4),mo:Math.min(10,(18+((s*3)%22))/4),ma:Math.min(10,(19+((s*11)%21))/4),me:Math.min(10,(20+(s%20))/4),ju:Math.min(10,(21+((s*13)%19))/4),ve:Math.min(10,(20+((s*5)%20))/4),sa:Math.min(10,(17+((s*17)%23))/4)}};
const dlCompat=(dow,ns)=>{const dl=DAY_LORD[dow];const str=ns[dl.planet]||5;let q,mod;if(str>=8){q=dl.lord+"à¸«à¸™à¸¸à¸™à¹€à¸•à¹‡à¸¡à¸—à¸µà¹ˆ";mod=15}else if(str>=6){q=dl.lord+"à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸‡à¸”à¸µ";mod=8}else if(str>=4){q=dl.lord+"à¸›à¸à¸•à¸´";mod=0}else{q=dl.lord+"à¸—à¹‰à¸²à¸—à¸²à¸¢";mod=-10}return{...dl,str,q,mod}};
const moonTr=(date)=>{const ref=new Date("2024-01-01T00:00:00Z");const days=(date-ref)/864e5;return Math.floor(((days/27.3217%1)*12+5)%12)};
const marsTr=(date)=>{const ref=new Date("2024-01-01T00:00:00Z");const days=(date-ref)/864e5;return Math.floor(((days/686.97%1)*12+7)%12)};
const satTr=(date)=>{const ref=new Date("2024-01-01T00:00:00Z");return Math.floor(((date-ref)/864e5/10766*12+10)%12)};
const natalMoon=(bd)=>moonTr(new Date(bd+"T12:00:00Z"));
const getNak=(ri,di)=>NAKSHATRA[(ri*2+(di%3))%27];
const trAspect=(tr,nr)=>{const d=((tr-nr)%12+12)%12;if(d===0)return{r:"à¸£à¹ˆà¸§à¸¡",q:"à¸à¸¥à¸²à¸‡",m:0};if(d===4||d===8)return{r:"à¸•à¸£à¸µà¹‚à¸à¸“",q:"à¸”à¸µà¸¡à¸²à¸",m:15};if(d===3||d===9)return{r:"à¸ˆà¸•à¸¸à¹‚à¸à¸“",q:"à¸à¸”à¸”à¸±à¸™",m:-15};if(d===6)return{r:"à¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡",q:"à¸•à¸¶à¸‡",m:-10};if(d===5)return{r:"à¸•à¸£à¸µà¹‚à¸à¸“à¸£à¸­à¸‡",q:"à¸”à¸µ",m:10};return{r:"à¸›à¸à¸•à¸´",q:"à¸à¸¥à¸²à¸‡",m:0}};
const marsD=(r)=>{if(r===0||r===7)return{d:"à¹€à¸à¸©à¸•à¸£",m:10};if(r===9)return{d:"à¸­à¸¸à¸ˆà¸ˆà¹Œ",m:15};if(r===3)return{d:"à¸™à¸´à¸ˆ",m:-15};return{d:"à¸›à¸à¸•à¸´",m:0}};

const gen7Day=(bd)=>{const nm=natalMoon(bd);const ns=natalPStr(bd);const today=new Date();const days=[];for(let i=0;i<7;i++){const dt=new Date(today);dt.setDate(dt.getDate()+i);const mr=moonTr(dt);const mar=marsTr(dt);const sat=satTr(dt);const ma=trAspect(mr,nm);const md=marsD(mar);const dl=dlCompat(dt.getDay(),ns);const moonE=Math.max(30,Math.min(95,65+ma.m));const marsE=Math.max(30,Math.min(95,65+md.m));const dlE=Math.max(30,Math.min(95,65+dl.mod));const ce=Math.round(moonE*.4+marsE*.25+dlE*.35);days.push({date:`${dt.getDate()}/${dt.getMonth()+1}`,dn:DAYNAME[dt.getDay()],moonR:RASHI[mr],nak:getNak(mr,i),marsR:RASHI[mar],satR:RASHI[sat],ma,md,nmR:RASHI[nm],dl,ce})}return days};

// Vedic Dasha System â€” Life Phase Map
const DASHA_SEQ=[{p:"à¹€à¸à¸•à¸¸",y:7,icon:"ğŸŒ€",theme:"à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²à¸•à¸±à¸§à¹€à¸­à¸‡",desc:"à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²à¹à¸«à¹ˆà¸‡à¸à¸²à¸£à¸—à¸šà¸—à¸§à¸™à¸ à¸²à¸¢à¹ƒà¸™ à¸„à¹‰à¸™à¸«à¸²à¸—à¸´à¸¨à¸—à¸²à¸‡à¸Šà¸µà¸§à¸´à¸•",focus:"à¸ªà¸³à¸£à¸§à¸ˆà¸•à¸±à¸§à¸•à¸™ à¸›à¸¥à¹ˆà¸­à¸¢à¸§à¸²à¸‡à¸ªà¸´à¹ˆà¸‡à¹€à¸à¹ˆà¸²"},{p:"à¸¨à¸¸à¸à¸£à¹Œ",y:20,icon:"ğŸ’",theme:"à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸ªà¸¸à¸‚",desc:"à¸à¸¥à¸±à¸‡à¹„à¸›à¸—à¸²à¸‡à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ à¸¨à¸´à¸¥à¸›à¸° à¸„à¸§à¸²à¸¡à¸‡à¸²à¸¡ à¸„à¸§à¸²à¸¡à¸£à¸±à¸",focus:"à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ à¸¥à¸‡à¸—à¸¸à¸™à¸„à¸§à¸²à¸¡à¸ªà¸¸à¸‚"},{p:"à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ",y:6,icon:"â˜€ï¸",theme:"à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¸•à¸™",desc:"à¸Šà¹ˆà¸§à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¸•à¸™ à¸­à¸³à¸™à¸²à¸ˆ à¸Šà¸·à¹ˆà¸­à¹€à¸ªà¸µà¸¢à¸‡ à¸„à¸§à¸²à¸¡à¸¡à¸±à¹ˆà¸™à¹ƒà¸ˆ",focus:"à¹à¸ªà¸”à¸‡à¸•à¸±à¸§à¸•à¸™ à¹€à¸›à¹‡à¸™à¸œà¸¹à¹‰à¸™à¸³"},{p:"à¸ˆà¸±à¸™à¸—à¸£à¹Œ",y:10,icon:"ğŸŒ™",theme:"à¸­à¸²à¸£à¸¡à¸“à¹Œà¹à¸¥à¸°à¸ˆà¸´à¸•à¹ƒà¸ˆ",desc:"à¸à¸¥à¸±à¸‡à¸”à¹‰à¸²à¸™à¸­à¸²à¸£à¸¡à¸“à¹Œ à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§ à¸à¸²à¸£à¸”à¸¹à¹à¸¥à¹€à¸­à¸²à¹ƒà¸ˆà¹ƒà¸ªà¹ˆ",focus:"à¸”à¸¹à¹à¸¥à¸ˆà¸´à¸•à¹ƒà¸ˆ à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸§à¸²à¸¡à¸¡à¸±à¹ˆà¸™à¸„à¸‡à¸ à¸²à¸¢à¹ƒà¸™"},{p:"à¸­à¸±à¸‡à¸„à¸²à¸£",y:7,icon:"ğŸ”¥",theme:"à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¹à¸¥à¸°à¸à¸²à¸£à¸à¸£à¸°à¸—à¸³",desc:"à¸Šà¹ˆà¸§à¸‡à¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³ à¸à¸¥à¹‰à¸²à¹€à¸ªà¸µà¹ˆà¸¢à¸‡ à¸à¸¥à¸±à¸‡à¸à¸²à¸¢à¸ªà¸¹à¸‡",focus:"à¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³ à¹€à¸œà¸Šà¸´à¸à¸«à¸™à¹‰à¸²à¸„à¸§à¸²à¸¡à¸—à¹‰à¸²à¸—à¸²à¸¢"},{p:"à¸£à¸²à¸«à¸¹",y:18,icon:"ğŸŒ‘",theme:"à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸„à¸£à¸±à¹‰à¸‡à¹ƒà¸«à¸à¹ˆ",desc:"à¸šà¸—à¹€à¸£à¸µà¸¢à¸™à¹ƒà¸«à¸¡à¹ˆà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸„à¸¸à¹‰à¸™à¹€à¸„à¸¢ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸‰à¸±à¸šà¸à¸¥à¸±à¸™",focus:"à¹€à¸›à¸´à¸”à¸£à¸±à¸šà¸ªà¸´à¹ˆà¸‡à¹ƒà¸«à¸¡à¹ˆ à¸­à¸¢à¹ˆà¸²à¸¢à¸¶à¸”à¸•à¸´à¸”à¸‚à¸­à¸‡à¹€à¸”à¸´à¸¡"},{p:"à¸à¸¤à¸«à¸±à¸ª",y:16,icon:"ğŸ“š",theme:"à¸à¸²à¸£à¸‚à¸¢à¸²à¸¢à¸•à¸±à¸§à¹à¸¥à¸°à¸›à¸±à¸à¸à¸²",desc:"à¸Šà¹ˆà¸§à¸‡à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰ à¸‚à¸¢à¸²à¸¢à¸•à¸±à¸§ à¸›à¸±à¸à¸à¸²à¹€à¸›à¸´à¸” à¹‚à¸Šà¸„à¸”à¸µ",focus:"à¸¨à¸¶à¸à¸©à¸² à¸‚à¸¢à¸²à¸¢à¸‚à¸­à¸šà¹€à¸‚à¸• à¸¥à¸‡à¸—à¸¸à¸™à¸£à¸°à¸¢à¸°à¸¢à¸²à¸§"},{p:"à¹€à¸ªà¸²à¸£à¹Œ",y:19,icon:"âš™ï¸",theme:"à¸§à¸´à¸™à¸±à¸¢à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¸£à¸±à¸šà¸œà¸´à¸”à¸Šà¸­à¸š",desc:"à¸šà¸—à¹€à¸£à¸µà¸¢à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸§à¸´à¸™à¸±à¸¢ à¸„à¸§à¸²à¸¡à¸­à¸”à¸—à¸™ à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸™",focus:"à¸ªà¸£à¹‰à¸²à¸‡à¸§à¸´à¸™à¸±à¸¢ à¸—à¸³à¸‡à¸²à¸™à¸«à¸™à¸±à¸ à¸œà¸¥à¸¡à¸²à¸Šà¹‰à¸²à¹à¸•à¹ˆà¸¢à¸±à¹ˆà¸‡à¸¢à¸·à¸™"},{p:"à¸à¸¸à¸˜",y:17,icon:"ğŸ§ ",theme:"à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¹à¸¥à¸°à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰",desc:"à¸à¸¥à¸±à¸‡à¸”à¹‰à¸²à¸™à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£ à¸˜à¸¸à¸£à¸à¸´à¸ˆ à¸à¸²à¸£à¸„à¹‰à¸² à¸„à¸§à¸²à¸¡à¸„à¸´à¸”",focus:"à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£ à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰ à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸„à¸£à¸·à¸­à¸‚à¹ˆà¸²à¸¢"}];
const calcDasha=(bd)=>{const bp=bd?.split("-");if(!bp||bp.length<3)return[];const by=parseInt(bp[0])||1990;const bm=parseInt(bp[1])||1;const bdNum=parseInt(bp[2])||1;const nm=natalMoon(bd);const nakI=(nm*2+(bdNum%3))%27;const startI=Math.floor(nakI/3)%9;const totalY=120;const phases=[];let age=0;for(let c=0;c<18;c++){const di=(startI+c)%9;const d=DASHA_SEQ[di];const startAge=age;const endAge=age+d.y;const startYear=by+startAge;const endYear=by+endAge;const now=new Date().getFullYear();const isCurrent=now>=startYear&&now<endYear;const isPast=now>=endYear;phases.push({...d,startAge,endAge,startYear,endYear,isCurrent,isPast});age+=d.y;if(age>100)break}return phases};

// Vedic scoring
const calcV=(bd,ts)=>{const m=parseInt(bd?.split("-")?.[1])||6;const d=parseInt(bd?.split("-")?.[2])||15;const s=(m*31+d)%100;const tb={dawn:5,morning:3,noon:0,evening:2,night:-2}[ts]||0;const ps={me:Math.min(40,20+(s%20)+tb),mo:Math.min(40,18+((s*3)%22)+tb),su:Math.min(40,22+((s*7)%18)+tb),ma:Math.min(40,19+((s*11)%21)+tb),ju:Math.min(40,21+((s*13)%19)+tb),sa:Math.min(40,17+((s*17)%23)+tb),ra:Math.min(40,15+((s*19)%25)+tb)};const f=(p,i)=>Math.min(100,p+Math.min(25,10+((s+i)%15))+Math.min(20,8+((s*2+i)%12))+Math.min(15,5+((s*3+i)%10)));return{"Cognitive Processing":f(ps.me,1)/10,"Emotional Regulation":f(ps.mo,2)/10,"Identity Stability":f(Math.round((ps.su+ps.sa)/2),3)/10,"Energy Management":f(ps.ma,4)/10,"Decision System":f(Math.round((ps.ju+ps.sa)/2),5)/10,"Responsibility Load":f(ps.sa,6)/10,"Motivation Driver":f(ps.su,7)/10,"Boundary System":f(Math.round((ps.sa+ps.mo)/2),8)/10,"Stress Response":f(ps.sa,9)/10,"Shadow Pattern":f(ps.ra,10)/10,"Growth Orientation":f(ps.ju,11)/10,"Integration Level":f(Math.round(Object.values(ps).reduce((a,b)=>a+b,0)/7),12)/10}};
const calcS=(v,ans)=>{const sc={};DIMS.forEach(dim=>{const vd=v[dim]||5;let raw=0,cnt=0;const dd=DM[dim];if(dd)dd.q.forEach((_,i)=>{const k=`${dim}-${i}`;if(ans[k]!==undefined){let val=ans[k];if(dd.rev)val=4-val;raw+=val;cnt++}});const ap=cnt>0?(raw/(cnt*4))*10:5;let fi=vd*.6+ap*.4;if(vd>7&&ap<4)fi-=1.5;if(vd<4&&ap>7)fi+=.5;sc[dim]=Math.max(0,Math.min(10,Math.round(fi*10)/10))});return sc};

// Vedic System Prompt
const VEDIC_SYS=`à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¸™à¸±à¸à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸à¸£à¸°à¹€à¸§à¸—(Jyotish)à¸œà¸¹à¹‰à¹€à¸Šà¸µà¹ˆà¸¢à¸§à¸Šà¸²à¸ à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸šSidereal(à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆTropical/Western)
à¸«à¸¥à¸±à¸à¸à¸²à¸£: à¸¥à¸±à¸„à¸™à¸²(Ascendant)à¸„à¸·à¸­à¸ˆà¸¸à¸”à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆSun sign
à¸”à¸²à¸§9à¸”à¸§à¸‡: à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ à¸ˆà¸±à¸™à¸—à¸£à¹Œ à¸­à¸±à¸‡à¸„à¸²à¸£ à¸à¸¸à¸˜ à¸à¸¤à¸«à¸±à¸ª à¸¨à¸¸à¸à¸£à¹Œ à¹€à¸ªà¸²à¸£à¹Œ à¸£à¸²à¸«à¸¹ à¹€à¸à¸•à¸¸
à¹€à¸£à¸·à¸­à¸™12: à¸•à¸™à¸¸ à¸à¸”à¸¸à¸¡à¸ à¸° à¸ªà¸«à¸±à¸Šà¸Šà¸° à¸à¸±à¸™à¸˜à¸¸ à¸›à¸¸à¸•à¸•à¸° à¸­à¸£à¸´ à¸›à¸±à¸•à¸™à¸´ à¸¡à¸£à¸“à¸° à¸¨à¸¸à¸ à¸° à¸à¸±à¸¡à¸¡à¸° à¸¥à¸²à¸ à¸° à¸§à¸´à¸™à¸²à¸¨
à¸™à¸±à¸à¸©à¸±à¸•à¸£27à¸¡à¸µà¸œà¸¥à¸•à¹ˆà¸­à¸ªà¹„à¸•à¸¥à¹Œà¸”à¸²à¸§ / à¸ªà¸ à¸²à¸à¸”à¸²à¸§: à¸­à¸¸à¸ˆà¸ˆà¹Œ/à¸™à¸´à¸ˆ/à¹€à¸à¸©à¸•à¸£/à¸›à¸£à¸°/à¸¡à¸´à¸•à¸£/à¸¨à¸±à¸•à¸£à¸¹
Dasha: à¸¡à¸«à¸²à¸—à¸¨à¸²â†’à¸­à¸±à¸™à¸•à¸£à¸—à¸¨à¸² à¸à¸³à¸«à¸™à¸”à¸ˆà¸±à¸‡à¸«à¸§à¸°à¸Šà¸µà¸§à¸´à¸•
Mapping: à¸à¸¸à¸˜â†’Cognitive à¸ˆà¸±à¸™à¸—à¸£à¹Œâ†’Emotional à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ+à¹€à¸ªà¸²à¸£à¹Œâ†’Identity à¸­à¸±à¸‡à¸„à¸²à¸£â†’Energy à¸à¸¤à¸«à¸±à¸ª+à¹€à¸ªà¸²à¸£à¹Œâ†’Decision à¹€à¸ªà¸²à¸£à¹Œâ†’Responsibility+Stress à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œâ†’Motivation à¹€à¸ªà¸²à¸£à¹Œ+à¸ˆà¸±à¸™à¸—à¸£à¹Œâ†’Boundary à¸£à¸²à¸«à¸¹/à¹€à¸à¸•à¸¸â†’Shadow à¸à¸¤à¸«à¸±à¸ªâ†’Growth à¸œà¸¥à¸£à¸§à¸¡â†’Integration
à¸à¸: à¸”à¸²à¸§à¸­à¸¸à¸ˆà¸ˆà¹Œ=à¸¨à¸±à¸à¸¢à¸ à¸²à¸à¸ªà¸¹à¸‡ à¸–à¹‰à¸²à¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¸•à¹ˆà¸³â†’"à¸”à¸§à¸‡à¹ƒà¸«à¹‰à¸¡à¸²à¹à¸•à¹ˆà¸¢à¸±à¸‡à¹ƒà¸Šà¹‰à¹„à¸¡à¹ˆà¹€à¸•à¹‡à¸¡" / à¸”à¸²à¸§à¸™à¸´à¸ˆ=à¸•à¹‰à¸­à¸‡à¸­à¸­à¸à¹à¸£à¸‡à¸¡à¸²à¸à¸à¸§à¹ˆà¸² à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹à¸¢à¹ˆ / à¸£à¸²à¸«à¸¹/à¹€à¸à¸•à¸¸=à¸šà¸—à¹€à¸£à¸µà¸¢à¸™à¸Šà¸²à¸•à¸´à¸™à¸µà¹‰ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸ªà¸´à¹ˆà¸‡à¹€à¸¥à¸§à¸£à¹‰à¸²à¸¢
à¸•à¸­à¸šà¸ à¸²à¸©à¸²à¹„à¸—à¸¢ à¹€à¸›à¹‡à¸™à¸à¸±à¸™à¹€à¸­à¸‡ à¹ƒà¸«à¹‰à¸à¸³à¸¥à¸±à¸‡à¹ƒà¸ˆ à¹„à¸¡à¹ˆà¸‚à¸¹à¹ˆà¹ƒà¸«à¹‰à¸à¸¥à¸±à¸§`;

// GPT
const GPT={cache:{},call:async(prompt,key)=>{if(key&&GPT.cache[key])return GPT.cache[key];try{const ctrl=new AbortController();const tm=setTimeout(()=>ctrl.abort(),18000);const r=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt,system:VEDIC_SYS}),signal:ctrl.signal});clearTimeout(tm);const d=await r.json();if(d.error)return GPT.fb(key);const t=d.text||"";if(key)GPT.cache[key]=t;return t}catch{return GPT.fb(key)}},
fb:k=>{if(!k)return"à¸à¸³à¸¥à¸±à¸‡à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ...";if(k.startsWith("id_"))return"à¸„à¸¸à¸“à¸¡à¸µà¸¨à¸±à¸à¸¢à¸ à¸²à¸à¸—à¸µà¹ˆà¸™à¹ˆà¸²à¸ªà¸™à¹ƒà¸ˆà¸ˆà¸²à¸à¸”à¸§à¸‡à¸à¸³à¹€à¸™à¸´à¸” à¸”à¸²à¸§à¸šà¹ˆà¸‡à¸šà¸­à¸à¸§à¹ˆà¸²à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¸„à¸™à¸¡à¸µà¸à¸¥à¸±à¸‡à¸ à¸²à¸¢à¹ƒà¸™à¸ªà¸¹à¸‡ à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸”à¸§à¸‡à¸à¸±à¸šà¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¸ˆà¸£à¸´à¸‡à¸„à¸·à¸­à¹‚à¸­à¸à¸²à¸ªà¸à¸±à¸’à¸™à¸²à¸ªà¸³à¸„à¸±à¸à¸‚à¸­à¸‡à¸„à¸¸à¸“ à¸¥à¸­à¸‡à¸ªà¸³à¸£à¸§à¸ˆà¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸¡à¸´à¸•à¸´à¹€à¸à¸·à¹ˆà¸­à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸¨à¸±à¸à¸¢à¸ à¸²à¸";if(k.startsWith("core_"))return"ğŸ§  Cognitive(à¸à¸¸à¸˜): à¸”à¸²à¸§à¸à¸¸à¸˜à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸‡à¹ƒà¸«à¹‰à¸„à¸´à¸”à¹€à¸›à¹‡à¸™à¸£à¸°à¸šà¸š\n\nğŸŒŠ Emotional(à¸ˆà¸±à¸™à¸—à¸£à¹Œ): à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸à¸³à¸«à¸™à¸”à¸ˆà¸±à¸‡à¸«à¸§à¸°à¸­à¸²à¸£à¸¡à¸“à¹Œ\n\nâš“ Identity(à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ+à¹€à¸ªà¸²à¸£à¹Œ): à¹à¸à¸™à¸•à¸±à¸§à¸•à¸™à¸¡à¸±à¹ˆà¸™à¸„à¸‡\n\nğŸŒ‘ Shadow(à¸£à¸²à¸«à¸¹/à¹€à¸à¸•à¸¸): à¸ˆà¸¸à¸”à¸šà¸­à¸”à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸à¹‰à¸²à¸£à¸°à¸§à¸±à¸‡\n\nğŸŒ± Growth(à¸à¸¤à¸«à¸±à¸ª): à¸à¸¤à¸«à¸±à¸ªà¹€à¸›à¸´à¸”à¸—à¸²à¸‡à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰";if(k.startsWith("sh_"))return"âš¡ Trigger: à¸£à¸²à¸«à¸¹à¸Šà¸µà¹‰à¸§à¹ˆà¸²à¸„à¸¸à¸“à¸¡à¸±à¸à¸–à¸¹à¸à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¹€à¸¡à¸·à¹ˆà¸­à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹„à¸¡à¹ˆà¸›à¸¥à¸­à¸”à¸ à¸±à¸¢\n\nğŸ”„ Pattern à¸‹à¹‰à¸³: à¹€à¸¥à¸·à¸­à¸à¸—à¸²à¸‡à¸ªà¸šà¸²à¸¢à¹à¸—à¸™à¹€à¸œà¸Šà¸´à¸à¸•à¸£à¸‡\n\nğŸ’¡ à¸§à¸´à¸˜à¸µà¹à¸à¹‰: à¸«à¸¢à¸¸à¸”5à¸§à¸´à¸™à¸²à¸—à¸µ à¹à¸¥à¹‰à¸§à¹€à¸¥à¸·à¸­à¸à¹ƒà¸«à¸¡à¹ˆ";if(k.startsWith("f12_"))return"ğŸ’ª à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡: à¸”à¸²à¸§à¸«à¸™à¸¸à¸™à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸‡à¸”à¸µ à¸à¸¥à¸±à¸‡à¸ˆà¸±à¸”à¸à¸²à¸£à¸ªà¸¹à¸‡ à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰à¹‚à¸”à¸”à¹€à¸”à¹ˆà¸™ à¹à¸£à¸‡à¸‚à¸±à¸šà¹à¸‚à¹‡à¸‡à¹à¸à¸£à¹ˆà¸‡\n\nâš ï¸ à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸²: à¸‚à¸­à¸šà¹€à¸‚à¸•à¸•à¸±à¸§à¹€à¸­à¸‡ à¸£à¸±à¸šà¸¡à¸·à¸­à¹€à¸„à¸£à¸µà¸¢à¸” à¸ˆà¸±à¸‡à¸«à¸§à¸°à¸à¸±à¸ à¸ªà¸±à¸‡à¹€à¸à¸•à¸ˆà¸¸à¸”à¸šà¸­à¸”";if(k.startsWith("wk_"))return'{"do":["à¹ƒà¸Šà¹‰à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡à¸—à¸µà¹ˆà¸”à¸²à¸§à¸«à¸™à¸¸à¸™à¹ƒà¸«à¹‰à¹€à¸•à¹‡à¸¡à¸—à¸µà¹ˆà¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸™à¸µà¹‰","à¸à¸¶à¸à¸ªà¸±à¸‡à¹€à¸à¸•à¸­à¸²à¸£à¸¡à¸“à¹Œà¸•à¸±à¸§à¹€à¸­à¸‡à¸à¹ˆà¸­à¸™à¸•à¸­à¸šà¸ªà¸™à¸­à¸‡","à¸«à¸²à¹€à¸§à¸¥à¸²à¸à¸±à¸’à¸™à¸²à¸•à¸±à¸§à¹€à¸­à¸‡à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 30 à¸™à¸²à¸—à¸µ"],"dont":["à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸à¸²à¸£à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¹€à¸£à¹‡à¸§à¹€à¸à¸´à¸™à¹„à¸›à¹€à¸¡à¸·à¹ˆà¸­à¸­à¸²à¸£à¸¡à¸“à¹Œà¹à¸£à¸‡","à¸­à¸¢à¹ˆà¸²à¸œà¸±à¸”à¸§à¸±à¸™à¸›à¸£à¸°à¸à¸±à¸™à¸à¸£à¸¸à¹ˆà¸‡à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸—à¸µà¹ˆà¸„à¹‰à¸²à¸‡à¸„à¸²","à¸­à¸¢à¹ˆà¸²à¸£à¸±à¸šà¸‡à¸²à¸™à¹€à¸à¸´à¸™à¸à¸³à¸¥à¸±à¸‡ à¸à¸¶à¸à¸›à¸à¸´à¹€à¸ªà¸˜"]}';if(k.startsWith("en_"))return'[{"day":"à¸§à¸±à¸™à¸™à¸µà¹‰","date":"","energy":72,"mood":"ğŸŒŸ à¸¡à¸µà¸à¸¥à¸±à¸‡à¸”à¸µ","tip":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸‡à¸›à¸²à¸™à¸à¸¥à¸²à¸‡ à¹ƒà¸Šà¹‰à¸Šà¹ˆà¸§à¸‡à¹€à¸Šà¹‰à¸²à¸—à¸³à¸‡à¸²à¸™à¸ªà¸³à¸„à¸±à¸","transit":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ + à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µà¸à¸¤à¸©à¸ ","goodFor":"à¸§à¸²à¸‡à¹à¸œà¸™ à¸—à¸³à¸‡à¸²à¸™à¸ªà¸³à¸„à¸±à¸"},{"day":"à¸à¸£à¸¸à¹ˆà¸‡à¸™à¸µà¹‰","date":"","energy":68,"mood":"ğŸ˜Š à¸ªà¸‡à¸šà¸¡à¸±à¹ˆà¸™à¸„à¸‡","tip":"à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸•à¸£à¸µà¹‚à¸à¸“à¸”à¸µ à¹€à¸«à¸¡à¸²à¸°à¸”à¸¹à¹à¸¥à¸•à¸±à¸§à¹€à¸­à¸‡","transit":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸ˆà¸±à¸™à¸—à¸£à¹Œ + à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µà¸à¸¤à¸©à¸ ","goodFor":"à¸à¸±à¸à¸œà¹ˆà¸­à¸™ à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸£à¸£à¸„à¹Œ"},{"day":"à¸¡à¸°à¸£à¸·à¸™","date":"","energy":78,"mood":"ğŸ”¥ à¸à¸£à¸°à¸•à¸·à¸­à¸£à¸·à¸­à¸£à¹‰à¸™","tip":"à¸­à¸±à¸‡à¸„à¸²à¸£à¸ˆà¸£à¹€à¸à¸©à¸•à¸£ à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸‡à¸à¸²à¸¢","transit":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸­à¸±à¸‡à¸„à¸²à¸£ + à¸­à¸±à¸‡à¸„à¸²à¸£à¸ˆà¸£à¹€à¸à¸©à¸•à¸£","goodFor":"à¸­à¸­à¸à¸à¸³à¸¥à¸±à¸‡à¸à¸²à¸¢ à¸¥à¸‡à¸¡à¸·à¸­à¸—à¸³"},{"day":"+3","date":"","energy":65,"mood":"ğŸ§  à¸„à¸´à¸”à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ","tip":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸à¸¸à¸˜à¸«à¸™à¸¸à¸™à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£","transit":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸à¸¸à¸˜ + à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µà¸¡à¸´à¸–à¸¸à¸™","goodFor":"à¸›à¸£à¸°à¸Šà¸¸à¸¡ à¹€à¸ˆà¸£à¸ˆà¸²"},{"day":"+4","date":"","energy":82,"mood":"ğŸ“š à¸›à¸±à¸à¸à¸²à¹€à¸›à¸´à¸”","tip":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸à¸¤à¸«à¸±à¸ªà¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸‡à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰","transit":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸à¸¤à¸«à¸±à¸ª + à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µà¸¡à¸´à¸–à¸¸à¸™","goodFor":"à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ à¸§à¸²à¸‡à¹à¸œà¸™"},{"day":"+5","date":"","energy":75,"mood":"ğŸ’ à¸œà¹ˆà¸­à¸™à¸„à¸¥à¸²à¸¢","tip":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸¨à¸¸à¸à¸£à¹Œà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸à¹à¸¥à¸°à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ","transit":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¸¨à¸¸à¸à¸£à¹Œ + à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µà¸à¸£à¸à¸","goodFor":"à¸ªà¸±à¸‡à¸ªà¸£à¸£à¸„à¹Œ à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸£à¸£à¸„à¹Œ"},{"day":"+6","date":"","energy":58,"mood":"âš™ï¸ à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸§à¸´à¸™à¸±à¸¢","tip":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¹€à¸ªà¸²à¸£à¹Œà¹€à¸£à¸µà¸¢à¸à¸£à¹‰à¸­à¸‡à¸„à¸§à¸²à¸¡à¸­à¸”à¸—à¸™","transit":"à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™à¹€à¸ªà¸²à¸£à¹Œ + à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µà¸à¸£à¸à¸","goodFor":"à¸ˆà¸±à¸”à¸£à¸°à¹€à¸šà¸µà¸¢à¸š à¸—à¸³à¸‡à¸²à¸™à¸„à¹‰à¸²à¸‡"}]';if(k.startsWith("job_"))return'[{"title":"Data Analyst","titleTH":"à¸™à¸±à¸à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥","match":85,"dims":"Cognitive + Decision + Responsibility","reason":"à¸”à¸²à¸§à¸à¸¸à¸˜à¹à¸¥à¸°à¸à¸¤à¸«à¸±à¸ªà¸«à¸™à¸¸à¸™à¸à¸²à¸£à¸„à¸´à¸”à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹€à¸Šà¸´à¸‡à¸£à¸°à¸šà¸š à¸„à¸§à¸²à¸¡à¸£à¸±à¸šà¸œà¸´à¸”à¸Šà¸­à¸šà¸ªà¸¹à¸‡à¸ˆà¸²à¸à¹€à¸ªà¸²à¸£à¹Œà¸—à¸³à¹ƒà¸«à¹‰à¸—à¸³à¸‡à¸²à¸™à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹„à¸”à¹‰à¸”à¸µ"},{"title":"Project Manager","titleTH":"à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œ","match":80,"dims":"Energy + Decision + Stress Response","reason":"à¸­à¸±à¸‡à¸„à¸²à¸£à¹ƒà¸«à¹‰à¸à¸¥à¸±à¸‡à¸‚à¸±à¸šà¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™ à¸à¸¤à¸«à¸±à¸ª+à¹€à¸ªà¸²à¸£à¹Œà¸«à¸™à¸¸à¸™à¸à¸²à¸£à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆ à¹€à¸ªà¸²à¸£à¹Œà¸Šà¹ˆà¸§à¸¢à¸£à¸±à¸šà¸¡à¸·à¸­à¹à¸£à¸‡à¸à¸”à¸”à¸±à¸™"},{"title":"UX Researcher","titleTH":"à¸™à¸±à¸à¸§à¸´à¸ˆà¸±à¸¢ UX","match":78,"dims":"Cognitive + Emotional + Growth","reason":"à¸à¸¸à¸˜à¸«à¸™à¸¸à¸™à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸Šà¹ˆà¸§à¸¢à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ à¸à¸¤à¸«à¸±à¸ªà¹€à¸›à¸´à¸”à¸—à¸²à¸‡à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰à¸ªà¸´à¹ˆà¸‡à¹ƒà¸«à¸¡à¹ˆ"}]';return null}};
const pJ=t=>{if(!t)return null;try{return JSON.parse(t.replace(/```json\s*/g,"").replace(/```/g,"").trim())}catch{return null}};
const ST={set:(k,v)=>{try{localStorage.setItem(`hss6_${k}`,JSON.stringify(v))}catch{}},get:k=>{try{const s=localStorage.getItem(`hss6_${k}`);return s?JSON.parse(s):null}catch{return null}}};

const css=`@keyframes hs{to{transform:rotate(360deg)}}@keyframes hb{50%{opacity:0}}@keyframes hfl{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}`;
const Spin=({t="AI à¸à¸³à¸¥à¸±à¸‡à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ..."})=><div style={{padding:"12px 0",display:"flex",alignItems:"center",gap:8}}><div style={{width:16,height:16,borderRadius:"50%",border:"2.5px solid #E0E7FF",borderTopColor:"#6366F1",animation:"hs .7s linear infinite"}}/><span style={{fontSize:12,color:"#6366F1",fontWeight:600}}>{t}</span></div>;
const Typer=({text})=>{const[s,setS]=useState("");const[d,setD]=useState(false);useEffect(()=>{if(!text)return;let i=0;setS("");setD(false);const iv=setInterval(()=>{i+=3;if(i>=text.length){setS(text);setD(true);clearInterval(iv)}else setS(text.slice(0,i))},12);return()=>clearInterval(iv)},[text]);return<div style={{fontSize:13,lineHeight:1.8,color:"#374151",whiteSpace:"pre-wrap"}}>{s}{!d&&<span style={{display:"inline-block",width:2,height:14,background:"#6366F1",marginLeft:1,animation:"hb .8s step-end infinite"}}/>}</div>};
const Spider=({scores,size=260})=>{const keys=Object.keys(scores);const vals=Object.values(scores);const n=keys.length;const cx=size/2,cy=size/2,r=size*.34;const pt=(i,v)=>{const a=Math.PI*2*i/n-Math.PI/2;return{x:cx+Math.cos(a)*v/10*r,y:cy+Math.sin(a)*v/10*r}};return<svg viewBox={`0 0 ${size} ${size}`} style={{width:"100%",maxWidth:280}}>{[2,4,6,8,10].map(l=><polygon key={l} points={keys.map((_,i)=>{const p=pt(i,l);return`${p.x},${p.y}`}).join(" ")} fill="none" stroke="#E5E7EB" strokeWidth=".6"/>)}{keys.map((_,i)=>{const p=pt(i,10);return<line key={i} x1={cx} y1={cy} x2={p.x} y2={p.y} stroke="#F3F4F6" strokeWidth=".4"/>})}<polygon points={keys.map((_,i)=>{const p=pt(i,vals[i]);return`${p.x},${p.y}`}).join(" ")} fill="rgba(99,102,241,.12)" stroke="#6366F1" strokeWidth="1.8"/>{keys.map((_,i)=>{const p=pt(i,vals[i]);return<circle key={i} cx={p.x} cy={p.y} r="2.5" fill="#6366F1" stroke="#fff" strokeWidth="1.2"/>})}{keys.map((k,i)=>{const p=pt(i,12.2);const sh=k.length>12?k.slice(0,10)+"â€¦":k;return<text key={i} x={p.x} y={p.y} textAnchor="middle" dominantBaseline="middle" style={{fontSize:"5.2px",fill:"#6B7280",fontWeight:500}}>{sh}</text>})}</svg>};
const Card=({children,style={}})=><div style={{background:"#fff",borderRadius:14,padding:"16px 18px",marginBottom:10,boxShadow:"0 1px 3px rgba(0,0,0,.04)",border:"1px solid #F1F5F9",...style}}>{children}</div>;
const Btn=({children,ok=true,onClick,style={}})=><button onClick={ok?onClick:undefined} style={{padding:"12px 20px",fontSize:14,fontWeight:700,background:ok?"linear-gradient(135deg,#4338CA,#6D28D9)":"#E2E8F0",color:ok?"#fff":"#94A3B8",border:"none",borderRadius:10,cursor:ok?"pointer":"not-allowed",width:"100%",boxShadow:ok?"0 4px 14px rgba(79,70,229,.2)":"none",...style}}>{children}</button>;

// Locked Preview with blur
const Locked=({planNeeded,title,children,onUpgrade})=><Card style={{position:"relative",overflow:"hidden",minHeight:120}}><div style={{filter:"blur(3px)",pointerEvents:"none",userSelect:"none",opacity:.4,padding:"8px 0"}}>{children}</div><div style={{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,.75)",backdropFilter:"blur(2px)",padding:16}}><div style={{fontSize:28,marginBottom:6}}>ğŸ”’</div><div style={{fontSize:13,fontWeight:700,color:"#4338CA",marginBottom:3,textAlign:"center"}}>{title}</div><div style={{fontSize:11,color:"#64748B",marginBottom:10}}>{planNeeded==="deep"?"Deep Insight à¸¿99":"All Access à¸¿249"}</div><button onClick={()=>onUpgrade(planNeeded)} style={{padding:"8px 24px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#4338CA,#6D28D9)",color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(79,70,229,.25)"}}>à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸ â†’</button></div></Card>;

export default function App(){
  const[sc,setSc]=useState("landing");
  const[nick,setNick]=useState("");const[email,setEmail]=useState("");const[bday,setBday]=useState("--");
  const[knowT,setKnowT]=useState(null);const[btime,setBtime]=useState("");const[tSlot,setTSlot]=useState("");const[prov,setProv]=useState("");
  const[qI,setQI]=useState(0);const[ans,setAns]=useState({});
  const[scores,setScores]=useState(null);const[vedic,setVedic]=useState(null);
  const[plan,setPlan]=useState("free");const[ai,setAi]=useState({});const[aiL,setAiL]=useState({});
  const[user,setUser]=useState(null);const[loginModal,setLoginModal]=useState(false);const[pendingPlan,setPendingPlan]=useState(null);
  const[authMode,setAuthMode]=useState("login");const[authErr,setAuthErr]=useState("");const[authLoading,setAuthLoading]=useState(false);
  const authEmailRef=useRef(null);const authPwRef=useRef(null);
  const nickRef=useRef(null);const emailRef=useRef(null);

  // Init: check Supabase session + load from DB or localStorage
  useEffect(()=>{
    const init=async()=>{
      if(sb){
        const{data:{session}}=await sb.auth.getSession();
        if(session?.user){setUser(session.user);setEmail(session.user.email||"");
          const{data:prof}=await sb.from("profiles").select("*").eq("id",session.user.id).single();
          if(prof){setNick(prof.nick||"");setBday(prof.bday||"--");setBtime(prof.btime||"");setTSlot(prof.time_slot||"");setProv(prof.province||"");setPlan(prof.plan||"free")}
          const{data:assess}=await sb.from("assessments").select("*").eq("user_id",session.user.id).order("created_at",{ascending:false}).limit(1).single();
          if(assess&&assess.scores){
            setAns(assess.answers||{});setScores(assess.scores);setVedic(assess.vedic);setSc("results");
            if(assess.ai_results&&Object.keys(assess.ai_results).length>0){setAi(assess.ai_results)}
          }
        }
        sb.auth.onAuthStateChange(async(ev,session)=>{
          if(ev==="SIGNED_IN"&&session?.user){setUser(session.user);setEmail(session.user.email||"");setLoginModal(false);
            if(pendingPlan)upgradePlan(pendingPlan);setPendingPlan(null)}
          if(ev==="SIGNED_OUT"){setUser(null)}
        });
      } else {
        const sc2=ST.get("scores");const vd=ST.get("vedic");const p=ST.get("profile");const pl=ST.get("plan");const a=ST.get("answers");
        if(p){setNick(p.nick||"");setEmail(p.email||"");setBday(p.bday||"--");setBtime(p.btime||"");setTSlot(p.tSlot||"");setProv(p.prov||"")}if(a)setAns(a);if(pl)setPlan(pl);if(sc2&&vd){setScores(sc2);setVedic(vd);setSc("results")}
      }
    };init();
  },[]);

  // Auto-trigger AI when scores+nick become available (after login reload)
  const aiTriggered=useRef(false);
  useEffect(()=>{
    if(scores&&nick&&vedic&&!aiTriggered.current){
      aiTriggered.current=true;
      if(!ai.identity)loadAI("identity",scores,vedic,nick,bday);
      if(!ai.core)loadAI("core",scores,vedic,nick,bday);
      const fs=PLANS[plan].f;
      if(fs.includes("12d")&&!ai["12d"])loadAI("12d",scores,vedic,nick,bday);
      if(fs.includes("shadow")&&!ai.shadow)loadAI("shadow",scores,vedic,nick,bday);
      if(fs.includes("weekly")&&!ai.weekly)loadAI("weekly",scores,vedic,nick,bday);
      if(fs.includes("energy")&&!ai.energy)loadAI("energy",scores,vedic,nick,bday);
      if(fs.includes("job")&&!ai.job)loadAI("job",scores,vedic,nick,bday);
    }
  },[scores,nick,vedic,plan,ai]);

  // Save to Supabase DB
  const saveProfile=async()=>{if(!sb||!user)return;await sb.from("profiles").upsert({id:user.id,nick,email:user.email,bday,btime,time_slot:tSlot,province:prov,plan,updated_at:new Date().toISOString()})};
  const saveAssessment=async(s,v,a)=>{if(!sb||!user)return;const{data:ex}=await sb.from("assessments").select("id").eq("user_id",user.id).order("created_at",{ascending:false}).limit(1).single();if(ex){await sb.from("assessments").update({answers:a,scores:s,vedic:v,updated_at:new Date().toISOString()}).eq("id",ex.id)}else{await sb.from("assessments").insert({user_id:user.id,answers:a,scores:s,vedic:v})}};
  const saveAI=async(aiData)=>{if(!sb||!user)return;const{data:ex}=await sb.from("assessments").select("id").eq("user_id",user.id).order("created_at",{ascending:false}).limit(1).single();if(ex)await sb.from("assessments").update({ai_results:aiData,updated_at:new Date().toISOString()}).eq("id",ex.id)};
  const savePlan=async(p)=>{if(!sb||!user)return;await sb.from("profiles").update({plan:p,updated_at:new Date().toISOString()}).eq("id",user.id)};

  const logged=!!user;
  const has=f=>PLANS[plan].f.includes(f);
  const goQuiz=()=>{ST.set("profile",{nick,email,bday,btime,tSlot,prov});saveProfile();setSc("quiz")};
  const answer=val=>{const q=ALL_Q[qI];const key=`${q.dim}-${q.qi}`;const na={...ans,[key]:val};setAns(na);ST.set("answers",na);if(qI<ALL_Q.length-1)setTimeout(()=>setQI(qI+1),200)};
  const finish=()=>{const ts=knowT?btime:tSlot;const v=calcV(bday,ts);const s=calcS(v,ans);setVedic(v);setScores(s);ST.set("vedic",v);ST.set("scores",s);saveAssessment(s,v,ans);setSc("results");loadAI("identity",s,v);loadAI("core",s,v)};

  const loadAI=async(type,s2,v2,nameOverride,bdayOverride)=>{const s=s2||scores;const v=v2||vedic;const nn=nameOverride||nick;const bd=bdayOverride||bday;if(!s||!nn||ai[type])return;setAiL(p=>({...p,[type]:true}));let r=null;try{const so=Object.entries(s).sort((a,b)=>b[1]-a[1]);
    if(type==="identity")r=await GPT.call(`à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸•à¸±à¸§à¸•à¸™"${nn}"3à¸›à¸£à¸°à¹‚à¸¢à¸„ Vedic+à¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡:\nà¸¨à¸±à¸à¸¢à¸ à¸²à¸à¸”à¸§à¸‡:${Object.entries(v).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([k,v2])=>`${k}(${v2.toFixed(1)})`).join(",")}\nà¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡:à¹à¸‚à¹‡à¸‡${so.slice(0,3).map(([k,v2])=>`${k}(${v2.toFixed(1)})`).join(",")} à¸­à¹ˆà¸­à¸™${so.slice(-2).map(([k,v2])=>`${k}(${v2.toFixed(1)})`).join(",")}\nà¸–à¹‰à¸²à¸¨à¸±à¸à¸¢à¸ à¸²à¸à¸ªà¸¹à¸‡à¹à¸•à¹ˆà¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¸•à¹ˆà¸³â†’"à¸”à¸§à¸‡à¹ƒà¸«à¹‰à¸¡à¸²à¹à¸•à¹ˆà¸¢à¸±à¸‡à¹ƒà¸Šà¹‰à¹„à¸¡à¹ˆà¹€à¸•à¹‡à¸¡"`,`id_${nn}`);
    if(type==="core")r=await GPT.call(`à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ5Core"${nn}"Vedic:\nğŸ§ Cognitive(à¸à¸¸à¸˜):à¸”à¸§à¸‡${v["Cognitive Processing"]?.toFixed(1)}à¸ˆà¸£à¸´à¸‡${s["Cognitive Processing"]?.toFixed(1)}\nğŸŒŠEmotional(à¸ˆà¸±à¸™à¸—à¸£à¹Œ):à¸”à¸§à¸‡${v["Emotional Regulation"]?.toFixed(1)}à¸ˆà¸£à¸´à¸‡${s["Emotional Regulation"]?.toFixed(1)}\nâš“Identity(à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ+à¹€à¸ªà¸²à¸£à¹Œ):à¸”à¸§à¸‡${v["Identity Stability"]?.toFixed(1)}à¸ˆà¸£à¸´à¸‡${s["Identity Stability"]?.toFixed(1)}\nğŸŒ‘Shadow(à¸£à¸²à¸«à¸¹/à¹€à¸à¸•à¸¸):à¸”à¸§à¸‡${v["Shadow Pattern"]?.toFixed(1)}à¸ˆà¸£à¸´à¸‡${s["Shadow Pattern"]?.toFixed(1)}\nğŸŒ±Growth(à¸à¸¤à¸«à¸±à¸ª):à¸”à¸§à¸‡${v["Growth Orientation"]?.toFixed(1)}à¸ˆà¸£à¸´à¸‡${s["Growth Orientation"]?.toFixed(1)}\nà¹à¸•à¹ˆà¸¥à¸°à¸”à¹‰à¸²à¸™1-2à¸›à¸£à¸°à¹‚à¸¢à¸„`,`core_${nn}`);
    if(type==="12d")r=await GPT.call(`à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ12à¸¡à¸´à¸•à¸´"${nn}"Vedic:\n${Object.entries(s).map(([k,sv])=>`${k}:à¸”à¸§à¸‡${v[k]?.toFixed(1)}à¸ˆà¸£à¸´à¸‡${sv.toFixed(1)}`).join("\n")}\nà¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡4+à¸”à¸²à¸§à¸«à¸™à¸¸à¸™ à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸²4+action à¸–à¹‰à¸²gap>2â†’highlight`,`f12_${nn}`);
    if(type==="shadow")r=await GPT.call(`Shadow"${nn}"Vedic(à¸£à¸²à¸«à¸¹/à¹€à¸à¸•à¸¸):\nShadow:à¸”à¸§à¸‡${v["Shadow Pattern"]?.toFixed(1)}à¸ˆà¸£à¸´à¸‡${s["Shadow Pattern"]?.toFixed(1)}\nStress:${s["Stress Response"]?.toFixed(1)} Boundary:${s["Boundary System"]?.toFixed(1)}\nâš¡Trigger ğŸ”„Pattern ğŸ’¡à¸§à¸´à¸˜à¸µà¹à¸à¹‰à¸•à¸²à¸¡à¸”à¸²à¸§`,`sh_${nn}`);
    if(type==="weekly"){const t=await GPT.call(`à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸à¸£à¸°à¹€à¸§à¸— à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ"${nn}":\nà¹à¸‚à¹‡à¸‡:${so.slice(0,3).map(([k])=>k).join(",")} à¸­à¹ˆà¸­à¸™:${so.slice(-2).map(([k])=>k).join(",")}\nà¸•à¸­à¸šJSONà¹„à¸¡à¹ˆà¸¡à¸µbacktick:{"do":["à¸„à¸§à¸£à¸—à¸³1","à¸„à¸§à¸£à¸—à¸³2","à¸„à¸§à¸£à¸—à¸³3"],"dont":["à¹€à¸¥à¸µà¹ˆà¸¢à¸‡1","à¹€à¸¥à¸µà¹ˆà¸¢à¸‡2","à¹€à¸¥à¸µà¹ˆà¸¢à¸‡3"]}`,`wk_${nn}`);r=pJ(t)}
    // Energy: show smart fallback FIRST then try GPT
    if(type==="energy"){const tr=gen7Day(bd);const MOODS=["ğŸŒŸ à¸ªà¸”à¹ƒà¸ª","ğŸ˜Š à¸ªà¸‡à¸š","ğŸ”¥ à¸à¸£à¸°à¸•à¸·à¸­à¸£à¸·à¸­à¸£à¹‰à¸™","ğŸ§  à¸„à¸´à¸”à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ","ğŸ“š à¸›à¸±à¸à¸à¸²à¹€à¸›à¸´à¸”","ğŸ’ à¸œà¹ˆà¸­à¸™à¸„à¸¥à¸²à¸¢","âš™ï¸ à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸§à¸´à¸™à¸±à¸¢"];
      const smartFB=tr.map((d,i)=>({day:d.dn,date:d.date,energy:d.ce,mood:d.ce>75?MOODS[0]:d.ce>65?MOODS[1]:d.ce>55?MOODS[3]:MOODS[6],tip:`à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™${d.dl.icon}${d.dl.lord} ${d.dl.q} à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µ${d.moonR}(${d.ma.r})`,transit:`à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™${d.dl.icon}${d.dl.lord} + à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸ˆà¸£à¸£à¸²à¸¨à¸µ${d.moonR} + à¸­à¸±à¸‡à¸„à¸²à¸£à¸ˆà¸£à¸£à¸²à¸¨à¸µ${d.marsR}`,goodFor:d.dl.gf}));
      setAi(p=>({...p,energy:smartFB}));setAiL(p=>({...p,energy:false}));
      // Try GPT upgrade in background (non-blocking)
      GPT.call(`à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™7à¸§à¸±à¸™"${nn}"à¸ˆà¸±à¸™à¸—à¸£à¹Œà¸à¸³à¹€à¸™à¸´à¸”à¸£à¸²à¸¨à¸µ${tr[0].nmR} Em:${s["Emotional Regulation"]?.toFixed(1)} En:${s["Energy Management"]?.toFixed(1)}\n${tr.map(d=>`${d.dn}${d.date}:${d.dl.icon}${d.dl.lord} à¸ˆ${d.moonR}(${d.ma.r}) à¸­${d.marsR}(${d.md.d}) E=${d.ce}%`).join("\n")}\nà¸•à¸­à¸šJSON7obj:[{"day":"à¸§à¸±à¸™","date":"d/m","energy":30à¸–à¸¶à¸‡95,"mood":"emoji+2à¸„à¸³","tip":"à¸ªà¸±à¹‰à¸™à¸­à¹‰à¸²à¸‡à¸”à¸²à¸§","transit":"à¸”à¸²à¸§","goodFor":"à¸ªà¸±à¹‰à¸™"}]`,`en_${nn}_${new Date().toISOString().slice(0,10)}`).then(t=>{const p=pJ(t);if(p&&Array.isArray(p)&&p.length===7){setAi(prev=>({...prev,energy:p.map(d=>({...d,energy:d.energy<15?Math.round(d.energy*10):d.energy}))}))}});
      return}
    // Job: show smart fallback FIRST then try GPT
    if(type==="job"){const top3=so.slice(0,3).map(([k])=>k);const bot2=so.slice(-2).map(([k])=>k);
      const JOB_MAP={"Cognitive Processing":[{t:"Data Analyst",th:"à¸™à¸±à¸à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥"},{t:"Software Engineer",th:"à¸§à¸´à¸¨à¸§à¸à¸£à¸‹à¸­à¸Ÿà¸•à¹Œà¹à¸§à¸£à¹Œ"}],"Energy Management":[{t:"Project Manager",th:"à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œ"},{t:"Sales Manager",th:"à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¹ˆà¸²à¸¢à¸‚à¸²à¸¢"}],"Emotional Regulation":[{t:"UX Researcher",th:"à¸™à¸±à¸à¸§à¸´à¸ˆà¸±à¸¢ UX"},{t:"Counselor",th:"à¸—à¸µà¹ˆà¸›à¸£à¸¶à¸à¸©à¸²"}],"Decision System":[{t:"Financial Planner",th:"à¸™à¸±à¸à¸§à¸²à¸‡à¹à¸œà¸™à¸à¸²à¸£à¹€à¸‡à¸´à¸™"},{t:"Strategy Consultant",th:"à¸—à¸µà¹ˆà¸›à¸£à¸¶à¸à¸©à¸²à¸à¸¥à¸¢à¸¸à¸—à¸˜à¹Œ"}],"Growth Orientation":[{t:"Product Manager",th:"à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸œà¸¥à¸´à¸•à¸ à¸±à¸“à¸‘à¹Œ"},{t:"Researcher",th:"à¸™à¸±à¸à¸§à¸´à¸ˆà¸±à¸¢"}],"Motivation Driver":[{t:"Entrepreneur",th:"à¸œà¸¹à¹‰à¸›à¸£à¸°à¸à¸­à¸šà¸à¸²à¸£"},{t:"Marketing Manager",th:"à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸£à¸•à¸¥à¸²à¸”"}],"Responsibility Load":[{t:"Operations Manager",th:"à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸à¸²à¸£à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£"},{t:"Quality Assurance",th:"QA Engineer"}]};
      const picks=[];const seen=new Set();top3.forEach(dim=>{(JOB_MAP[dim]||JOB_MAP["Cognitive Processing"]).forEach(j=>{if(!seen.has(j.t)&&picks.length<3){seen.add(j.t);picks.push({title:j.t,titleTH:j.th,match:Math.round(85-picks.length*5+s[dim]),dims:top3.slice(0,3).join(" + "),reason:`${DM[dim]?.icon}${dim}(${s[dim]?.toFixed(1)})à¸—à¸µà¹ˆà¹à¸‚à¹‡à¸‡à¸«à¸™à¸¸à¸™à¸‡à¸²à¸™à¸™à¸µà¹‰ à¸”à¸²à¸§${DM[dim]?.pl}à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸‡`})}})});
      while(picks.length<3)picks.push({title:"Business Analyst",titleTH:"à¸™à¸±à¸à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸˜à¸¸à¸£à¸à¸´à¸ˆ",match:75,dims:top3.join(" + "),reason:"à¸—à¸±à¸à¸©à¸°à¸£à¸­à¸šà¸”à¹‰à¸²à¸™à¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸šà¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ"});
      setAi(p=>({...p,job:picks}));setAiL(p=>({...p,job:false}));
      // Try GPT upgrade in background
      GPT.call(`JobMatch"${nn}"à¹à¸‚à¹‡à¸‡:${so.slice(0,4).map(([k,v2])=>`${k}=${v2.toFixed(1)}`).join(",")} à¸­à¹ˆà¸­à¸™:${so.slice(-3).map(([k,v2])=>`${k}=${v2.toFixed(1)}`).join(",")}\nà¹à¸™à¸°à¸™à¸³3à¸­à¸²à¸Šà¸µà¸+à¹€à¸«à¸•à¸¸à¸œà¸¥à¸­à¹‰à¸²à¸‡dim+à¸”à¸²à¸§ à¸•à¸­à¸šJSON:[{"title":"EN","titleTH":"à¹„à¸—à¸¢","match":à¹€à¸¥à¸‚,"dims":"3à¸¡à¸´à¸•à¸´","reason":"2à¸›à¸£à¸°à¹‚à¸¢à¸„"}]`,`job_${nn}`).then(t=>{const p=pJ(t);if(p&&Array.isArray(p)&&p.length>=3)setAi(prev=>({...prev,job:p}))});
      return}
  }catch{}setAi(p=>({...p,[type]:r}));setAiL(p=>({...p,[type]:false}))};

  const tryUpgrade=p=>{if(!logged){setPendingPlan(p);setLoginModal(true);setAuthErr("")}else{upgradePlan(p)}};

  // Real Supabase Auth
  const doSignup=async()=>{const ae=authEmailRef.current?.value||"";const ap=authPwRef.current?.value||"";if(!ae||!ap){setAuthErr("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸­à¸µà¹€à¸¡à¸¥à¹à¸¥à¸°à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™");return}if(ap.length<6){setAuthErr("à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 6 à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£");return}setAuthLoading(true);setAuthErr("");
    const{data,error}=await sb.auth.signUp({email:ae,password:ap});
    if(error){setAuthErr(error.message);setAuthLoading(false);return}
    if(data?.user){setUser(data.user);setEmail(ae);setLoginModal(false);if(pendingPlan){upgradePlan(pendingPlan);setPendingPlan(null)}}setAuthLoading(false)};

  const doLogin=async()=>{const ae=authEmailRef.current?.value||"";const ap=authPwRef.current?.value||"";if(!ae||!ap){setAuthErr("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸­à¸µà¹€à¸¡à¸¥à¹à¸¥à¸°à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™");return}setAuthLoading(true);setAuthErr("");
    const{data,error}=await sb.auth.signInWithPassword({email:ae,password:ap});
    if(error){setAuthErr(error.message==="Invalid login credentials"?"à¸­à¸µà¹€à¸¡à¸¥à¸«à¸£à¸·à¸­à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡":error.message);setAuthLoading(false);return}
    if(data?.user){setUser(data.user);setEmail(ae);setLoginModal(false);if(pendingPlan){upgradePlan(pendingPlan);setPendingPlan(null)}}setAuthLoading(false)};

  const doGoogle=async()=>{if(!sb)return;setAuthLoading(true);
    await sb.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}})};

  const doLogout=async()=>{if(sb)await sb.auth.signOut();setUser(null);setSc("landing");setScores(null);setVedic(null);setAns({});setAi({});setQI(0);setPlan("free");localStorage.clear()};

  const upgradePlan=p=>{setPlan(p);ST.set("plan",p);savePlan(p);const fs=PLANS[p].f;const loads=[];if(fs.includes("12d")&&!ai["12d"])loads.push(loadAI("12d"));if(fs.includes("shadow")&&!ai.shadow)loads.push(loadAI("shadow"));if(fs.includes("weekly")&&!ai.weekly)loads.push(loadAI("weekly"));if(fs.includes("energy")&&!ai.energy)loads.push(loadAI("energy"));if(fs.includes("job")&&!ai.job)loads.push(loadAI("job"));Promise.all(loads)};

  const exportPDF=()=>{if(!scores)return;const so=Object.entries(scores).sort((a,b)=>b[1]-a[1]);const w=window.open("","_blank");
    // Spider chart SVG for PDF
    const keys=Object.keys(scores);const vals=Object.values(scores);const n=keys.length;const sz=300,cx=150,cy=150,rad=100;
    const pt=(i,v)=>{const a=Math.PI*2*i/n-Math.PI/2;return{x:cx+Math.cos(a)*v/10*rad,y:cy+Math.sin(a)*v/10*rad}};
    const spiderSVG=`<svg viewBox="0 0 ${sz} ${sz}" style="width:280px;margin:10px auto;display:block">${[2,4,6,8,10].map(l=>`<polygon points="${keys.map((_,i)=>{const p=pt(i,l);return`${p.x},${p.y}`}).join(" ")}" fill="none" stroke="#E5E7EB" stroke-width=".6"/>`).join("")}<polygon points="${keys.map((_,i)=>{const p=pt(i,vals[i]);return`${p.x},${p.y}`}).join(" ")}" fill="rgba(99,102,241,.12)" stroke="#6366F1" stroke-width="1.8"/>${keys.map((_,i)=>{const p=pt(i,vals[i]);return`<circle cx="${p.x}" cy="${p.y}" r="2.5" fill="#6366F1" stroke="#fff" stroke-width="1.2"/>`}).join("")}${keys.map((k,i)=>{const p=pt(i,12.5);const sh=k.length>14?k.slice(0,12)+"â€¦":k;return`<text x="${p.x}" y="${p.y}" text-anchor="middle" dominant-baseline="middle" style="font-size:5.5px;fill:#6B7280;font-weight:500">${sh}</text>`}).join("")}</svg>`;
    // Weekly
    const wk=ai.weekly&&typeof ai.weekly==="object"?`<h2>ğŸ“‹ Do & Don't à¸£à¸²à¸¢à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ</h2><div class="g"><div class="card" style="background:#ECFDF5"><b style="color:#059669">âœ… à¸„à¸§à¸£à¸—à¸³</b>${(ai.weekly.do||[]).map(t=>`<p>â€¢ ${t}</p>`).join("")}</div><div class="card" style="background:#FFF1F2"><b style="color:#EF4444">âŒ à¹€à¸¥à¸µà¹ˆà¸¢à¸‡</b>${(ai.weekly.dont||[]).map(t=>`<p>â€¢ ${t}</p>`).join("")}</div></div>`:"";
    // Energy with full details
    const en=ai.energy&&Array.isArray(ai.energy)?`<h2>ğŸŒ™ 7-Day Energy</h2>${ai.energy.map(d=>`<div class="card" style="margin:4px 0"><div style="display:flex;justify-content:space-between;margin-bottom:2px"><b>${d.day} ${d.date||""}</b><span>${d.mood||""}</span></div>${d.transit?`<div style="font-size:10px;color:#7C3AED">ğŸª ${d.transit}</div>`:""}${d.goodFor?`<div style="font-size:10px;color:#059669">âœ… ${d.goodFor}</div>`:""}${d.tip?`<div style="font-size:10px;color:#374151">ğŸ’¡ ${d.tip}</div>`:""}</div>`).join("")}`:"";
    // Job
    const jb=ai.job&&Array.isArray(ai.job)?`<h2>ğŸ’¼ Job Matching</h2>${ai.job.map(j=>`<div class="card"><b>${j.titleTH||j.title} (${j.match}%)</b><div style="font-size:11px;color:#64748B">${j.dims||""}</div><p>${j.reason}</p></div>`).join("")}`:"";
    // Dasha/Life Phase
    const dashaPhases=calcDasha(bday);const currentDasha=dashaPhases.find(d=>d.isCurrent);
    const dashaHTML=dashaPhases.length>0?`<h2>ğŸ—º Life Phase Map (Vedic Dasha)</h2>${currentDasha?`<div class="card" style="background:linear-gradient(135deg,#EEF2FF,#F5F3FF);border:2px solid #6366F1"><b style="color:#4338CA;font-size:14px">${currentDasha.icon} à¸•à¸­à¸™à¸™à¸µà¹‰à¸„à¸¸à¸“à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸Šà¹ˆà¸§à¸‡: ${currentDasha.theme}</b><div style="font-size:11px;margin-top:4px">à¸¡à¸«à¸²à¸—à¸¨à¸²${currentDasha.p} (à¸­à¸²à¸¢à¸¸ ${currentDasha.startAge}â€“${currentDasha.endAge} à¸›à¸µ | ${currentDasha.startYear}â€“${currentDasha.endYear})</div><div style="font-size:11px;margin-top:2px;color:#374151">${currentDasha.desc}</div><div style="font-size:11px;color:#059669;margin-top:2px">ğŸ¯ à¹‚à¸Ÿà¸à¸±à¸ª: ${currentDasha.focus}</div></div>`:""}${dashaPhases.filter(d=>!d.isPast||d.isCurrent).slice(0,6).map(d=>`<div style="display:flex;align-items:center;gap:8px;padding:4px 0;border-bottom:1px solid #F1F5F9;${d.isCurrent?"font-weight:700;color:#4338CA":"color:#374151"}"><span style="font-size:14px">${d.icon}</span><span style="font-size:11px;flex:1">${d.p} â€” ${d.theme}</span><span style="font-size:10px;color:#94A3B8">${d.startAge}â€“${d.endAge} à¸›à¸µ</span></div>`).join("")}`:"";
    // Build full PDF
    w.document.write(`<!DOCTYPE html><html><head><meta charset="utf-8"><title>HSS Report - ${nick}</title><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600;700&display=swap" rel="stylesheet"><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Noto Sans Thai',sans-serif;padding:40px;color:#1E293B;max-width:700px;margin:0 auto;font-size:13px;line-height:1.7}h1{font-size:22px;margin-bottom:8px}h2{font-size:15px;margin:24px 0 8px;color:#4338CA;border-bottom:2px solid #EEF2FF;padding-bottom:4px}.bar{height:8px;border-radius:4px;margin:4px 0 10px}.card{background:#F8FAFC;border-radius:10px;padding:12px;margin:6px 0}.g{display:grid;grid-template-columns:1fr 1fr;gap:8px}.tag{display:inline-block;padding:2px 8px;border-radius:6px;font-size:11px;font-weight:700}p{margin:3px 0}@media print{body{padding:20px}}</style></head><body>
<h1>ğŸ”® ${nick} â€” Human System Studio</h1><p style="color:#64748B">Vedic Astrology + Psychology Â· ${new Date().toLocaleDateString("th-TH")}</p>
${ai.identity?`<h2>âœ¦ Identity Snapshot</h2><p>${ai.identity}</p>`:""}
<h2>ğŸ“Š 12 Dimensions</h2>${spiderSVG}
${Object.entries(scores).map(([k,v])=>`<div style="margin:6px 0"><div style="display:flex;justify-content:space-between"><span>${DM[k]?.icon} ${k} <span style="font-size:10px;color:#94A3B8">(${DM[k]?.pl})</span></span><b style="color:${DM[k]?.c}">${v.toFixed(1)}</b></div><div class="bar" style="background:#E2E8F0"><div style="height:100%;width:${v*10}%;background:${DM[k]?.c};border-radius:4px"></div></div></div>`).join("")}
<h2>ğŸ’ª à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡</h2><div class="g">${so.slice(0,4).map(([k,v])=>`<div class="card"><span class="tag" style="background:#ECFDF5;color:#059669">${v.toFixed(1)}</span> ${DM[k]?.icon} ${k}</div>`).join("")}</div>
<h2>âš ï¸ à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸²</h2><div class="g">${so.slice(-4).map(([k,v])=>`<div class="card"><span class="tag" style="background:#FFF1F2;color:#EF4444">${v.toFixed(1)}</span> ${DM[k]?.icon} ${k}</div>`).join("")}</div>
${ai.core?`<h2>ğŸ› 5 Core Analysis</h2><p style="white-space:pre-wrap">${ai.core}</p>`:""}
${ai["12d"]?`<h2>ğŸ“ 12D Deep Analysis</h2><p style="white-space:pre-wrap">${ai["12d"]}</p>`:""}
${ai.shadow?`<h2>ğŸŒ‘ Shadow Analysis</h2><p style="white-space:pre-wrap">${ai.shadow}</p>`:""}
${wk} ${en} ${jb} ${dashaHTML}
<p style="margin-top:30px;font-size:11px;color:#94A3B8;text-align:center">Human System Studio Â· Vedic Astrology + Psychology Â· ${new Date().toLocaleDateString("th-TH")}</p></body></html>`);w.document.close();setTimeout(()=>w.print(),500)};

  const shareProfile=()=>{if(!scores||!nick)return;const data=btoa(unescape(encodeURIComponent(JSON.stringify({n:nick,s:scores}))));navigator.clipboard?.writeText(`${window.location.origin}?p=${data}`);alert("à¸„à¸±à¸”à¸¥à¸­à¸à¸¥à¸´à¸‡à¸à¹Œà¹à¸¥à¹‰à¸§!")};

  // Login/Signup Modal rendered inline with stable input refs
  const loginModalJSX=loginModal&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999,padding:20}} onClick={()=>{setLoginModal(false);setAuthErr("")}}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:24,maxWidth:360,width:"100%"}}>
  <div style={{fontSize:16,fontWeight:800,marginBottom:4}}>{authMode==="login"?"ğŸ” à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š":"âœ¨ à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸"}</div>
  <div style={{fontSize:12,color:"#64748B",marginBottom:16}}>{authMode==="login"?"à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¹€à¸à¸·à¹ˆà¸­à¸‹à¸·à¹‰à¸­à¹à¸à¹‡à¸„à¹€à¸à¸ˆ":"à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µà¹ƒà¸«à¸¡à¹ˆ (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£)"}</div>
  {authErr&&<div style={{padding:"8px 12px",borderRadius:8,background:"#FEF2F2",border:"1px solid #FECACA",color:"#DC2626",fontSize:12,marginBottom:12}}>{authErr}</div>}
  <div style={{marginBottom:12}}><label style={{fontSize:12,fontWeight:600,color:"#64748B",display:"block",marginBottom:4}}>à¸­à¸µà¹€à¸¡à¸¥</label><input key="auth-email-input" ref={authEmailRef} defaultValue="" placeholder="your@email.com" type="email" autoComplete="email" style={{width:"100%",padding:"10px 14px",fontSize:14,border:"2px solid #E2E8F0",borderRadius:10,outline:"none",boxSizing:"border-box"}}/></div>
  <div style={{marginBottom:16}}><label style={{fontSize:12,fontWeight:600,color:"#64748B",display:"block",marginBottom:4}}>à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™</label><input key="auth-pw-input" ref={authPwRef} defaultValue="" type="password" placeholder={authMode==="signup"?"à¸•à¸±à¹‰à¸‡à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™ (à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 6 à¸•à¸±à¸§)":"à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™"} autoComplete={authMode==="signup"?"new-password":"current-password"} onKeyDown={e=>{if(e.key==="Enter"){authMode==="login"?doLogin():doSignup()}}} style={{width:"100%",padding:"10px 14px",fontSize:14,border:"2px solid #E2E8F0",borderRadius:10,outline:"none",boxSizing:"border-box"}}/></div>
  <Btn onClick={authMode==="login"?doLogin:doSignup} ok={!authLoading}>{authLoading?"à¸à¸³à¸¥à¸±à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£...":authMode==="login"?"à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š â†’":"à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸ â†’"}</Btn>
  <div style={{textAlign:"center",marginTop:12}}><button onClick={()=>{setAuthMode(authMode==="login"?"signup":"login");setAuthErr("")}} style={{background:"none",border:"none",fontSize:12,color:"#6366F1",fontWeight:600,cursor:"pointer"}}>{authMode==="login"?"à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸šà¸±à¸à¸Šà¸µ? à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸":"à¸¡à¸µà¸šà¸±à¸à¸Šà¸µà¹à¸¥à¹‰à¸§? à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š"}</button></div>
  <div style={{display:"flex",alignItems:"center",gap:8,margin:"12px 0"}}><div style={{flex:1,height:1,background:"#E2E8F0"}}/><span style={{fontSize:11,color:"#94A3B8"}}>à¸«à¸£à¸·à¸­</span><div style={{flex:1,height:1,background:"#E2E8F0"}}/></div>
  <button onClick={doGoogle} disabled={authLoading} style={{width:"100%",padding:10,borderRadius:8,border:"2px solid #E2E8F0",background:"#fff",fontSize:13,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}><svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>à¹€à¸‚à¹‰à¸²à¸”à¹‰à¸§à¸¢ Google</button>
  </div></div>;

  // â”€â”€â”€ LANDING â”€â”€â”€
  const Landing=()=><div style={{minHeight:"100vh"}}><div style={{display:"flex",justifyContent:"flex-end",padding:"12px 20px 0"}}>{logged?<div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:11,color:"#64748B"}}>{user?.email?.split("@")[0]}</span><button onClick={doLogout} style={{fontSize:11,color:"#64748B",background:"none",border:"1px solid #E2E8F0",borderRadius:6,padding:"4px 10px",cursor:"pointer"}}>à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š</button></div>:<button onClick={()=>{setLoginModal(true);setAuthErr("");setAuthMode("login")}} style={{fontSize:12,fontWeight:600,color:"#4338CA",background:"#EEF2FF",border:"1px solid #C7D2FE",borderRadius:8,padding:"6px 16px",cursor:"pointer"}}>à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š / à¸ªà¸¡à¸±à¸„à¸£</button>}</div><div style={{textAlign:"center",padding:"40px 20px 40px",position:"relative",overflow:"hidden"}}><div style={{position:"absolute",inset:0,background:"radial-gradient(ellipse at 30% 20%,rgba(67,56,202,.08),transparent 60%),radial-gradient(ellipse at 70% 80%,rgba(139,92,246,.06),transparent 50%)",zIndex:0}}/><div style={{position:"relative",zIndex:1}}><div style={{width:52,height:52,borderRadius:14,background:"linear-gradient(135deg,#4338CA,#6D28D9)",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:24,color:"#fff",boxShadow:"0 8px 24px rgba(67,56,202,.3)",animation:"hfl 3s ease-in-out infinite",marginBottom:16}}>âœ¦</div><h1 style={{fontSize:26,fontWeight:800,color:"#1E293B",marginBottom:6}}>{BRAND}</h1><p style={{fontSize:15,fontWeight:600,color:"#4338CA",marginBottom:6}}>à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸•à¸±à¸§à¹€à¸­à¸‡à¸­à¸¢à¹ˆà¸²à¸‡à¹à¸¡à¹ˆà¸™à¸¢à¸³</p><p style={{fontSize:13,color:"#64748B",lineHeight:1.7,maxWidth:380,margin:"0 auto 20px"}}>à¸”à¹‰à¸§à¸¢ AI + Vedic Astrology + à¹à¸šà¸šà¸›à¸£à¸°à¹€à¸¡à¸´à¸™ 36 à¸„à¸³à¸–à¸²à¸¡</p><div style={{maxWidth:280,margin:"0 auto"}}><Btn onClick={()=>setSc("profile")}>à¹€à¸£à¸´à¹ˆà¸¡à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸Ÿà¸£à¸µ â†’</Btn>{logged&&scores&&<button onClick={()=>setSc("results")} style={{width:"100%",marginTop:8,padding:10,borderRadius:8,border:"2px solid #6366F1",background:"#fff",color:"#4338CA",fontSize:13,fontWeight:700,cursor:"pointer"}}>ğŸ“Š à¸”à¸¹à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¹€à¸”à¸´à¸¡</button>}</div></div></div><div style={{padding:"0 20px",maxWidth:520,margin:"0 auto"}}><Card style={{background:"linear-gradient(135deg,#F5F3FF,#EEF2FF)",border:"1px solid #DDD6FE"}}><h3 style={{fontSize:14,fontWeight:700,color:"#4338CA",marginBottom:6}}>ğŸ” à¸—à¸³à¹„à¸¡à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ "à¸”à¸§à¸‡ + à¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡" à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™?</h3><p style={{fontSize:12,color:"#374151",lineHeight:1.7}}>à¹€à¸à¸£à¸²à¸°à¸šà¸²à¸‡à¸„à¸™ "à¸”à¸§à¸‡à¸”à¸µ" à¹à¸•à¹ˆà¹ƒà¸Šà¹‰à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™ à¸šà¸²à¸‡à¸„à¸™ "à¸¨à¸±à¸à¸¢à¸ à¸²à¸à¸à¸¥à¸²à¸‡" à¹à¸•à¹ˆà¸šà¸£à¸´à¸«à¸²à¸£à¸•à¸±à¸§à¹€à¸­à¸‡à¹€à¸à¹ˆà¸‡</p><div style={{marginTop:10,padding:10,background:"#fff",borderRadius:8,textAlign:"center"}}><p style={{fontSize:14,fontWeight:700,color:"#6D28D9"}}>à¸¨à¸±à¸à¸¢à¸ à¸²à¸à¸à¸³à¹€à¸™à¸´à¸” Ã— à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡</p></div></Card><div style={{marginBottom:16}}><h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>3 à¸Šà¸±à¹‰à¸™à¸à¸²à¸£à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ</h3>{[{i:"ğŸª",t:"Vedic Astrology",d:"à¸¨à¸±à¸à¸¢à¸ à¸²à¸à¸à¸³à¹€à¸™à¸´à¸”à¸ˆà¸²à¸à¸§à¸±à¸™ à¹€à¸§à¸¥à¸² à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¸”"},{i:"ğŸ“‹",t:"Psychology 36 à¸‚à¹‰à¸­",d:"à¸§à¸±à¸”à¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¸ˆà¸£à¸´à¸‡"},{i:"ğŸ¤–",t:"AI Insight Engine",d:"à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸ªà¸£à¸¸à¸›à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¸ˆà¸£à¸´à¸‡"}].map((x,i)=><Card key={i} style={{display:"flex",gap:10,alignItems:"center"}}><div style={{width:38,height:38,borderRadius:10,background:"#F5F3FF",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,flexShrink:0}}>{x.i}</div><div><div style={{fontSize:13,fontWeight:700}}>{x.t}</div><div style={{fontSize:11,color:"#64748B"}}>{x.d}</div></div></Card>)}</div><h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>à¹à¸à¹‡à¸„à¹€à¸à¸ˆ</h3>{[{p:"free",t:"ğŸŸ¢ Free",pr:"à¸¿0",d:"à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸•à¸±à¸§à¹€à¸­à¸‡",it:["Identity Snapshot (AI)","5 Core Scores + à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢"]},{p:"deep",t:"ğŸŸ¡ Deep Insight",pr:"à¸¿99",d:"à¹€à¸«à¹‡à¸™à¸ à¸²à¸ \"à¸—à¸±à¹‰à¸‡à¸£à¸°à¸šà¸š\"",badge:"à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡",it:["à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡/à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸² 12 à¸¡à¸´à¸•à¸´","Shadow Analysis à¹€à¸Šà¸´à¸‡à¸¥à¸¶à¸","Do & Don't à¸£à¸²à¸¢à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ","7-Day Energy Forecast"]},{p:"all",t:"ğŸ”µ All Access",pr:"à¸¿249",d:"à¹ƒà¸Šà¹‰ Insight à¸à¸±à¸šà¸Šà¸µà¸§à¸´à¸•à¸ˆà¸£à¸´à¸‡",badge:"à¸„à¸¸à¹‰à¸¡à¸—à¸µà¹ˆà¸ªà¸¸à¸”",it:["Job Matching AI","Life Phase Map (Dasha)","PDF Report","Shareable Profile"]}].map((x,i)=><Card key={i} style={{position:"relative",border:x.badge?`2px solid ${PLANS[x.p].c}`:"1px solid #F1F5F9"}}>{x.badge&&<span style={{position:"absolute",top:-10,right:12,background:PLANS[x.p].c,color:"#fff",fontSize:10,fontWeight:800,padding:"2px 10px",borderRadius:8}}>{x.badge}</span>}<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}><span style={{fontSize:14,fontWeight:700}}>{x.t}</span><span style={{fontSize:17,fontWeight:800,color:PLANS[x.p].c}}>{x.pr}</span></div><p style={{fontSize:11,color:"#64748B",marginBottom:6}}>{x.d}</p>{x.it.map((it,j)=><div key={j} style={{fontSize:11,color:"#374151",padding:"2px 0"}}>âœ” {it}</div>)}</Card>)}<Card style={{padding:12,overflow:"auto"}}><table style={{width:"100%",borderCollapse:"collapse",fontSize:10}}><thead><tr style={{background:"#F8FAFC"}}><th style={{textAlign:"left",padding:"5px 6px",fontWeight:700,color:"#64748B"}}>à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œ</th><th style={{textAlign:"center",padding:"5px 4px",fontWeight:700,color:"#10B981"}}>Free</th><th style={{textAlign:"center",padding:"5px 4px",fontWeight:700,color:"#F59E0B"}}>à¸¿99</th><th style={{textAlign:"center",padding:"5px 4px",fontWeight:700,color:"#3B82F6"}}>à¸¿249</th></tr></thead><tbody>{FT.map(([n,,f,d,a],i)=><tr key={i} style={{borderBottom:"1px solid #F1F5F9"}}><td style={{padding:"5px 6px"}}>{n}</td><td style={{textAlign:"center"}}>{f?"âœ…":"â€”"}</td><td style={{textAlign:"center"}}>{d?"âœ…":"â€”"}</td><td style={{textAlign:"center"}}>{a?"âœ…":"â€”"}</td></tr>)}</tbody></table></Card><Card style={{background:"#F0FDF4",border:"1px solid #BBF7D0"}}><div style={{fontSize:12,fontWeight:700,color:"#166534",marginBottom:4}}>ğŸ›¡ à¸„à¸§à¸²à¸¡à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§</div><div style={{fontSize:11,color:"#15803D"}}>à¹„à¸¡à¹ˆà¸‚à¸²à¸¢à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Â· à¹„à¸¡à¹ˆà¹€à¸œà¸¢à¹à¸à¸£à¹ˆà¸œà¸¥ Â· à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¹€à¸›à¹‡à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“</div></Card><div style={{padding:"16px 0 40px"}}><Btn onClick={()=>setSc("profile")}>à¹€à¸£à¸´à¹ˆà¸¡ Identity Snapshot à¸Ÿà¸£à¸µ â†’</Btn></div></div></div>;

  // â”€â”€â”€ PROFILE (fixed input) â”€â”€â”€
  const Profile=()=>{const inp={width:"100%",padding:"10px 14px",fontSize:14,border:"2px solid #E2E8F0",borderRadius:10,outline:"none",background:"#fff",boxSizing:"border-box"};const lbl={fontSize:12,fontWeight:600,color:"#64748B",marginBottom:4,display:"block"};const bp=bday.split("-");const ok=nick&&email&&bp.length===3&&bp[0]&&bp[1]&&bp[2]&&bp[0]!=="undefined"&&(knowT===true?(btime&&btime.includes(":")):(knowT===false?tSlot:false));
  return<div><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:14}}><button onClick={()=>setSc("landing")} style={{background:"none",border:"none",fontSize:18,cursor:"pointer"}}>â†</button><div><div style={{fontSize:16,fontWeight:800}}>à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸„à¸¸à¸“</div><div style={{fontSize:11,color:"#94A3B8"}}>à¸ªà¸³à¸«à¸£à¸±à¸š Vedic + à¸à¸¤à¸•à¸´à¸à¸£à¸£à¸¡</div></div></div>
  <Card>
  <div style={{marginBottom:12}}><label style={lbl}>à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™ *</label><input ref={nickRef} defaultValue={nick} onBlur={e=>setNick(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")e.target.blur()}} placeholder="à¹€à¸Šà¹ˆà¸™ à¸¡à¸´à¸§" style={inp}/></div>
  <div style={{marginBottom:12}}><label style={lbl}>à¸­à¸µà¹€à¸¡à¸¥ *</label><input ref={emailRef} defaultValue={email} onBlur={e=>setEmail(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")e.target.blur()}} placeholder="your@email.com" type="email" style={inp}/></div>
  <div style={{marginBottom:12}}><label style={lbl}>à¸§à¸±à¸™à¹€à¸à¸´à¸” *</label><div style={{display:"flex",gap:6,marginBottom:6}}><select value={bp[2]||""} onChange={e=>setBday(`${bp[0]||"2000"}-${bp[1]||"01"}-${e.target.value}`)} style={{...inp,flex:1}}><option value="">à¸§à¸±à¸™</option>{Array.from({length:31},(_,i)=>i+1).map(d=><option key={d} value={String(d).padStart(2,"0")}>{d}</option>)}</select><select value={bp[1]||""} onChange={e=>setBday(`${bp[0]||"2000"}-${e.target.value}-${bp[2]||"01"}`)} style={{...inp,flex:1.2}}><option value="">à¹€à¸”à¸·à¸­à¸™</option>{["à¸¡.à¸„.","à¸.à¸.","à¸¡à¸µ.à¸„.","à¹€à¸¡.à¸¢.","à¸.à¸„.","à¸¡à¸´.à¸¢.","à¸.à¸„.","à¸ª.à¸„.","à¸.à¸¢.","à¸•.à¸„.","à¸.à¸¢.","à¸˜.à¸„."].map((m,i)=><option key={i} value={String(i+1).padStart(2,"0")}>{m}</option>)}</select><select value={bp[0]||""} onChange={e=>setBday(`${e.target.value}-${bp[1]||"01"}-${bp[2]||"01"}`)} style={{...inp,flex:1}}><option value="">à¸›à¸µ</option>{Array.from({length:80},(_,i)=>2026-i).map(y=><option key={y} value={String(y)}>{y}({y+543})</option>)}</select></div><button onClick={()=>{const t=new Date();setBday(`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`)}} style={{fontSize:11,color:"#6366F1",background:"#EEF2FF",border:"1px solid #C7D2FE",borderRadius:6,padding:"4px 10px",cursor:"pointer"}}>ğŸ“… à¹ƒà¸Šà¹‰à¸§à¸±à¸™à¸™à¸µà¹‰</button></div>
  <div style={{marginBottom:12}}><label style={lbl}>à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸” *</label><div style={{display:"flex",gap:6,marginBottom:8}}><button onClick={()=>{setKnowT(true);setTSlot("")}} style={{flex:1,padding:8,borderRadius:8,border:`2px solid ${knowT===true?"#6366F1":"#E2E8F0"}`,background:knowT===true?"#EEF2FF":"#fff",fontSize:12,fontWeight:600,cursor:"pointer",color:knowT===true?"#4338CA":"#64748B"}}>à¸£à¸¹à¹‰à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”</button><button onClick={()=>{setKnowT(false);setBtime("")}} style={{flex:1,padding:8,borderRadius:8,border:`2px solid ${knowT===false?"#F59E0B":"#E2E8F0"}`,background:knowT===false?"#FFFBEB":"#fff",fontSize:12,fontWeight:600,cursor:"pointer",color:knowT===false?"#92400E":"#64748B"}}>à¹„à¸¡à¹ˆà¸£à¸¹à¹‰à¹€à¸§à¸¥à¸²à¹€à¸à¸´à¸”</button></div>{knowT===true&&<div style={{display:"flex",gap:6}}><select value={btime.split(":")[0]||""} onChange={e=>setBtime(`${e.target.value}:${btime.split(":")[1]||"00"}`)} style={{...inp,flex:1}}><option value="">à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡</option>{Array.from({length:24},(_,i)=>i).map(h=><option key={h} value={String(h).padStart(2,"0")}>{String(h).padStart(2,"0")}à¸™.</option>)}</select><select value={btime.split(":")[1]||""} onChange={e=>setBtime(`${btime.split(":")[0]||"00"}:${e.target.value}`)} style={{...inp,flex:1}}><option value="">à¸™à¸²à¸—à¸µ</option>{[0,5,10,15,20,25,30,35,40,45,50,55].map(m=><option key={m} value={String(m).padStart(2,"0")}>{String(m).padStart(2,"0")}à¸™à¸²à¸—à¸µ</option>)}</select></div>}{knowT===false&&<div style={{display:"flex",flexDirection:"column",gap:4}}>{TS.map(ts=><button key={ts.id} onClick={()=>setTSlot(ts.id)} style={{padding:"10px 12px",borderRadius:8,border:`2px solid ${tSlot===ts.id?"#F59E0B":"#E2E8F0"}`,background:tSlot===ts.id?"#FFFBEB":"#fff",textAlign:"left",cursor:"pointer"}}><div style={{fontSize:12,fontWeight:tSlot===ts.id?700:500,color:tSlot===ts.id?"#92400E":"#374151"}}>{ts.l}</div><div style={{fontSize:10,color:"#94A3B8"}}>{ts.d}</div></button>)}</div>}</div>
  <div style={{marginBottom:14}}><label style={lbl}>à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</label><select value={prov} onChange={e=>setProv(e.target.value)} style={{...inp,appearance:"auto"}}><option value="">à¹€à¸¥à¸·à¸­à¸à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</option>{PV.map(p=><option key={p} value={p}>{p}</option>)}</select></div>
  <Btn ok={ok} onClick={ok?goQuiz:undefined}>à¹€à¸£à¸´à¹ˆà¸¡à¹à¸šà¸šà¸›à¸£à¸°à¹€à¸¡à¸´à¸™ 36 à¸‚à¹‰à¸­ â†’</Btn></Card></div>};

  // â”€â”€â”€ QUIZ â”€â”€â”€
  const Quiz=()=>{const q=ALL_Q[qI];const key=`${q.dim}-${q.qi}`;const pct=((qI+1)/36*100);const allD=Object.keys(ans).length>=36;
  return<div><div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}><span style={{fontSize:12,fontWeight:700,color:"#64748B"}}>{qI+1}/36</span><span style={{fontSize:10,color:"#94A3B8"}}>{q.dim}</span></div><div style={{height:4,background:"#E2E8F0",borderRadius:2,overflow:"hidden",marginBottom:12}}><div style={{height:"100%",width:`${pct}%`,background:"linear-gradient(90deg,#4338CA,#A78BFA)",borderRadius:2,transition:"width .3s"}}/></div><Card><div style={{display:"inline-flex",alignItems:"center",gap:4,padding:"2px 10px",borderRadius:10,background:`${q.c}15`,marginBottom:8,fontSize:10,fontWeight:600,color:q.c}}>{q.icon} {q.dim} Â· {q.pl}</div><p style={{fontSize:14,fontWeight:500,lineHeight:1.7,marginBottom:12,color:"#1E293B"}}>{q.q}</p><div style={{display:"flex",flexDirection:"column",gap:4}}>{SCALE.map((l,i)=><button key={i} onClick={()=>answer(i)} style={{padding:"9px 12px",fontSize:12,fontWeight:ans[key]===i?700:500,border:`2px solid ${ans[key]===i?"#4338CA":"#E2E8F0"}`,borderRadius:8,cursor:"pointer",textAlign:"left",background:ans[key]===i?"#EEF2FF":"#fff",color:ans[key]===i?"#4338CA":"#374151",display:"flex",alignItems:"center",gap:8}}><span style={{width:20,height:20,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:700,background:ans[key]===i?"#4338CA":"#F1F5F9",color:ans[key]===i?"#fff":"#94A3B8",flexShrink:0}}>{i}</span>{l}</button>)}</div></Card><div style={{display:"flex",gap:8,marginTop:8}}><button onClick={()=>setQI(Math.max(0,qI-1))} disabled={qI===0} style={{flex:1,padding:10,border:"2px solid #E2E8F0",borderRadius:8,background:"#fff",fontSize:12,fontWeight:600,cursor:qI>0?"pointer":"not-allowed",color:qI>0?"#374151":"#CBD5E1"}}>â†</button>{allD?<Btn onClick={finish} style={{flex:2}}>à¸”à¸¹à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ âœ¦</Btn>:<button onClick={()=>{if(ans[key]!==undefined&&qI<35)setQI(qI+1)}} style={{flex:2,padding:10,borderRadius:8,border:"none",background:ans[key]!==undefined?"linear-gradient(135deg,#4338CA,#6D28D9)":"#E2E8F0",color:ans[key]!==undefined?"#fff":"#94A3B8",fontSize:12,fontWeight:600,cursor:ans[key]!==undefined?"pointer":"not-allowed"}}>à¸–à¸±à¸”à¹„à¸› â†’</button>}</div></div>};

  // â”€â”€â”€ RESULTS â”€â”€â”€
  const Sec=({fKey,title,icon,children})=>{const ok=has(fKey);return<Card style={{position:"relative"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:ok?8:4}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:15}}>{icon}</span><span style={{fontSize:13,fontWeight:700}}>{title}</span></div>{!ok&&<span style={{fontSize:10,fontWeight:700,color:"#6366F1",background:"#EEF2FF",padding:"2px 8px",borderRadius:8}}>ğŸ”’</span>}</div>{ok?children:<><p style={{fontSize:11,color:"#94A3B8",marginBottom:6}}>à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹</p><div style={{display:"flex",gap:6}}>{plan==="free"&&<button onClick={()=>tryUpgrade("deep")} style={{flex:1,padding:7,borderRadius:8,border:"2px solid #F59E0B",background:"#FFFBEB",color:"#92400E",fontSize:11,fontWeight:700,cursor:"pointer"}}>Deep à¸¿99</button>}{plan!=="all"&&<button onClick={()=>tryUpgrade("all")} style={{flex:1,padding:7,borderRadius:8,border:"none",background:"linear-gradient(135deg,#4338CA,#6D28D9)",color:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"}}>All à¸¿249</button>}</div></>}</Card>};

  const Results=()=>{if(!scores)return null;const so=Object.entries(scores).sort((a,b)=>b[1]-a[1]);const c5={"Cognitive Processing":scores["Cognitive Processing"],"Emotional Regulation":scores["Emotional Regulation"],"Identity Stability":scores["Identity Stability"],"Shadow Pattern":scores["Shadow Pattern"],"Growth Orientation":scores["Growth Orientation"]};
  return<div>
  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}><div><div style={{display:"flex",alignItems:"center",gap:6}}><div style={{width:26,height:26,borderRadius:8,background:"linear-gradient(135deg,#4338CA,#6D28D9)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:"#fff"}}>âœ¦</div><span style={{fontSize:14,fontWeight:800}}>{nick}</span></div><span style={{fontSize:10,color:"#94A3B8"}}>{PLANS[plan].name}{logged?` Â· ${user?.email?.split("@")[0]}`:""}</span></div><div style={{display:"flex",alignItems:"center",gap:4}}>{plan!=="free"&&<span style={{fontSize:10,fontWeight:700,color:"#fff",background:PLANS[plan].c,padding:"3px 10px",borderRadius:8}}>{PLANS[plan].name}</span>}{logged&&<button onClick={doLogout} style={{fontSize:10,color:"#94A3B8",background:"none",border:"1px solid #E2E8F0",borderRadius:6,padding:"3px 8px",cursor:"pointer"}}>à¸­à¸­à¸</button>}</div></div>

  {plan==="free"&&<Card style={{background:"linear-gradient(135deg,#EEF2FF,#F5F3FF)",border:"2px solid #6366F1"}}><div style={{fontSize:12,fontWeight:700,color:"#4338CA",marginBottom:6}}>ğŸ”“ à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¸„à¸§à¸²à¸¡à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸•à¸±à¸§à¹€à¸­à¸‡</div><div style={{display:"flex",gap:6}}><button onClick={()=>tryUpgrade("deep")} style={{flex:1,padding:7,borderRadius:8,border:"2px solid #F59E0B",background:"#fff",color:"#92400E",fontSize:11,fontWeight:700,cursor:"pointer"}}>Deep à¸¿99</button><button onClick={()=>tryUpgrade("all")} style={{flex:1,padding:7,borderRadius:8,border:"none",background:"linear-gradient(135deg,#4338CA,#6D28D9)",color:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"}}>All à¸¿249</button></div></Card>}

  <Sec fKey="identity" title="Identity Snapshot" icon="âœ¦">{ai.identity?<Typer text={ai.identity}/>:aiL.identity?<Spin/>:<Spin t="à¹€à¸Šà¸·à¹ˆà¸­à¸¡ AI..."/>}</Sec>
  <Sec fKey="core5" title="5 Core Scores" icon="ğŸ“Š">{Object.entries(c5).map(([d,s])=><div key={d} style={{marginBottom:8}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}><span style={{fontSize:11,fontWeight:600}}>{DM[d]?.icon} {d} <span style={{fontSize:9,color:"#94A3B8"}}>({DM[d]?.pl})</span></span><span style={{fontSize:11,fontWeight:700,color:DM[d]?.c}}>{s.toFixed(1)}</span></div><div style={{height:5,background:"#F1F5F9",borderRadius:3,overflow:"hidden"}}><div style={{height:"100%",width:`${s*10}%`,background:DM[d]?.c,borderRadius:3}}/></div></div>)}<div style={{marginTop:8,padding:8,background:"#F8FAFC",borderRadius:8}}>{aiL.core?<Spin/>:ai.core?<Typer text={ai.core}/>:<Spin t="à¸£à¸­ AI..."/>}</div></Sec>

  {/* Locked preview: 12D */}
  {!has("12d")?<Locked planNeeded="deep" title="12D Spider Web + à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡/à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸²" onUpgrade={tryUpgrade}><div style={{textAlign:"center",padding:16}}><Spider scores={scores}/></div><div style={{padding:"8px 0"}}><div style={{fontSize:12,marginBottom:4}}>ğŸ’ª à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡: {so.slice(0,3).map(([k,v])=>`${DM[k]?.icon}${k}(${v.toFixed(1)})`).join(" Â· ")}</div><div style={{fontSize:12}}>âš ï¸ à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸²: {so.slice(-3).map(([k,v])=>`${DM[k]?.icon}${k}(${v.toFixed(1)})`).join(" Â· ")}</div></div></Locked>:<Sec fKey="12d" title="12D Spider Web" icon="ğŸ•¸ï¸"><div style={{display:"flex",justifyContent:"center",marginBottom:8}}><Spider scores={scores}/></div><div style={{marginBottom:6}}><div style={{fontSize:11,fontWeight:700,color:"#10B981",marginBottom:3}}>ğŸ’ª à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡</div>{so.slice(0,4).map(([d,s])=><div key={d} style={{padding:"4px 8px",borderRadius:6,background:"#ECFDF5",border:"1px solid #A7F3D0",marginBottom:2,display:"flex",justifyContent:"space-between",fontSize:11}}><span>{DM[d]?.icon} {d}</span><span style={{fontWeight:700,color:"#059669"}}>{s.toFixed(1)}</span></div>)}</div><div><div style={{fontSize:11,fontWeight:700,color:"#EF4444",marginBottom:3}}>âš ï¸ à¸ˆà¸¸à¸”à¸à¸±à¸’à¸™à¸²</div>{so.slice(-4).map(([d,s])=><div key={d} style={{padding:"4px 8px",borderRadius:6,background:"#FFF1F2",border:"1px solid #FECDD3",marginBottom:2,display:"flex",justifyContent:"space-between",fontSize:11}}><span>{DM[d]?.icon} {d}</span><span style={{fontWeight:700,color:"#EF4444"}}>{s.toFixed(1)}</span></div>)}</div>{aiL["12d"]?<Spin/>:ai["12d"]?<div style={{marginTop:8,padding:8,background:"#F8FAFC",borderRadius:8}}><Typer text={ai["12d"]}/></div>:null}</Sec>}

  {/* Locked preview: Shadow */}
  {!has("shadow")?<Locked planNeeded="deep" title="Shadow Analysis à¹€à¸Šà¸´à¸‡à¸¥à¸¶à¸" onUpgrade={tryUpgrade}><div style={{padding:12,borderRadius:10,background:"#1E293B",color:"#fff",marginBottom:8}}><div style={{fontSize:13,fontWeight:700,marginBottom:4}}>ğŸŒ‘ Shadow Pattern: {scores["Shadow Pattern"]?.toFixed(1)}/10</div><div style={{fontSize:11,color:"#94A3B8"}}>Stress Response: {scores["Stress Response"]?.toFixed(1)} Â· Boundary: {scores["Boundary System"]?.toFixed(1)}</div></div><div style={{fontSize:12,lineHeight:1.8,color:"#374151"}}>âš¡ Trigger à¸«à¸¥à¸±à¸: à¸£à¸²à¸«à¸¹à¸Šà¸µà¹‰à¸§à¹ˆà¸²à¸„à¸¸à¸“à¸¡à¸±à¸à¸–à¸¹à¸à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¹€à¸¡à¸·à¹ˆà¸­...<br/>ğŸ”„ Pattern à¸‹à¹‰à¸³: à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸ˆà¸­ trigger à¸„à¸¸à¸“à¸¡à¸±à¸à¹€à¸¥à¸·à¸­à¸...<br/>ğŸ’¡ à¸§à¸´à¸˜à¸µà¹à¸à¹‰: à¸à¸¶à¸à¸ˆà¸±à¸šà¸ªà¸±à¸à¸à¸²à¸“à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢...</div></Locked>:<Sec fKey="shadow" title="Shadow Analysis" icon="ğŸŒ‘"><div style={{padding:10,borderRadius:10,background:"linear-gradient(135deg,#1E293B,#334155)",color:"#fff",marginBottom:6}}><div style={{fontSize:12,fontWeight:700}}>ğŸŒ‘ Shadow: {scores["Shadow Pattern"]?.toFixed(1)}/10</div></div>{aiL.shadow?<Spin/>:ai.shadow?<Typer text={ai.shadow}/>:<Spin t="à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹€à¸‡à¸²à¸¡à¸·à¸”..."/>}</Sec>}

  {/* Locked preview: Weekly */}
  {!has("weekly")?<Locked planNeeded="deep" title="Do & Don't à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸™à¸µà¹‰" onUpgrade={tryUpgrade}><div style={{marginBottom:8}}><div style={{fontSize:12,fontWeight:700,color:"#10B981",marginBottom:4}}>âœ… à¸„à¸§à¸£à¸—à¸³</div><div style={{padding:"6px 10px",borderRadius:6,background:"#ECFDF5",fontSize:11,marginBottom:3}}>à¹ƒà¸Šà¹‰à¸ˆà¸¸à¸”à¹à¸‚à¹‡à¸‡à¸—à¸µà¹ˆà¸”à¸²à¸§à¸«à¸™à¸¸à¸™à¹ƒà¸«à¹‰à¹€à¸•à¹‡à¸¡à¸—à¸µà¹ˆ</div><div style={{padding:"6px 10px",borderRadius:6,background:"#ECFDF5",fontSize:11,marginBottom:3}}>à¸à¸¶à¸à¸ªà¸±à¸‡à¹€à¸à¸•à¸­à¸²à¸£à¸¡à¸“à¹Œà¸•à¸±à¸§à¹€à¸­à¸‡</div></div><div><div style={{fontSize:12,fontWeight:700,color:"#EF4444",marginBottom:4}}>âŒ à¸„à¸§à¸£à¹€à¸¥à¸µà¹ˆà¸¢à¸‡</div><div style={{padding:"6px 10px",borderRadius:6,background:"#FFF1F2",fontSize:11,marginBottom:3}}>à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸à¸²à¸£à¸•à¸±à¸”à¸ªà¸´à¸™à¹ƒà¸ˆà¹€à¸£à¹‡à¸§à¹€à¸à¸´à¸™à¹„à¸›</div><div style={{padding:"6px 10px",borderRadius:6,background:"#FFF1F2",fontSize:11}}>à¸­à¸¢à¹ˆà¸²à¸£à¸±à¸šà¸‡à¸²à¸™à¹€à¸à¸´à¸™à¸à¸³à¸¥à¸±à¸‡</div></div></Locked>:<Sec fKey="weekly" title="Do & Don't à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œà¸™à¸µà¹‰" icon="ğŸ“‹">{aiL.weekly?<Spin/>:ai.weekly&&typeof ai.weekly==="object"?<><div style={{fontSize:11,fontWeight:700,color:"#10B981",marginBottom:3}}>âœ… à¸„à¸§à¸£à¸—à¸³</div>{(ai.weekly.do||[]).map((t,i)=><div key={i} style={{padding:"5px 8px",borderRadius:6,background:"#ECFDF5",border:"1px solid #A7F3D0",fontSize:11,marginBottom:2}}>{t}</div>)}<div style={{fontSize:11,fontWeight:700,color:"#EF4444",marginBottom:3,marginTop:6}}>âŒ à¸„à¸§à¸£à¹€à¸¥à¸µà¹ˆà¸¢à¸‡</div>{(ai.weekly.dont||[]).map((t,i)=><div key={i} style={{padding:"5px 8px",borderRadius:6,background:"#FFF1F2",border:"1px solid #FECDD3",fontSize:11,marginBottom:2}}>{t}</div>)}</>:<Spin/>}</Sec>}

  {/* Locked preview: Energy */}
  {!has("energy")?<Locked planNeeded="deep" title="7-Day Energy Forecast" onUpgrade={tryUpgrade}><div style={{fontSize:12,fontWeight:700,marginBottom:8}}>ğŸŒ™ à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™ 7 à¸§à¸±à¸™ â€” Moon + Mars + Day Lord</div>{["à¸ˆà¸±à¸™à¸—à¸£à¹Œ â€” ğŸŒŸ à¸ªà¸”à¹ƒà¸ª-à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ","à¸­à¸±à¸‡à¸„à¸²à¸£ â€” ğŸ˜Š à¸ªà¸‡à¸šà¸¡à¸±à¹ˆà¸™à¸„à¸‡","à¸à¸¸à¸˜ â€” ğŸ”¥ à¸à¸£à¸°à¸•à¸·à¸­à¸£à¸·à¸­à¸£à¹‰à¸™","à¸à¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ â€” ğŸ“š à¸›à¸±à¸à¸à¸²à¹€à¸›à¸´à¸”","à¸¨à¸¸à¸à¸£à¹Œ â€” ğŸ’ à¸œà¹ˆà¸­à¸™à¸„à¸¥à¸²à¸¢","à¹€à¸ªà¸²à¸£à¹Œ â€” âš™ï¸ à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸§à¸´à¸™à¸±à¸¢","à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ â€” â˜€ï¸ à¸¡à¸µà¸à¸¥à¸±à¸‡"].map((d,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",padding:"5px 8px",borderRadius:6,background:i%2===0?"#F8FAFC":"#fff",fontSize:11,marginBottom:2}}><span>{d.split("â€”")[0]}</span><span style={{fontWeight:700}}>{d.split("â€”")[1]}</span></div>)}<div style={{fontSize:10,color:"#6366F1",marginTop:6}}>ğŸ”® à¸„à¸³à¸™à¸§à¸“à¸ˆà¸²à¸ Transit à¸ˆà¸±à¸™à¸—à¸£à¹Œ+à¸­à¸±à¸‡à¸„à¸²à¸£+à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™ Vedic</div></Locked>:<Sec fKey="energy" title="7-Day Energy" icon="ğŸŒ™">{aiL.energy?<Spin/>:ai.energy&&Array.isArray(ai.energy)?<>{ai.energy.map((d,i)=><div key={i} style={{padding:"8px 10px",borderRadius:8,marginBottom:3,background:i===0?"linear-gradient(135deg,#EEF2FF,#F5F3FF)":"#F8FAFC",border:i===0?"2px solid #6366F1":"1px solid #F1F5F9"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}}><div style={{display:"flex",alignItems:"center",gap:4}}><span style={{fontSize:12,fontWeight:700}}>{i===0?"ğŸ“ ":""}{d.day}</span><span style={{fontSize:9,color:"#94A3B8",background:"#fff",padding:"1px 4px",borderRadius:4}}>{d.date}</span></div></div><div style={{fontSize:12,fontWeight:600,color:"#374151",marginBottom:2}}>{d.mood}</div>{d.transit&&<div style={{fontSize:9,color:"#7C3AED"}}>ğŸª {d.transit}</div>}{d.goodFor&&<div style={{fontSize:10,color:"#059669",background:"#ECFDF5",borderRadius:4,padding:"2px 6px",marginTop:2}}>âœ… {d.goodFor}</div>}{d.tip&&<div style={{fontSize:10,color:"#374151",background:"#fff",borderRadius:4,padding:"2px 6px",marginTop:2,border:"1px solid #F1F5F9"}}>ğŸ’¡ {d.tip}</div>}</div>)}<div style={{marginTop:6,padding:8,background:"#F5F3FF",borderRadius:8}}><div style={{fontSize:10,fontWeight:700,color:"#4338CA",marginBottom:2}}>ğŸ”® Vedic Jyotish 3 à¸Šà¸±à¹‰à¸™</div><div style={{fontSize:9,color:"#64748B"}}>à¸ˆà¸±à¸™à¸—à¸£à¹ŒTransit(40%) + à¸­à¸±à¸‡à¸„à¸²à¸£(25%) + à¹€à¸ˆà¹‰à¸²à¸§à¸±à¸™(35%)</div></div></>:<Spin/>}</Sec>}

  {/* Locked preview: Job */}
  {!has("job")?<Locked planNeeded="all" title="Job Matching AI" onUpgrade={tryUpgrade}><div style={{fontSize:12,fontWeight:700,marginBottom:8}}>ğŸ’¼ AI à¹à¸™à¸°à¸™à¸³à¸­à¸²à¸Šà¸µà¸à¸ˆà¸²à¸ 12D Profile + Vedic</div>{[{t:"Data Analyst",m:88},{t:"Project Manager",m:82},{t:"UX Researcher",m:78}].map((j,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",padding:"8px 10px",borderRadius:6,background:"#F8FAFC",marginBottom:3,fontSize:12}}><span>{i+1}. {j.t}</span><span style={{fontWeight:700,color:"#4338CA"}}>Match {j.m}%</span></div>)}<div style={{display:"flex",gap:4,marginTop:4}}><div style={{padding:"5px 10px",borderRadius:6,background:"#0A66C2",color:"#fff",fontSize:10,fontWeight:700}}>ğŸ” à¸„à¹‰à¸™à¸«à¸²à¹ƒà¸™ LinkedIn</div></div></Locked>:<Sec fKey="job" title="Job Matching AI" icon="ğŸ’¼">{aiL.job?<Spin/>:ai.job&&Array.isArray(ai.job)?ai.job.map((j,i)=><div key={i} style={{padding:10,borderRadius:8,background:"#F8FAFC",marginBottom:4}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}><span style={{fontSize:13,fontWeight:700}}>{j.titleTH||j.title}</span><span style={{fontSize:10,fontWeight:700,color:"#4338CA",background:"#EEF2FF",padding:"2px 6px",borderRadius:6}}>{j.match}%</span></div>{j.dims&&<div style={{fontSize:10,color:"#6366F1",marginBottom:2}}>ğŸ“Š {j.dims}</div>}<div style={{fontSize:11,color:"#64748B",lineHeight:1.5}}>{j.reason}</div><a href={`https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(j.title)}&location=Thailand`} target="_blank" rel="noopener noreferrer" style={{display:"inline-flex",alignItems:"center",gap:4,marginTop:6,padding:"5px 12px",borderRadius:6,background:"#0A66C2",color:"#fff",fontSize:11,fontWeight:700,textDecoration:"none"}}>ğŸ” à¸„à¹‰à¸™à¸«à¸²à¸‡à¸²à¸™à¹ƒà¸™à¹„à¸—à¸¢ â€” LinkedIn</a></div>):<Spin/>}</Sec>}

  {/* Life Phase Map (Dasha) */}
  {!has("dasha")?<Locked planNeeded="all" title="Life Phase Map (Dasha)" onUpgrade={tryUpgrade}><div style={{fontSize:12,fontWeight:700,marginBottom:6}}>ğŸ—º à¹à¸œà¸™à¸—à¸µà¹ˆà¸Šà¹ˆà¸§à¸‡à¸Šà¸µà¸§à¸´à¸• â€” Vedic Dasha System</div>{["ğŸŒ€ à¹€à¸à¸•à¸¸ â€” à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²à¸•à¸±à¸§à¹€à¸­à¸‡","ğŸ’ à¸¨à¸¸à¸à¸£à¹Œ â€” à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ","â˜€ï¸ à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ â€” à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸•à¸±à¸§à¸•à¸™","ğŸŒ™ à¸ˆà¸±à¸™à¸—à¸£à¹Œ â€” à¸­à¸²à¸£à¸¡à¸“à¹Œà¹à¸¥à¸°à¸ˆà¸´à¸•à¹ƒà¸ˆ"].map((d,i)=><div key={i} style={{fontSize:11,padding:"3px 0",color:"#374151"}}>{d}</div>)}<div style={{fontSize:10,color:"#6366F1",marginTop:6}}>ğŸ”® à¸„à¸³à¸™à¸§à¸“à¸ˆà¸²à¸à¸™à¸±à¸à¸©à¸±à¸•à¸£ + à¸¡à¸«à¸²à¸—à¸¨à¸² Vedic Jyotish</div></Locked>:<Sec fKey="dasha" title="Life Phase Map" icon="ğŸ—º">{(()=>{const phases=calcDasha(bday);const current=phases.find(d=>d.isCurrent);return<>{current&&<Card style={{background:"linear-gradient(135deg,#EEF2FF,#F5F3FF)",border:"2px solid #6366F1"}}><div style={{fontSize:14,fontWeight:800,color:"#4338CA",marginBottom:4}}>{current.icon} à¸•à¸­à¸™à¸™à¸µà¹‰à¸„à¸¸à¸“à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸Šà¹ˆà¸§à¸‡: {current.theme}</div><div style={{fontSize:11,color:"#64748B"}}>à¸¡à¸«à¸²à¸—à¸¨à¸²{current.p} (à¸­à¸²à¸¢à¸¸ {current.startAge}â€“{current.endAge} à¸›à¸µ | à¸.à¸¨.{current.startYear+543}â€“{current.endYear+543})</div><div style={{fontSize:12,color:"#374151",marginTop:4}}>{current.desc}</div><div style={{fontSize:11,color:"#059669",marginTop:4,background:"#ECFDF5",padding:"4px 8px",borderRadius:6}}>ğŸ¯ à¹‚à¸Ÿà¸à¸±à¸ª: {current.focus}</div></Card>}<div style={{marginTop:8}}><div style={{fontSize:11,fontWeight:700,color:"#64748B",marginBottom:6}}>Timeline à¸Šà¹ˆà¸§à¸‡à¸Šà¸µà¸§à¸´à¸•</div>{phases.filter(d=>!d.isPast||d.isCurrent).slice(0,7).map((d,i)=><div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",borderRadius:8,marginBottom:2,background:d.isCurrent?"linear-gradient(135deg,#EEF2FF,#F5F3FF)":"#F8FAFC",border:d.isCurrent?"2px solid #6366F1":"1px solid #F1F5F9"}}><span style={{fontSize:16}}>{d.icon}</span><div style={{flex:1}}><div style={{fontSize:11,fontWeight:d.isCurrent?700:500,color:d.isCurrent?"#4338CA":"#374151"}}>{d.p} â€” {d.theme}</div><div style={{fontSize:9,color:"#94A3B8"}}>{d.desc}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:10,fontWeight:600,color:d.isCurrent?"#4338CA":"#64748B"}}>{d.startAge}â€“{d.endAge} à¸›à¸µ</div><div style={{fontSize:9,color:"#94A3B8"}}>{d.startYear+543}â€“{d.endYear+543}</div></div></div>)}</div><div style={{marginTop:8,padding:8,background:"#F5F3FF",borderRadius:8}}><div style={{fontSize:10,fontWeight:700,color:"#4338CA",marginBottom:2}}>ğŸ”® Vedic Dasha System</div><div style={{fontSize:9,color:"#64748B"}}>à¸„à¸³à¸™à¸§à¸“à¸ˆà¸²à¸à¸™à¸±à¸à¸©à¸±à¸•à¸£à¹€à¸à¸´à¸” à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸šà¸§à¸´à¸¡à¹‚à¸¨à¸•à¸•à¸£à¸µà¸—à¸¨à¸² 120 à¸›à¸µ à¸•à¸²à¸¡à¹‚à¸«à¸£à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸à¸£à¸°à¹€à¸§à¸—</div></div></>})()}</Sec>}

  {!has("pdf")?<Locked planNeeded="all" title="PDF Report à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”" onUpgrade={tryUpgrade}><div style={{fontSize:12,lineHeight:1.8}}>ğŸ“„ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸‰à¸šà¸±à¸šà¹€à¸•à¹‡à¸¡ à¸›à¸£à¸°à¸à¸­à¸šà¸”à¹‰à¸§à¸¢:<br/>â€¢ 12 Dimension Scores + Spider Chart<br/>â€¢ Identity + Shadow + 5 Core Analysis<br/>â€¢ Do & Don't + 7-Day Energy + transit<br/>â€¢ Job Matching + Life Phase Map</div></Locked>:<Sec fKey="pdf" title="PDF Report" icon="ğŸ“„"><Btn onClick={exportPDF} style={{fontSize:12,padding:8}}>ğŸ“„ à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸” PDF</Btn></Sec>}

  {!has("share")?<Locked planNeeded="all" title="Shareable Profile Link" onUpgrade={tryUpgrade}><div style={{fontSize:12,lineHeight:1.8}}>ğŸ”— à¹à¸Šà¸£à¹Œà¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œà¹ƒà¸«à¹‰à¹€à¸à¸·à¹ˆà¸­à¸™ à¹€à¸à¸·à¹ˆà¸­à¸™à¸£à¹ˆà¸§à¸¡à¸‡à¸²à¸™ à¸«à¸£à¸·à¸­à¹‚à¸„à¹‰à¸Š<br/>â€¢ à¸¥à¸´à¸‡à¸à¹Œà¹€à¸‰à¸à¸²à¸°à¸‚à¸­à¸‡à¸„à¸¸à¸“ à¸„à¸±à¸”à¸¥à¸­à¸à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ<br/>â€¢ à¹€à¸«à¹‡à¸™ Spider Web + Scores + Identity</div></Locked>:<Sec fKey="share" title="Share Profile" icon="ğŸ”—"><Btn onClick={shareProfile} style={{fontSize:12,padding:8,background:"linear-gradient(135deg,#059669,#10B981)"}}>ğŸ”— à¸„à¸±à¸”à¸¥à¸­à¸à¸¥à¸´à¸‡à¸à¹Œà¹à¸Šà¸£à¹Œ</Btn></Sec>}

  <div style={{textAlign:"center",padding:"14px 0 40px"}}><button onClick={()=>{setSc("landing");setScores(null);setVedic(null);setAns({});setAi({});setQI(0);setPlan("free");localStorage.clear()}} style={{fontSize:11,color:"#94A3B8",background:"none",border:"none",cursor:"pointer"}}>ğŸ”„ à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ</button></div></div>};

  return<div style={{fontFamily:"'Noto Sans Thai','DM Sans',-apple-system,sans-serif",minHeight:"100vh",background:"#F8FAFC",color:"#1E293B"}}><style>{css}</style>{loginModalJSX}<div style={{maxWidth:520,margin:"0 auto",padding:sc==="landing"?"0":"12px 16px 40px"}}>{sc==="landing"&&<Landing/>}{sc==="profile"&&<Profile/>}{sc==="quiz"&&<Quiz/>}{sc==="results"&&<Results/>}</div></div>;
}
