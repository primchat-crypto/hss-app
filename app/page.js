"use client";
import{useState,useEffect,useRef,useCallback}from"react";
import{createClient}from"@supabase/supabase-js";

const SB_URL=process.env.NEXT_PUBLIC_SUPABASE_URL;
const SB_KEY=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const sb=(SB_URL&&SB_KEY)?createClient(SB_URL,SB_KEY,{auth:{persistSession:true,storageKey:"hss-auth",storage:typeof window!=="undefined"?window.localStorage:undefined}}):null;

const BRAND="Human System Studio";
const PLANS={free:{name:"Free",price:0,tag:"üü¢",c:"#10B981",f:["identity","core5"]},deep:{name:"Deep Insight",price:49,tag:"üü°",c:"#F59E0B",badge:"Early Bird",f:["identity","core5","12d","shadow","weekly","energy"]},all:{name:"All Access",price:99,tag:"üîµ",c:"#3B82F6",badge:"Early Bird ‡∏Ñ‡∏∏‡πâ‡∏°‡∏™‡∏∏‡∏î",f:["identity","core5","12d","shadow","weekly","energy","job","dasha","pdf","share"]}};
const FT=[["Identity Snapshot (AI)","identity",1,1,1],["5 Core Scores + AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå","core5",1,1,1],["‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á / ‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤ 12 ‡∏°‡∏¥‡∏ï‡∏¥","12d",0,1,1],["Shadow Analysis ‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å","shadow",0,1,1],["Do & Don't ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå","weekly",0,1,1],["7-Day Energy Forecast","energy",0,1,1],["Job Matching AI","job",0,0,1],["Life Phase Map (Dasha)","dasha",0,0,1],["PDF Report ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î","pdf",0,0,1],["Social Share Card","share",0,0,1]];

const QG={A:{t:"The Foundation",dims:{"Cognitive Processing":{icon:"üß†",c:"#6366F1",pl:"‡∏û‡∏∏‡∏ò",q:["‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô ‡∏â‡∏±‡∏ô‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á","‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏≤‡∏Å ‡∏â‡∏±‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÑ‡∏î‡πâ","‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô ‡∏â‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡∏à‡∏∏‡∏î‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"]},"Emotional Regulation":{icon:"üåä",c:"#0EA5E9",pl:"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå",q:["‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏£‡∏á ‡∏â‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à","‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÑ‡∏°‡πà‡∏î‡∏µ ‡∏â‡∏±‡∏ô‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏≠‡∏¢‡πà‡∏≤‡∏á","‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏à‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡πÉ‡∏à ‡∏â‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1‚Äì2 ‡∏ß‡∏±‡∏ô"]},"Identity Stability":{icon:"‚öì",c:"#EC4899",pl:"‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå+‡πÄ‡∏™‡∏≤‡∏£‡πå",q:["‡∏â‡∏±‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏Å‡∏î‡∏î‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô","‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ï‡∏¥ ‡∏â‡∏±‡∏ô‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤","‡∏â‡∏±‡∏ô‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå"]}}},B:{t:"The Execution",dims:{"Energy Management":{icon:"‚ö°",c:"#F59E0B",pl:"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£",q:["‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏â‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á","‡∏â‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ö‡πà‡∏≠‡∏¢","‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡πâ‡∏≤ ‡∏â‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏∑‡πâ‡∏ô‡∏û‡∏•‡∏±‡∏á ‡πÅ‡∏ó‡∏ô‡∏ù‡∏∑‡∏ô‡∏ó‡∏≥‡∏ï‡πà‡∏≠"]},"Decision System":{icon:"‚öñÔ∏è",c:"#3B82F6",pl:"‡∏û‡∏§‡∏´‡∏±‡∏™+‡πÄ‡∏™‡∏≤‡∏£‡πå",q:["‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏â‡∏±‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á","‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏â‡∏±‡∏ô‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏¢‡πâ‡∏≠‡∏ô‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏ã‡πâ‡∏≥","‡∏â‡∏±‡∏ô‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡∏ú‡∏•‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏π‡∏á"]},"Responsibility Load":{icon:"üèãÔ∏è",c:"#8B5CF6",pl:"‡πÄ‡∏™‡∏≤‡∏£‡πå",q:["‡∏â‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥","‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô ‡∏â‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å","‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏ï‡∏≤‡∏° ‡∏â‡∏±‡∏ô‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏õ‡∏≤‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à"]}}},C:{t:"The Interaction",dims:{"Motivation Driver":{icon:"üî•",c:"#F97316",pl:"‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",q:["‡∏â‡∏±‡∏ô‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ ‡πÅ‡∏•‡∏∞‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î","‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏ï‡πà‡∏≤‡∏á ‡∏â‡∏±‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á","‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏â‡∏±‡∏ô‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á"]},"Boundary System":{icon:"üõ°Ô∏è",c:"#10B981",pl:"‡πÄ‡∏™‡∏≤‡∏£‡πå+‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå",q:["‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏Ç‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏â‡∏±‡∏ô‡∏Å‡∏•‡πâ‡∏≤‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï","‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå","‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î ‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á"]},"Stress Response":{icon:"üßä",c:"#64748B",pl:"‡πÄ‡∏™‡∏≤‡∏£‡πå",q:["‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏î‡∏±‡∏ô ‡∏â‡∏±‡∏ô‡∏¢‡∏±‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÑ‡∏î‡πâ","‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‡∏â‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á","‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥ ‡∏â‡∏±‡∏ô‡∏¢‡∏±‡∏á‡∏´‡∏≤‡∏ß‡∏¥‡∏ò‡∏µ‡∏û‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥"]}}},D:{t:"The Evolution & Shadow",dims:{"Shadow Pattern":{icon:"üåë",c:"#1E293B",pl:"‡∏£‡∏≤‡∏´‡∏π/‡πÄ‡∏Å‡∏ï‡∏∏",rev:true,q:["‡∏â‡∏±‡∏ô‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÑ‡∏õ‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏ö‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏ó‡∏ô","‡∏â‡∏±‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Å‡∏•‡∏±‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏ô‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á","‡∏â‡∏±‡∏ô‡∏ú‡∏±‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç ‡πÅ‡∏°‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ã‡πâ‡∏≥"]},"Growth Orientation":{icon:"üå±",c:"#10B981",pl:"‡∏û‡∏§‡∏´‡∏±‡∏™",q:["‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡∏â‡∏±‡∏ô‡∏ñ‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î","‡∏â‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏•‡∏∞ 30 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á","‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏û‡∏•‡∏≤‡∏î ‡∏â‡∏±‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ"]},"Integration Level":{icon:"üîÆ",c:"#A78BFA",pl:"‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏î‡∏≤‡∏ß",q:["‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1 ‡∏ó‡∏µ‡πà‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ä‡∏±‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ","‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏û‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á","‡∏â‡∏±‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á"]}}}};

const flatQ=()=>{const f=[];Object.entries(QG).forEach(([,g])=>Object.entries(g.dims).forEach(([d,data])=>data.q.forEach((q,i)=>f.push({dim:d,q,icon:data.icon,c:data.c,rev:data.rev||false,qi:i,pl:data.pl}))));return f};
const ALL_Q=flatQ();
const SCALE=["‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡∏à‡∏£‡∏¥‡∏á","‡∏ô‡∏≤‡∏ô‡πÜ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á","‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á","‡∏ö‡πà‡∏≠‡∏¢","‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏°‡∏≤‡∏Å"];
const DM={};Object.values(QG).forEach(g=>Object.entries(g.dims).forEach(([k,v])=>{DM[k]=v}));
const DIMS=Object.keys(DM);
const TS=[{id:"dawn",l:"üåÖ ‡πÄ‡∏ä‡πâ‡∏≤‡∏°‡∏∑‡∏î (04:00‚Äì06:00)",d:"‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô"},{id:"morning",l:"‚òÄÔ∏è ‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏≤‡∏¢ (09:00‚Äì11:00)",d:"‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏π‡∏á"},{id:"noon",l:"üåû ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á/‡∏ö‡πà‡∏≤‡∏¢‡∏ï‡πâ‡∏ô (12:00‚Äì14:00)",d:"‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏®‡∏µ‡∏£‡∏©‡∏∞"},{id:"evening",l:"üåá ‡πÄ‡∏¢‡πá‡∏ô/‡∏û‡∏•‡∏ö‡∏Ñ‡πà‡∏≥ (17:00‚Äì19:00)",d:"‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ï‡∏Å"},{id:"night",l:"üåô ‡∏î‡∏∂‡∏Å (22:00‚Äì24:00)",d:"‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô"}];

// 77 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
const PV=["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£","‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà","‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ","‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå","‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£","‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô","‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ","‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤","‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ","‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó","‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥","‡∏ä‡∏∏‡∏°‡∏û‡∏£","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢","‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà","‡∏ï‡∏£‡∏±‡∏á","‡∏ï‡∏£‡∏≤‡∏î","‡∏ï‡∏≤‡∏Å","‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å","‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°","‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°","‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤","‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä","‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå","‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ","‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™","‡∏ô‡πà‡∏≤‡∏ô","‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨","‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå","‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ","‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå","‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ","‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ","‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤","‡∏û‡∏∞‡πÄ‡∏¢‡∏≤","‡∏û‡∏±‡∏á‡∏á‡∏≤","‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á","‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£","‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å","‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ","‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå","‡πÅ‡∏û‡∏£‡πà","‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï","‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°","‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£","‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô","‡∏¢‡πÇ‡∏™‡∏ò‡∏£","‡∏¢‡∏∞‡∏•‡∏≤","‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î","‡∏£‡∏∞‡∏ô‡∏≠‡∏á","‡∏£‡∏∞‡∏¢‡∏≠‡∏á","‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ","‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ","‡∏•‡∏≥‡∏õ‡∏≤‡∏á","‡∏•‡∏≥‡∏û‡∏π‡∏ô","‡πÄ‡∏•‡∏¢","‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©","‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£","‡∏™‡∏á‡∏Ç‡∏•‡∏≤","‡∏™‡∏ï‡∏π‡∏•","‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£","‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°","‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£","‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß","‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ","‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ","‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢","‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ","‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ","‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå","‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢","‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π","‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á","‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç","‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ","‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå","‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ","‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"];

// Day Lord
const RASHI=["‡πÄ‡∏°‡∏©","‡∏û‡∏§‡∏©‡∏†","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô","‡∏Å‡∏£‡∏Å‡∏é","‡∏™‡∏¥‡∏á‡∏´‡πå","‡∏Å‡∏±‡∏ô‡∏¢‡πå","‡∏ï‡∏∏‡∏•‡∏¢‡πå","‡∏û‡∏¥‡∏à‡∏¥‡∏Å","‡∏ò‡∏ô‡∏π","‡∏°‡∏Å‡∏£","‡∏Å‡∏∏‡∏°‡∏†‡πå","‡∏°‡∏µ‡∏ô"];
const NAKSHATRA=["‡∏≠‡∏±‡∏®‡∏ß‡∏¥‡∏ô‡∏µ","‡∏†‡∏£‡∏ì‡∏µ","‡∏Å‡∏§‡∏ï‡∏ï‡∏¥‡∏Å‡∏≤","‡πÇ‡∏£‡∏´‡∏¥‡∏ì‡∏µ","‡∏°‡∏§‡∏Ñ‡∏®‡∏¥‡∏£‡∏≤","‡∏≠‡∏≤‡∏£‡∏ó‡∏£‡∏≤","‡∏õ‡∏∏‡∏ô‡∏£‡∏ß‡∏™‡∏∏","‡∏õ‡∏∏‡∏©‡∏¢‡∏∞","‡∏≠‡∏≤‡∏®‡πÄ‡∏•‡∏©‡∏≤","‡∏°‡∏Ü‡∏∞","‡∏õ‡∏∏‡∏£‡∏ß‡∏ú‡∏•‡∏Ñ‡∏∏‡∏ô‡∏µ","‡∏≠‡∏∏‡∏ï‡∏ï‡∏£‡∏ú‡∏•‡∏Ñ‡∏∏‡∏ô‡∏µ","‡∏´‡∏±‡∏™‡∏ï‡∏∞","‡∏à‡∏¥‡∏ï‡∏£‡∏≤","‡∏™‡∏ß‡∏≤‡∏ï‡∏¥","‡∏ß‡∏¥‡∏®‡∏≤‡∏Ç‡∏∞","‡∏≠‡∏ô‡∏∏‡∏£‡∏≤‡∏ò‡∏∞","‡πÄ‡∏ä‡∏©‡∏ê‡∏≤","‡∏°‡∏π‡∏•‡∏∞","‡∏õ‡∏∏‡∏£‡∏ß‡∏©‡∏≤‡∏í‡∏∞","‡∏≠‡∏∏‡∏ï‡∏ï‡∏£‡∏©‡∏≤‡∏í‡∏∞","‡∏®‡∏£‡∏ß‡∏ì‡∏∞","‡∏ò‡∏ô‡∏¥‡∏©‡∏ê‡∏≤","‡∏®‡∏ï‡∏†‡∏¥‡∏©‡∏≤","‡∏õ‡∏∏‡∏£‡∏ß‡∏†‡∏±‡∏ó‡∏£","‡∏≠‡∏∏‡∏ï‡∏ï‡∏£‡∏†‡∏±‡∏ó‡∏£","‡πÄ‡∏£‡∏ß‡∏ï‡∏µ"];
const DAYNAME=["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"];
const DAY_LORD=[{day:0,lord:"‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",icon:"‚òÄÔ∏è",planet:"su",gf:"‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà"},{day:1,lord:"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå",icon:"üåô",planet:"mo",gf:"‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏á‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå"},{day:2,lord:"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£",icon:"üî•",planet:"ma",gf:"‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥ ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤"},{day:3,lord:"‡∏û‡∏∏‡∏ò",icon:"üß†",planet:"me",gf:"‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏á‡∏≤‡∏ô ‡πÄ‡∏à‡∏£‡∏à‡∏≤"},{day:4,lord:"‡∏û‡∏§‡∏´‡∏±‡∏™",icon:"üìö",planet:"ju",gf:"‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡∏£‡∏π‡πâ"},{day:5,lord:"‡∏®‡∏∏‡∏Å‡∏£‡πå",icon:"üíé",planet:"ve",gf:"‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå ‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢"},{day:6,lord:"‡πÄ‡∏™‡∏≤‡∏£‡πå",icon:"‚öôÔ∏è",planet:"sa",gf:"‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏ô‡∏±‡∏¢"}];

const natalPStr=(bd)=>{const m=parseInt(bd?.split("-")?.[1])||6;const d=parseInt(bd?.split("-")?.[2])||15;const s=(m*31+d)%100;return{su:Math.min(10,(22+((s*7)%18))/4),mo:Math.min(10,(18+((s*3)%22))/4),ma:Math.min(10,(19+((s*11)%21))/4),me:Math.min(10,(20+(s%20))/4),ju:Math.min(10,(21+((s*13)%19))/4),ve:Math.min(10,(20+((s*5)%20))/4),sa:Math.min(10,(17+((s*17)%23))/4)}};
const dlCompat=(dow,ns)=>{const dl=DAY_LORD[dow];const str=ns[dl.planet]||5;let q,mod;if(str>=8){q=dl.lord+"‡∏´‡∏ô‡∏∏‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà";mod=15}else if(str>=6){q=dl.lord+"‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡∏î‡∏µ";mod=8}else if(str>=4){q=dl.lord+"‡∏õ‡∏Å‡∏ï‡∏¥";mod=0}else{q=dl.lord+"‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢";mod=-10}return{...dl,str,q,mod}};
const moonTr=(date)=>{const ref=new Date("2024-01-01T00:00:00Z");const days=(date-ref)/864e5;return Math.floor(((days/27.3217%1)*12+5)%12)};
const marsTr=(date)=>{const ref=new Date("2024-01-01T00:00:00Z");const days=(date-ref)/864e5;return Math.floor(((days/686.97%1)*12+7)%12)};
const satTr=(date)=>{const ref=new Date("2024-01-01T00:00:00Z");return Math.floor(((date-ref)/864e5/10766*12+10)%12)};
const natalMoon=(bd)=>{if(!bd||bd==="--")return 0;const d=new Date(bd+"T12:00:00Z");return isNaN(d.getTime())?0:moonTr(d)};
const getNak=(ri,di)=>NAKSHATRA[(ri*2+(di%3))%27];
const trAspect=(tr,nr)=>{const d=((tr-nr)%12+12)%12;if(d===0)return{r:"‡∏£‡πà‡∏ß‡∏°",q:"‡∏Å‡∏•‡∏≤‡∏á",m:0};if(d===4||d===8)return{r:"‡∏ï‡∏£‡∏µ‡πÇ‡∏Å‡∏ì",q:"‡∏î‡∏µ‡∏°‡∏≤‡∏Å",m:15};if(d===3||d===9)return{r:"‡∏à‡∏ï‡∏∏‡πÇ‡∏Å‡∏ì",q:"‡∏Å‡∏î‡∏î‡∏±‡∏ô",m:-15};if(d===6)return{r:"‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°",q:"‡∏ï‡∏∂‡∏á",m:-10};if(d===5)return{r:"‡∏ï‡∏£‡∏µ‡πÇ‡∏Å‡∏ì‡∏£‡∏≠‡∏á",q:"‡∏î‡∏µ",m:10};return{r:"‡∏õ‡∏Å‡∏ï‡∏¥",q:"‡∏Å‡∏•‡∏≤‡∏á",m:0}};
const marsD=(r)=>{if(r===0||r===7)return{d:"‡πÄ‡∏Å‡∏©‡∏ï‡∏£",m:10};if(r===9)return{d:"‡∏≠‡∏∏‡∏à‡∏à‡πå",m:15};if(r===3)return{d:"‡∏ô‡∏¥‡∏à",m:-15};return{d:"‡∏õ‡∏Å‡∏ï‡∏¥",m:0}};

const gen7Day=(bd)=>{const nm=natalMoon(bd);const ns=natalPStr(bd);const today=new Date();const days=[];for(let i=0;i<7;i++){const dt=new Date(today);dt.setDate(dt.getDate()+i);const mr=moonTr(dt);const mar=marsTr(dt);const sat=satTr(dt);const ma=trAspect(mr,nm);const md=marsD(mar);const dl=dlCompat(dt.getDay(),ns);const moonE=Math.max(30,Math.min(95,65+ma.m));const marsE=Math.max(30,Math.min(95,65+md.m));const dlE=Math.max(30,Math.min(95,65+dl.mod));const ce=Math.round(moonE*.4+marsE*.25+dlE*.35);days.push({date:`${dt.getDate()}/${dt.getMonth()+1}`,dn:DAYNAME[dt.getDay()],moonR:RASHI[mr],nak:getNak(mr,i),marsR:RASHI[mar],satR:RASHI[sat],ma,md,nmR:RASHI[nm],dl,ce})}return days};

// Vedic Dasha System ‚Äî Life Phase Map
const DASHA_SEQ=[{p:"‡πÄ‡∏Å‡∏ï‡∏∏",y:7,icon:"üåÄ",theme:"‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á",desc:"‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï",focus:"‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ß‡∏≤‡∏á‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏Å‡πà‡∏≤",cheer:"‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏≤‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡∏∏‡∏ì '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï' ‚Äî ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÅ‡∏£‡∏Å üå±",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡∏¢‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÉ‡∏´‡∏ç‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ä‡∏±‡πà‡∏ß‡∏ß‡∏π‡∏ö ‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô‡∏≠‡∏≤‡∏à‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏†‡∏≤‡∏û‡πÄ‡∏ï‡πá‡∏°"},{p:"‡∏®‡∏∏‡∏Å‡∏£‡πå",y:20,icon:"üíé",theme:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç",desc:"‡∏û‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå ‡∏®‡∏¥‡∏•‡∏õ‡∏∞ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏° ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å",focus:"‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç",cheer:"‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡∏£‡∏±‡∏Å ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‚Äî ‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚ú®",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡∏¢‡πà‡∏≤‡∏´‡∏•‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô‡∏à‡∏ô‡∏•‡∏∑‡∏°‡∏£‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô ‡∏≠‡∏¢‡πà‡∏≤‡∏û‡∏∂‡πà‡∏á‡∏•‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏¢‡∏≤‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á"},{p:"‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",y:6,icon:"‚òÄÔ∏è",theme:"‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏ô",desc:"‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à",focus:"‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥",cheer:"‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏™‡πà‡∏≠‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì ‚Äî ‡∏Å‡∏•‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ ‡∏Å‡∏•‡πâ‡∏≤‡∏ö‡∏≠‡∏Å‡πÇ‡∏•‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ üåü",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏¢‡∏¥‡πà‡∏á ‡∏ü‡∏±‡∏á‡∏Ñ‡∏ô‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢"},{p:"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå",y:10,icon:"üåô",theme:"‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï‡πÉ‡∏à",desc:"‡∏û‡∏•‡∏±‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß ‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏≠‡∏≤‡πÉ‡∏à‡πÉ‡∏™‡πà",focus:"‡∏î‡∏π‡πÅ‡∏•‡∏à‡∏¥‡∏ï‡πÉ‡∏à ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô",cheer:"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏•‡∏∂‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‚Äî ‡∏ô‡∏±‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏û‡∏•‡∏±‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î üíô",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏´‡∏≤‡∏Ñ‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏à‡∏Ñ‡∏∏‡∏¢‡∏î‡πâ‡∏ß‡∏¢ ‡∏≠‡∏¢‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≠‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÑ‡∏°‡πà‡∏î‡∏µ"},{p:"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£",y:7,icon:"üî•",theme:"‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥",desc:"‡∏ä‡πà‡∏ß‡∏á‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥ ‡∏Å‡∏•‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á ‡∏û‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏π‡∏á",focus:"‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥ ‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢",cheer:"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£‡∏à‡∏∏‡∏î‡πÑ‡∏ü‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì ‚Äî ‡∏û‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏à‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà ‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡πâ‡∏° ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ üöÄ",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏û‡∏•‡∏±‡∏á‡∏™‡∏π‡∏á = ‡πÉ‡∏à‡∏£‡πâ‡∏≠‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏≠‡∏¢‡πà‡∏≤‡∏ó‡∏∞‡πÄ‡∏•‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏Ñ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏π‡∏î"},{p:"‡∏£‡∏≤‡∏´‡∏π",y:18,icon:"üåë",theme:"‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏ç‡πà",desc:"‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏ô‡πÄ‡∏Ñ‡∏¢ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏â‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏ô",focus:"‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏≠‡∏¢‡πà‡∏≤‡∏¢‡∏∂‡∏î‡∏ï‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°",cheer:"‡∏£‡∏≤‡∏´‡∏π‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å comfort zone ‚Äî ‡∏≠‡∏≤‡∏à‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à ‡πÅ‡∏ï‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤ ü¶ã",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ã‡πá‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÉ‡∏´‡∏ç‡πà"},{p:"‡∏û‡∏§‡∏´‡∏±‡∏™",y:16,icon:"üìö",theme:"‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏ç‡∏ç‡∏≤",desc:"‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏õ‡∏¥‡∏î ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ",focus:"‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß",cheer:"‡∏û‡∏§‡∏´‡∏±‡∏™‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÅ‡∏´‡πà‡∏á‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ ‚Äî ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 10 ‡∏õ‡∏µ ‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡πÇ‡∏ä‡∏Ñ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏Ñ‡∏∏‡∏ì üçÄ",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡∏¢‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏£‡∏¥‡∏á‡πÜ"},{p:"‡πÄ‡∏™‡∏≤‡∏£‡πå",y:19,icon:"‚öôÔ∏è",theme:"‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö",desc:"‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏î‡∏ó‡∏ô ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô",focus:"‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏Å ‡∏ú‡∏•‡∏°‡∏≤‡∏ä‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô",cheer:"‡πÄ‡∏™‡∏≤‡∏£‡πå‡∏™‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏î‡∏ó‡∏ô ‚Äî ‡∏≠‡∏≤‡∏à‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏´‡∏ô‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏™‡∏≤‡∏£‡πå‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏à‡∏∞‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤ ‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô üí™",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏±‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‡∏ó‡∏≥‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏¢‡πâ‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏™‡∏£‡πâ‡∏≤‡∏á"},{p:"‡∏û‡∏∏‡∏ò",y:17,icon:"üß†",theme:"‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ",desc:"‡∏û‡∏•‡∏±‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î",focus:"‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢",cheer:"‡∏û‡∏∏‡∏ò‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏°‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì ‚Äî ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏£‡πá‡∏ß ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡πá‡∏ß ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏á ‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏´‡∏°‡πà‡πÜ ü§ù",warn:"‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏¢‡∏≠‡∏∞ = ‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏á‡πà‡∏≤‡∏¢ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏û‡∏±‡∏Å‡∏™‡∏°‡∏≠‡∏á ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏à‡∏ô‡∏•‡∏∑‡∏°‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà"}];
const calcDasha=(bd)=>{if(!bd||bd==="--"||bd.length<8)return[];const bp=bd?.split("-");if(!bp||bp.length<3)return[];const by=parseInt(bp[0])||1990;const bm=parseInt(bp[1])||1;const bdNum=parseInt(bp[2])||1;const testDate=new Date(bd+"T12:00:00Z");if(isNaN(testDate.getTime()))return[];const nm=natalMoon(bd);const nakI=(nm*2+(bdNum%3))%27;const startI=Math.floor(nakI/3)%9;const totalY=120;const phases=[];let age=0;for(let c=0;c<18;c++){const di=(startI+c)%9;const d=DASHA_SEQ[di];const startAge=age;const endAge=age+d.y;const startYear=by+startAge;const endYear=by+endAge;const now=new Date().getFullYear();const isCurrent=now>=startYear&&now<endYear;const isPast=now>=endYear;phases.push({...d,startAge,endAge,startYear,endYear,isCurrent,isPast});age+=d.y;if(age>100)break}return phases};

// Vedic scoring
const calcV=(bd,ts)=>{const m=parseInt(bd?.split("-")?.[1])||6;const d=parseInt(bd?.split("-")?.[2])||15;const s=(m*31+d)%100;const tb={dawn:5,morning:3,noon:0,evening:2,night:-2}[ts]||0;const ps={me:Math.min(40,20+(s%20)+tb),mo:Math.min(40,18+((s*3)%22)+tb),su:Math.min(40,22+((s*7)%18)+tb),ma:Math.min(40,19+((s*11)%21)+tb),ju:Math.min(40,21+((s*13)%19)+tb),sa:Math.min(40,17+((s*17)%23)+tb),ra:Math.min(40,15+((s*19)%25)+tb)};const f=(p,i)=>Math.min(100,p+Math.min(25,10+((s+i)%15))+Math.min(20,8+((s*2+i)%12))+Math.min(15,5+((s*3+i)%10)));return{"Cognitive Processing":f(ps.me,1)/10,"Emotional Regulation":f(ps.mo,2)/10,"Identity Stability":f(Math.round((ps.su+ps.sa)/2),3)/10,"Energy Management":f(ps.ma,4)/10,"Decision System":f(Math.round((ps.ju+ps.sa)/2),5)/10,"Responsibility Load":f(ps.sa,6)/10,"Motivation Driver":f(ps.su,7)/10,"Boundary System":f(Math.round((ps.sa+ps.mo)/2),8)/10,"Stress Response":f(ps.sa,9)/10,"Shadow Pattern":f(ps.ra,10)/10,"Growth Orientation":f(ps.ju,11)/10,"Integration Level":f(Math.round(Object.values(ps).reduce((a,b)=>a+b,0)/7),12)/10}};
const calcS=(v,ans)=>{const sc={};DIMS.forEach(dim=>{const vd=v[dim]||5;let raw=0,cnt=0;const dd=DM[dim];if(dd)dd.q.forEach((_,i)=>{const k=`${dim}-${i}`;if(ans[k]!==undefined){let val=ans[k];if(dd.rev)val=4-val;raw+=val;cnt++}});const ap=cnt>0?(raw/(cnt*4))*10:5;let fi=vd*.6+ap*.4;if(vd>7&&ap<4)fi-=1.5;if(vd<4&&ap>7)fi+=.5;sc[dim]=Math.max(0,Math.min(10,Math.round(fi*10)/10))});return sc};

// Vedic System Prompt
const VEDIC_SYS=`‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡πÇ‡∏´‡∏£‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏û‡∏£‡∏∞‡πÄ‡∏ß‡∏ó(Jyotish)‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏öSidereal(‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πàTropical/Western)
‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£: ‡∏•‡∏±‡∏Ñ‡∏ô‡∏≤(Ascendant)‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πàSun sign
‡∏î‡∏≤‡∏ß9‡∏î‡∏ß‡∏á: ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£ ‡∏û‡∏∏‡∏ò ‡∏û‡∏§‡∏´‡∏±‡∏™ ‡∏®‡∏∏‡∏Å‡∏£‡πå ‡πÄ‡∏™‡∏≤‡∏£‡πå ‡∏£‡∏≤‡∏´‡∏π ‡πÄ‡∏Å‡∏ï‡∏∏
‡πÄ‡∏£‡∏∑‡∏≠‡∏ô12: ‡∏ï‡∏ô‡∏∏ ‡∏Å‡∏î‡∏∏‡∏°‡∏†‡∏∞ ‡∏™‡∏´‡∏±‡∏ä‡∏ä‡∏∞ ‡∏û‡∏±‡∏ô‡∏ò‡∏∏ ‡∏õ‡∏∏‡∏ï‡∏ï‡∏∞ ‡∏≠‡∏£‡∏¥ ‡∏õ‡∏±‡∏ï‡∏ô‡∏¥ ‡∏°‡∏£‡∏ì‡∏∞ ‡∏®‡∏∏‡∏†‡∏∞ ‡∏Å‡∏±‡∏°‡∏°‡∏∞ ‡∏•‡∏≤‡∏†‡∏∞ ‡∏ß‡∏¥‡∏ô‡∏≤‡∏®
‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£27‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏î‡∏≤‡∏ß / ‡∏™‡∏†‡∏≤‡∏û‡∏î‡∏≤‡∏ß: ‡∏≠‡∏∏‡∏à‡∏à‡πå/‡∏ô‡∏¥‡∏à/‡πÄ‡∏Å‡∏©‡∏ï‡∏£/‡∏õ‡∏£‡∏∞/‡∏°‡∏¥‡∏ï‡∏£/‡∏®‡∏±‡∏ï‡∏£‡∏π
Dasha: ‡∏°‡∏´‡∏≤‡∏ó‡∏®‡∏≤‚Üí‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏ó‡∏®‡∏≤ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
Mapping: ‡∏û‡∏∏‡∏ò‚ÜíCognitive ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‚ÜíEmotional ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå+‡πÄ‡∏™‡∏≤‡∏£‡πå‚ÜíIdentity ‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£‚ÜíEnergy ‡∏û‡∏§‡∏´‡∏±‡∏™+‡πÄ‡∏™‡∏≤‡∏£‡πå‚ÜíDecision ‡πÄ‡∏™‡∏≤‡∏£‡πå‚ÜíResponsibility+Stress ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‚ÜíMotivation ‡πÄ‡∏™‡∏≤‡∏£‡πå+‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‚ÜíBoundary ‡∏£‡∏≤‡∏´‡∏π/‡πÄ‡∏Å‡∏ï‡∏∏‚ÜíShadow ‡∏û‡∏§‡∏´‡∏±‡∏™‚ÜíGrowth ‡∏ú‡∏•‡∏£‡∏ß‡∏°‚ÜíIntegration
‡∏Å‡∏é: ‡∏î‡∏≤‡∏ß‡∏≠‡∏∏‡∏à‡∏à‡πå=‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á ‡∏ñ‡πâ‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≥‚Üí"‡∏î‡∏ß‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°" / ‡∏î‡∏≤‡∏ß‡∏ô‡∏¥‡∏à=‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏¢‡πà / ‡∏£‡∏≤‡∏´‡∏π/‡πÄ‡∏Å‡∏ï‡∏∏=‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏≤‡∏ï‡∏¥‡∏ô‡∏µ‡πâ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏•‡∏ß‡∏£‡πâ‡∏≤‡∏¢
‡∏ï‡∏≠‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à ‡πÑ‡∏°‡πà‡∏Ç‡∏π‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ß`;

// GPT
const GPT={cache:{},call:async(prompt,key)=>{if(key&&GPT.cache[key])return GPT.cache[key];try{const ctrl=new AbortController();const tm=setTimeout(()=>ctrl.abort(),18000);const r=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt,system:VEDIC_SYS}),signal:ctrl.signal});clearTimeout(tm);const d=await r.json();if(d.error)return GPT.fb(key);const t=d.text||"";if(key)GPT.cache[key]=t;return t}catch{return GPT.fb(key)}},
fb:k=>{if(!k)return"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...";if(k.startsWith("id_"))return"‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏î‡∏ß‡∏á‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î ‡∏î‡∏≤‡∏ß‡∏ö‡πà‡∏á‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏π‡∏á ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏ß‡∏á‡∏Å‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û";if(k.startsWith("core_"))return"üß† Cognitive(‡∏û‡∏∏‡∏ò): ‡∏î‡∏≤‡∏ß‡∏û‡∏∏‡∏ò‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö\n\nüåä Emotional(‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå): ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå\n\n‚öì Identity(‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå+‡πÄ‡∏™‡∏≤‡∏£‡πå): ‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á\n\nüåë Shadow(‡∏£‡∏≤‡∏´‡∏π/‡πÄ‡∏Å‡∏ï‡∏∏): ‡∏à‡∏∏‡∏î‡∏ö‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á\n\nüå± Growth(‡∏û‡∏§‡∏´‡∏±‡∏™): ‡∏û‡∏§‡∏´‡∏±‡∏™‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ";if(k.startsWith("sh_"))return"‚ö° Trigger: ‡∏£‡∏≤‡∏´‡∏π‡∏ä‡∏µ‡πâ‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢\n\nüîÑ Pattern ‡∏ã‡πâ‡∏≥: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡∏™‡∏ö‡∏≤‡∏¢‡πÅ‡∏ó‡∏ô‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏ï‡∏£‡∏á\n\nüí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏´‡∏¢‡∏∏‡∏î5‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà";if(k.startsWith("f12_"))return"üí™ ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á: ‡∏î‡∏≤‡∏ß‡∏´‡∏ô‡∏∏‡∏ô‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡∏î‡∏µ ‡∏û‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏á ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô ‡πÅ‡∏£‡∏á‡∏Ç‡∏±‡∏ö‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏Å‡∏£‡πà‡∏á\n\n‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤: ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏û‡∏±‡∏Å ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏à‡∏∏‡∏î‡∏ö‡∏≠‡∏î";if(k.startsWith("wk_"))return'{"do":["‡πÉ‡∏ä‡πâ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏≤‡∏ß‡∏´‡∏ô‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ","‡∏ù‡∏∂‡∏Å‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á","‡∏´‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 30 ‡∏ô‡∏≤‡∏ó‡∏µ"],"dont":["‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏£‡∏á","‡∏≠‡∏¢‡πà‡∏≤‡∏ú‡∏±‡∏î‡∏ß‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏≤","‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏ù‡∏∂‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò"]}';if(k.startsWith("en_"))return'[{"day":"‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ","date":"","energy":72,"mood":"üåü ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏î‡∏µ","tip":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ä‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç","transit":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå + ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ‡∏û‡∏§‡∏©‡∏†","goodFor":"‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç"},{"day":"‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ","date":"","energy":68,"mood":"üòä ‡∏™‡∏á‡∏ö‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á","tip":"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏ï‡∏£‡∏µ‡πÇ‡∏Å‡∏ì‡∏î‡∏µ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á","transit":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå + ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ‡∏û‡∏§‡∏©‡∏†","goodFor":"‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå"},{"day":"‡∏°‡∏∞‡∏£‡∏∑‡∏ô","date":"","energy":78,"mood":"üî• ‡∏Å‡∏£‡∏∞‡∏ï‡∏∑‡∏≠‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏ô","tip":"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£‡∏à‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£ ‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢","transit":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£ + ‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£‡∏à‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£","goodFor":"‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ ‡∏•‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≥"},{"day":"+3","date":"","energy":65,"mood":"üß† ‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå","tip":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò‡∏´‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£","transit":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò + ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô","goodFor":"‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡πÄ‡∏à‡∏£‡∏à‡∏≤"},{"day":"+4","date":"","energy":82,"mood":"üìö ‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏õ‡∏¥‡∏î","tip":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ","transit":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™ + ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô","goodFor":"‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô"},{"day":"+5","date":"","energy":75,"mood":"üíé ‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢","tip":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå","transit":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå + ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ‡∏Å‡∏£‡∏Å‡∏é","goodFor":"‡∏™‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå"},{"day":"+6","date":"","energy":58,"mood":"‚öôÔ∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢","tip":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏£‡πâ‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏î‡∏ó‡∏ô","transit":"‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå + ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ‡∏Å‡∏£‡∏Å‡∏é","goodFor":"‡∏à‡∏±‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á"}]';if(k.startsWith("job_"))return'[{"title":"Data Analyst","titleTH":"‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","match":85,"dims":"Cognitive + Decision + Responsibility","reason":"‡∏î‡∏≤‡∏ß‡∏û‡∏∏‡∏ò‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏™‡∏π‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏™‡∏≤‡∏£‡πå‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÑ‡∏î‡πâ‡∏î‡∏µ"},{"title":"Project Manager","titleTH":"‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå","match":80,"dims":"Energy + Decision + Stress Response","reason":"‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡∏û‡∏§‡∏´‡∏±‡∏™+‡πÄ‡∏™‡∏≤‡∏£‡πå‡∏´‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à ‡πÄ‡∏™‡∏≤‡∏£‡πå‡∏ä‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÅ‡∏£‡∏á‡∏Å‡∏î‡∏î‡∏±‡∏ô"},{"title":"UX Researcher","titleTH":"‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢ UX","match":78,"dims":"Cognitive + Emotional + Growth","reason":"‡∏û‡∏∏‡∏ò‡∏´‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏û‡∏§‡∏´‡∏±‡∏™‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà"}]';return null}};
const pJ=t=>{if(!t)return null;try{return JSON.parse(t.replace(/```json\s*/g,"").replace(/```/g,"").trim())}catch{return null}};
const ST={set:(k,v)=>{try{localStorage.setItem(`hss6_${k}`,JSON.stringify(v))}catch{}},get:k=>{try{const s=localStorage.getItem(`hss6_${k}`);return s?JSON.parse(s):null}catch{return null}}};

const css=`@keyframes hs{to{transform:rotate(360deg)}}@keyframes hb{50%{opacity:0}}@keyframes hfl{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}`;
const Spin=({t="AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå..."})=><div style={{padding:"12px 0",display:"flex",alignItems:"center",gap:8}}><div style={{width:16,height:16,borderRadius:"50%",border:"2.5px solid #E0E7FF",borderTopColor:"#6366F1",animation:"hs .7s linear infinite"}}/><span style={{fontSize:12,color:"#6366F1",fontWeight:600}}>{t}</span></div>;
const Typer=({text})=>{const[s,setS]=useState("");const[d,setD]=useState(false);useEffect(()=>{if(!text)return;let i=0;setS("");setD(false);const iv=setInterval(()=>{i+=3;if(i>=text.length){setS(text);setD(true);clearInterval(iv)}else setS(text.slice(0,i))},12);return()=>clearInterval(iv)},[text]);return<div style={{fontSize:13,lineHeight:1.8,color:"#374151",whiteSpace:"pre-wrap"}}>{s}{!d&&<span style={{display:"inline-block",width:2,height:14,background:"#6366F1",marginLeft:1,animation:"hb .8s step-end infinite"}}/>}</div>};
const Spider=({scores,size=260})=>{const keys=Object.keys(scores);const vals=Object.values(scores);const n=keys.length;const cx=size/2,cy=size/2,r=size*.34;const pt=(i,v)=>{const a=Math.PI*2*i/n-Math.PI/2;return{x:cx+Math.cos(a)*v/10*r,y:cy+Math.sin(a)*v/10*r}};return<svg viewBox={`0 0 ${size} ${size}`} style={{width:"100%",maxWidth:280}}>{[2,4,6,8,10].map(l=><polygon key={l} points={keys.map((_,i)=>{const p=pt(i,l);return`${p.x},${p.y}`}).join(" ")} fill="none" stroke="#E5E7EB" strokeWidth=".6"/>)}{keys.map((_,i)=>{const p=pt(i,10);return<line key={i} x1={cx} y1={cy} x2={p.x} y2={p.y} stroke="#F3F4F6" strokeWidth=".4"/>})}<polygon points={keys.map((_,i)=>{const p=pt(i,vals[i]);return`${p.x},${p.y}`}).join(" ")} fill="rgba(99,102,241,.12)" stroke="#6366F1" strokeWidth="1.8"/>{keys.map((_,i)=>{const p=pt(i,vals[i]);return<circle key={i} cx={p.x} cy={p.y} r="2.5" fill="#6366F1" stroke="#fff" strokeWidth="1.2"/>})}{keys.map((k,i)=>{const p=pt(i,12.2);const sh=k.length>12?k.slice(0,10)+"‚Ä¶":k;return<text key={i} x={p.x} y={p.y} textAnchor="middle" dominantBaseline="middle" style={{fontSize:"5.2px",fill:"#6B7280",fontWeight:500}}>{sh}</text>})}</svg>};
const Card=({children,style={}})=><div style={{background:"#fff",borderRadius:14,padding:"16px 18px",marginBottom:10,boxShadow:"0 1px 3px rgba(0,0,0,.04)",border:"1px solid #F1F5F9",...style}}>{children}</div>;
const Btn=({children,ok=true,onClick,style={}})=><button onClick={ok?onClick:undefined} style={{padding:"12px 20px",fontSize:14,fontWeight:700,background:ok?"linear-gradient(135deg,#4338CA,#6D28D9)":"#E2E8F0",color:ok?"#fff":"#94A3B8",border:"none",borderRadius:10,cursor:ok?"pointer":"not-allowed",width:"100%",boxShadow:ok?"0 4px 14px rgba(79,70,229,.2)":"none",...style}}>{children}</button>;

// Locked Preview with blur
const Locked=({planNeeded,title,children,onUpgrade})=><Card style={{position:"relative",overflow:"hidden",minHeight:120}}><div style={{filter:"blur(3px)",pointerEvents:"none",userSelect:"none",opacity:.4,padding:"8px 0"}}>{children}</div><div style={{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,.75)",backdropFilter:"blur(2px)",padding:16}}><div style={{fontSize:28,marginBottom:6}}>üîí</div><div style={{fontSize:13,fontWeight:700,color:"#4338CA",marginBottom:3,textAlign:"center"}}>{title}</div><div style={{fontSize:11,color:"#64748B",marginBottom:10}}>{planNeeded==="deep"?"Deep Insight ‡∏ø49":"All Access ‡∏ø99"}</div><button onClick={()=>onUpgrade(planNeeded)} style={{padding:"8px 24px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#4338CA,#6D28D9)",color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(79,70,229,.25)"}}>‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å ‚Üí</button></div></Card>;

export default function App(){
  const[sc,setSc]=useState("landing");
  const[nick,setNick]=useState("");const[email,setEmail]=useState("");const[bday,setBday]=useState("--");
  const[knowT,setKnowT]=useState(null);const[btime,setBtime]=useState("");const[tSlot,setTSlot]=useState("");const[prov,setProv]=useState("");
  const[qI,setQI]=useState(0);const[ans,setAns]=useState({});
  const[scores,setScores]=useState(null);const[vedic,setVedic]=useState(null);
  const[plan,setPlan]=useState("free");const[ai,setAi]=useState({});const[aiL,setAiL]=useState({});
  const[user,setUser]=useState(null);const[loginModal,setLoginModal]=useState(false);const[pendingPlan,setPendingPlan]=useState(null);
  const[authMode,setAuthMode]=useState("login");const[authErr,setAuthErr]=useState("");const[authLoading,setAuthLoading]=useState(false);
  const authEmailRef=useRef(null);const authPwRef=useRef(null);
  const nickRef=useRef(null);const emailRef=useRef(null);

  // Init: check Supabase session + handle payment redirect
  useEffect(()=>{
    const init=async()=>{
      // === STEP 1: Detect Stripe redirect ===
      const params=new URLSearchParams(window.location.search);
      const payOk=params.get("payment")==="success";
      const payPlan=params.get("plan");
      if(payOk&&payPlan){
        localStorage.setItem("hss_paid_plan",payPlan);
        localStorage.setItem("hss_paid_at",Date.now().toString());
        window.history.replaceState({},"",window.location.pathname);
      }
      const paidPlan=localStorage.getItem("hss_paid_plan");
      const paidAt=parseInt(localStorage.getItem("hss_paid_at")||"0");
      const hasPaid=paidPlan&&(Date.now()-paidAt<3600000);

      // === STEP 2: Always restore localStorage data first ===
      const lsScores=ST.get("scores");const lsVedic=ST.get("vedic");
      const lsProfile=ST.get("profile");const lsAnswers=ST.get("answers");const lsPlan=ST.get("plan");
      let hasLocalData=false;
      if(lsProfile){setNick(lsProfile.nick||"");setBday(lsProfile.bday||"--");setBtime(lsProfile.btime||"");setTSlot(lsProfile.tSlot||"");setProv(lsProfile.prov||"")}
      if(lsAnswers)setAns(lsAnswers);
      if(lsScores&&lsVedic){setScores(lsScores);setVedic(lsVedic);hasLocalData=true}

      // === STEP 3: Try Supabase session ===
      if(sb){
        const{data:{session}}=await sb.auth.getSession();
        if(session?.user){
          // LOGGED IN ‚Äî load from DB
          setUser(session.user);setEmail(session.user.email||"");
          const{data:prof}=await sb.from("profiles").select("*").eq("id",session.user.id).single();
          if(prof){setNick(prof.nick||"");setBday(prof.bday||"--");setBtime(prof.btime||"");setTSlot(prof.time_slot||"");setProv(prof.province||"")}
          const{data:assess}=await sb.from("assessments").select("*").eq("user_id",session.user.id).order("created_at",{ascending:false}).limit(1).single();
          if(assess?.scores){
            setAns(assess.answers||{});setScores(assess.scores);setVedic(assess.vedic);
            if(assess.ai_results&&Object.keys(assess.ai_results).length>0)setAi(assess.ai_results);
            hasLocalData=true;
          }
          // Activate paid plan
          if(hasPaid){
            setPlan(paidPlan);ST.set("plan",paidPlan);
            sb.from("profiles").update({plan:paidPlan,updated_at:new Date().toISOString()}).eq("id",session.user.id);
            localStorage.removeItem("hss_paid_plan");localStorage.removeItem("hss_paid_at");
          } else {
            setPlan(prof?.plan||lsPlan||"free");
          }
          // Go to results if we have data
          if(hasLocalData||assess?.scores)setSc("results");

        } else if(hasPaid){
          // NOT LOGGED IN but PAID ‚Äî show login modal + restore local data
          const savedEmail=localStorage.getItem("hss_user_email")||"";
          setEmail(savedEmail);
          if(hasPaid)setPlan(paidPlan);
          if(hasLocalData)setSc("results");
          setLoginModal(true);setAuthMode("login");
          setAuthErr("‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å");

        } else {
          // NOT LOGGED IN, NOT PAID ‚Äî check localStorage for existing results
          if(lsPlan)setPlan(lsPlan);
          if(hasLocalData)setSc("results");
        }

        // Listen for auth changes (Google OAuth, re-login, etc.)
        sb.auth.onAuthStateChange(async(ev,sess)=>{
          if(ev==="SIGNED_IN"&&sess?.user){
            setUser(sess.user);setEmail(sess.user.email||"");setLoginModal(false);
            // Activate paid plan if pending
            const pp=localStorage.getItem("hss_paid_plan");
            const ppAt=parseInt(localStorage.getItem("hss_paid_at")||"0");
            if(pp&&(Date.now()-ppAt<3600000)){
              setPlan(pp);ST.set("plan",pp);
              sb.from("profiles").update({plan:pp,updated_at:new Date().toISOString()}).eq("id",sess.user.id);
              localStorage.removeItem("hss_paid_plan");localStorage.removeItem("hss_paid_at");
            }
            // Load user data from DB
            const{data:prof}=await sb.from("profiles").select("*").eq("id",sess.user.id).single();
            if(prof){setNick(prof.nick||"");setBday(prof.bday||"--");if(!pp)setPlan(prof.plan||"free")}
            const{data:assess}=await sb.from("assessments").select("*").eq("user_id",sess.user.id).order("created_at",{ascending:false}).limit(1).single();
            if(assess?.scores){setScores(assess.scores);setVedic(assess.vedic);setSc("results");if(assess.ai_results)setAi(assess.ai_results)}
            else if(hasLocalData)setSc("results");
          }
          if(ev==="SIGNED_OUT"){setUser(null)}
        });
      } else {
        // No Supabase ‚Äî pure localStorage
        if(hasPaid){setPlan(paidPlan);localStorage.removeItem("hss_paid_plan");localStorage.removeItem("hss_paid_at")}
        else if(lsPlan)setPlan(lsPlan);
        if(hasLocalData)setSc("results");
      }
    };init();
  },[]);

  // Auto-trigger AI when scores+nick become available (after login reload)
  const aiTriggered=useRef(false);
  useEffect(()=>{
    if(scores&&nick&&vedic&&!aiTriggered.current){
      aiTriggered.current=true;
      if(!ai.identity)loadAI("identity",scores,vedic,nick,bday);
      if(!ai.core)loadAI("core",scores,vedic,nick,bday);
      const fs=PLANS[plan].f;
      if(fs.includes("12d")&&!ai["12d"])loadAI("12d",scores,vedic,nick,bday);
      if(fs.includes("shadow")&&!ai.shadow)loadAI("shadow",scores,vedic,nick,bday);
      if(fs.includes("weekly")&&!ai.weekly)loadAI("weekly",scores,vedic,nick,bday);
      if(fs.includes("energy")&&!ai.energy)loadAI("energy",scores,vedic,nick,bday);
      if(fs.includes("job")&&!ai.job)loadAI("job",scores,vedic,nick,bday);
    }
  },[scores,nick,vedic,plan,ai]);

  // Save to Supabase DB
  const saveProfile=async()=>{if(!sb||!user)return;await sb.from("profiles").upsert({id:user.id,nick,email:user.email,bday,btime,time_slot:tSlot,province:prov,plan,updated_at:new Date().toISOString()})};
  const saveAssessment=async(s,v,a)=>{if(!sb||!user)return;const{data:ex}=await sb.from("assessments").select("id").eq("user_id",user.id).order("created_at",{ascending:false}).limit(1).single();if(ex){await sb.from("assessments").update({answers:a,scores:s,vedic:v,updated_at:new Date().toISOString()}).eq("id",ex.id)}else{await sb.from("assessments").insert({user_id:user.id,answers:a,scores:s,vedic:v})}};
  const saveAI=async(aiData)=>{if(!sb||!user)return;const{data:ex}=await sb.from("assessments").select("id").eq("user_id",user.id).order("created_at",{ascending:false}).limit(1).single();if(ex)await sb.from("assessments").update({ai_results:aiData,updated_at:new Date().toISOString()}).eq("id",ex.id)};
  const savePlan=async(p)=>{if(!sb||!user)return;await sb.from("profiles").update({plan:p,updated_at:new Date().toISOString()}).eq("id",user.id)};

  const logged=!!user;
  const has=f=>PLANS[plan].f.includes(f);
  const goQuiz=()=>{ST.set("profile",{nick,email,bday,btime,tSlot,prov});saveProfile();setSc("quiz")};
  const answer=val=>{const q=ALL_Q[qI];const key=`${q.dim}-${q.qi}`;const na={...ans,[key]:val};setAns(na);ST.set("answers",na);if(qI<ALL_Q.length-1)setTimeout(()=>setQI(qI+1),200)};
  const finish=()=>{const ts=knowT?btime:tSlot;const v=calcV(bday,ts);const s=calcS(v,ans);setVedic(v);setScores(s);ST.set("vedic",v);ST.set("scores",s);saveAssessment(s,v,ans);setSc("results");loadAI("identity",s,v);loadAI("core",s,v)};

  const loadAI=async(type,s2,v2,nameOverride,bdayOverride)=>{const s=s2||scores;const v=v2||vedic;const nn=nameOverride||nick;const bd=bdayOverride||bday;if(!s||!nn||ai[type])return;setAiL(p=>({...p,[type]:true}));let r=null;try{const so=Object.entries(s).sort((a,b)=>b[1]-a[1]);
    if(type==="identity")r=await GPT.call(`‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡∏±‡∏ß‡∏ï‡∏ô"${nn}"3‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ Vedic+‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°:\n‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏î‡∏ß‡∏á:${Object.entries(v).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([k,v2])=>`${k}(${v2.toFixed(1)})`).join(",")}\n‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°:‡πÅ‡∏Ç‡πá‡∏á${so.slice(0,3).map(([k,v2])=>`${k}(${v2.toFixed(1)})`).join(",")} ‡∏≠‡πà‡∏≠‡∏ô${so.slice(-2).map(([k,v2])=>`${k}(${v2.toFixed(1)})`).join(",")}\n‡∏ñ‡πâ‡∏≤‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡πÅ‡∏ï‡πà‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≥‚Üí"‡∏î‡∏ß‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°"`,`id_${nn}`);
    if(type==="core")r=await GPT.call(`‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå5Core"${nn}"Vedic:\nüß†Cognitive(‡∏û‡∏∏‡∏ò):‡∏î‡∏ß‡∏á${v["Cognitive Processing"]?.toFixed(1)}‡∏à‡∏£‡∏¥‡∏á${s["Cognitive Processing"]?.toFixed(1)}\nüåäEmotional(‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå):‡∏î‡∏ß‡∏á${v["Emotional Regulation"]?.toFixed(1)}‡∏à‡∏£‡∏¥‡∏á${s["Emotional Regulation"]?.toFixed(1)}\n‚öìIdentity(‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå+‡πÄ‡∏™‡∏≤‡∏£‡πå):‡∏î‡∏ß‡∏á${v["Identity Stability"]?.toFixed(1)}‡∏à‡∏£‡∏¥‡∏á${s["Identity Stability"]?.toFixed(1)}\nüåëShadow(‡∏£‡∏≤‡∏´‡∏π/‡πÄ‡∏Å‡∏ï‡∏∏):‡∏î‡∏ß‡∏á${v["Shadow Pattern"]?.toFixed(1)}‡∏à‡∏£‡∏¥‡∏á${s["Shadow Pattern"]?.toFixed(1)}\nüå±Growth(‡∏û‡∏§‡∏´‡∏±‡∏™):‡∏î‡∏ß‡∏á${v["Growth Orientation"]?.toFixed(1)}‡∏à‡∏£‡∏¥‡∏á${s["Growth Orientation"]?.toFixed(1)}\n‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏î‡πâ‡∏≤‡∏ô1-2‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ`,`core_${nn}`);
    if(type==="12d")r=await GPT.call(`‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå12‡∏°‡∏¥‡∏ï‡∏¥"${nn}"Vedic:\n${Object.entries(s).map(([k,sv])=>`${k}:‡∏î‡∏ß‡∏á${v[k]?.toFixed(1)}‡∏à‡∏£‡∏¥‡∏á${sv.toFixed(1)}`).join("\n")}\n‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á4+‡∏î‡∏≤‡∏ß‡∏´‡∏ô‡∏∏‡∏ô ‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤4+action ‡∏ñ‡πâ‡∏≤gap>2‚Üíhighlight`,`f12_${nn}`);
    if(type==="shadow")r=await GPT.call(`Shadow"${nn}"Vedic(‡∏£‡∏≤‡∏´‡∏π/‡πÄ‡∏Å‡∏ï‡∏∏):\nShadow:‡∏î‡∏ß‡∏á${v["Shadow Pattern"]?.toFixed(1)}‡∏à‡∏£‡∏¥‡∏á${s["Shadow Pattern"]?.toFixed(1)}\nStress:${s["Stress Response"]?.toFixed(1)} Boundary:${s["Boundary System"]?.toFixed(1)}\n‚ö°Trigger üîÑPattern üí°‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡∏ï‡∏≤‡∏°‡∏î‡∏≤‡∏ß`,`sh_${nn}`);
    if(type==="weekly"){const t=await GPT.call(`‡πÇ‡∏´‡∏£‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏û‡∏£‡∏∞‡πÄ‡∏ß‡∏ó ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå"${nn}":\n‡πÅ‡∏Ç‡πá‡∏á:${so.slice(0,3).map(([k])=>k).join(",")} ‡∏≠‡πà‡∏≠‡∏ô:${so.slice(-2).map(([k])=>k).join(",")}\n‡∏ï‡∏≠‡∏öJSON‡πÑ‡∏°‡πà‡∏°‡∏µbacktick:{"do":["‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥1","‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥2","‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥3"],"dont":["‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á1","‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á2","‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á3"]}`,`wk_${nn}`);r=pJ(t)}
    // Energy: show smart fallback FIRST then try GPT
    if(type==="energy"){const tr=gen7Day(bd);const MOODS=["üåü ‡∏™‡∏î‡πÉ‡∏™","üòä ‡∏™‡∏á‡∏ö","üî• ‡∏Å‡∏£‡∏∞‡∏ï‡∏∑‡∏≠‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏ô","üß† ‡∏Ñ‡∏¥‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå","üìö ‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏õ‡∏¥‡∏î","üíé ‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢","‚öôÔ∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢"];
      const smartFB=tr.map((d,i)=>({day:d.dn,date:d.date,energy:d.ce,mood:d.ce>75?MOODS[0]:d.ce>65?MOODS[1]:d.ce>55?MOODS[3]:MOODS[6],tip:`‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô${d.dl.icon}${d.dl.lord} ${d.dl.q} ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ${d.moonR}(${d.ma.r})`,transit:`‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô${d.dl.icon}${d.dl.lord} + ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ${d.moonR} + ‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£‡∏à‡∏£‡∏£‡∏≤‡∏®‡∏µ${d.marsR}`,goodFor:d.dl.gf}));
      setAi(p=>({...p,energy:smartFB}));setAiL(p=>({...p,energy:false}));
      // Try GPT upgrade in background (non-blocking)
      GPT.call(`‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô7‡∏ß‡∏±‡∏ô"${nn}"‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î‡∏£‡∏≤‡∏®‡∏µ${tr[0].nmR} Em:${s["Emotional Regulation"]?.toFixed(1)} En:${s["Energy Management"]?.toFixed(1)}\n${tr.map(d=>`${d.dn}${d.date}:${d.dl.icon}${d.dl.lord} ‡∏à${d.moonR}(${d.ma.r}) ‡∏≠${d.marsR}(${d.md.d}) E=${d.ce}%`).join("\n")}\n‡∏ï‡∏≠‡∏öJSON7obj:[{"day":"‡∏ß‡∏±‡∏ô","date":"d/m","energy":30‡∏ñ‡∏∂‡∏á95,"mood":"emoji+2‡∏Ñ‡∏≥","tip":"‡∏™‡∏±‡πâ‡∏ô‡∏≠‡πâ‡∏≤‡∏á‡∏î‡∏≤‡∏ß","transit":"‡∏î‡∏≤‡∏ß","goodFor":"‡∏™‡∏±‡πâ‡∏ô"}]`,`en_${nn}_${new Date().toISOString().slice(0,10)}`).then(t=>{const p=pJ(t);if(p&&Array.isArray(p)&&p.length===7){setAi(prev=>({...prev,energy:p.map(d=>({...d,energy:d.energy<15?Math.round(d.energy*10):d.energy}))}))}});
      return}
    // Job: show smart fallback FIRST then try GPT
    if(type==="job"){const top3=so.slice(0,3).map(([k])=>k);const bot2=so.slice(-2).map(([k])=>k);
      const JOB_MAP={"Cognitive Processing":[{t:"Data Analyst",th:"‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"},{t:"Software Engineer",th:"‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå"}],"Energy Management":[{t:"Project Manager",th:"‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå"},{t:"Sales Manager",th:"‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢"}],"Emotional Regulation":[{t:"UX Researcher",th:"‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢ UX"},{t:"Counselor",th:"‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤"}],"Decision System":[{t:"Financial Planner",th:"‡∏ô‡∏±‡∏Å‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô"},{t:"Strategy Consultant",th:"‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå"}],"Growth Orientation":[{t:"Product Manager",th:"‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå"},{t:"Researcher",th:"‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢"}],"Motivation Driver":[{t:"Entrepreneur",th:"‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£"},{t:"Marketing Manager",th:"‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î"}],"Responsibility Load":[{t:"Operations Manager",th:"‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£"},{t:"Quality Assurance",th:"QA Engineer"}]};
      const picks=[];const seen=new Set();top3.forEach(dim=>{(JOB_MAP[dim]||JOB_MAP["Cognitive Processing"]).forEach(j=>{if(!seen.has(j.t)&&picks.length<3){seen.add(j.t);picks.push({title:j.t,titleTH:j.th,match:Math.round(85-picks.length*5+s[dim]),dims:top3.slice(0,3).join(" + "),reason:`${DM[dim]?.icon}${dim}(${s[dim]?.toFixed(1)})‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡∏´‡∏ô‡∏∏‡∏ô‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ ‡∏î‡∏≤‡∏ß${DM[dim]?.pl}‡∏™‡πà‡∏á‡∏û‡∏•‡∏±‡∏á`})}})});
      while(picks.length<3)picks.push({title:"Business Analyst",titleTH:"‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à",match:75,dims:top3.join(" + "),reason:"‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"});
      setAi(p=>({...p,job:picks}));setAiL(p=>({...p,job:false}));
      // Try GPT upgrade in background
      GPT.call(`JobMatch"${nn}"‡πÅ‡∏Ç‡πá‡∏á:${so.slice(0,4).map(([k,v2])=>`${k}=${v2.toFixed(1)}`).join(",")} ‡∏≠‡πà‡∏≠‡∏ô:${so.slice(-3).map(([k,v2])=>`${k}=${v2.toFixed(1)}`).join(",")}\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥3‡∏≠‡∏≤‡∏ä‡∏µ‡∏û+‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡πâ‡∏≤‡∏ádim+‡∏î‡∏≤‡∏ß ‡∏ï‡∏≠‡∏öJSON:[{"title":"EN","titleTH":"‡πÑ‡∏ó‡∏¢","match":‡πÄ‡∏•‡∏Ç,"dims":"3‡∏°‡∏¥‡∏ï‡∏¥","reason":"2‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ"}]`,`job_${nn}`).then(t=>{const p=pJ(t);if(p&&Array.isArray(p)&&p.length>=3)setAi(prev=>({...prev,job:p}))});
      return}
  }catch{}setAi(p=>({...p,[type]:r}));setAiL(p=>({...p,[type]:false}))};

  const tryUpgrade=p=>{
    localStorage.setItem("hss_want_plan",p);
    if(!logged){setPendingPlan(p);setLoginModal(true);setAuthErr("");setAuthMode("login")}
    else{goStripe(p)}};

  const goStripe=async(p)=>{
    // Save current user email for post-payment re-login
    if(user?.email)localStorage.setItem("hss_user_email",user.email);
    try{const r=await fetch("/api/stripe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:p,userId:user?.id||"",email:user?.email||email})});const d=await r.json();if(d.url)window.location.href=d.url;else alert(d.error||"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î")}catch{alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Stripe ‡πÑ‡∏î‡πâ")}};

  // Real Supabase Auth
  const doSignup=async()=>{const ae=authEmailRef.current?.value||"";const ap=authPwRef.current?.value||"";if(!ae||!ap){setAuthErr("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");return}if(ap.length<6){setAuthErr("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£");return}setAuthLoading(true);setAuthErr("");
    const{data,error}=await sb.auth.signUp({email:ae,password:ap,options:{data:{},emailRedirectTo:undefined}});
    if(error){
      // If "email rate limit exceeded" or similar, try login instead
      if(error.message?.includes("rate limit")){setAuthErr("‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏ï‡πá‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' ‡πÅ‡∏ó‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢ Google");setAuthLoading(false);return}
      setAuthErr(error.message);setAuthLoading(false);return}
    // Check if email confirmation is required (session will be null)
    if(data?.session){
      // No email confirmation needed ‚Äî proceed normally
      setUser(data.user||data.session.user);setEmail(ae);setLoginModal(false);
      const wp=localStorage.getItem("hss_want_plan");
      if(wp){localStorage.removeItem("hss_want_plan");goStripe(wp)}
    } else if(data?.user){
      // Email confirmation required ‚Äî auto-login immediately
      const{data:loginData,error:loginErr}=await sb.auth.signInWithPassword({email:ae,password:ap});
      if(loginData?.user){
        setUser(loginData.user);setEmail(ae);setLoginModal(false);
        const wp=localStorage.getItem("hss_want_plan");
        if(wp){localStorage.removeItem("hss_want_plan");goStripe(wp)}
      } else {
        // Cannot auto-login (email confirm truly required) ‚Äî inform user
        setAuthErr("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ");setAuthMode("login");
      }
    }setAuthLoading(false)};

  const doLogin=async()=>{const ae=authEmailRef.current?.value||"";const ap=authPwRef.current?.value||"";if(!ae||!ap){setAuthErr("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");return}setAuthLoading(true);setAuthErr("");
    const{data,error}=await sb.auth.signInWithPassword({email:ae,password:ap});
    if(error){
      if(error.message==="Invalid login credentials")setAuthErr("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      else if(error.message?.includes("Email not confirmed"))setAuthErr("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢ Google");
      else setAuthErr(error.message);
      setAuthLoading(false);return}
    if(data?.user){setUser(data.user);setEmail(ae);setLoginModal(false);
      // Check if we need to go to Stripe
      const wp=localStorage.getItem("hss_want_plan");
      if(wp){localStorage.removeItem("hss_want_plan");goStripe(wp)}
      else{
        // Check if there's a paid plan waiting to activate
        const paidPlan=localStorage.getItem("hss_paid_plan");
        const paidAt=parseInt(localStorage.getItem("hss_paid_at")||"0");
        if(paidPlan&&(Date.now()-paidAt<3600000)){
          setPlan(paidPlan);ST.set("plan",paidPlan);
          sb.from("profiles").update({plan:paidPlan,updated_at:new Date().toISOString()}).eq("id",data.user.id);
          localStorage.removeItem("hss_paid_plan");localStorage.removeItem("hss_paid_at");
        }
        // Load profile & results
        const{data:prof}=await sb.from("profiles").select("*").eq("id",data.user.id).single();
        if(prof){setNick(prof.nick||"");setBday(prof.bday||"--");setBtime(prof.btime||"");setTSlot(prof.time_slot||"");setProv(prof.province||"");if(!paidPlan)setPlan(prof.plan||"free")}
        const{data:assess}=await sb.from("assessments").select("*").eq("user_id",data.user.id).order("created_at",{ascending:false}).limit(1).single();
        if(assess&&assess.scores){setAns(assess.answers||{});setScores(assess.scores);setVedic(assess.vedic);setSc("results");if(assess.ai_results)setAi(assess.ai_results)}
      }
    }setAuthLoading(false)};

  const doGoogle=async()=>{if(!sb)return;setAuthLoading(true);
    await sb.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}})};

  const doLogout=async()=>{if(sb)await sb.auth.signOut();setUser(null);setSc("landing");setScores(null);setVedic(null);setAns({});setAi({});setQI(0);setPlan("free");localStorage.clear()};

  const activatePlan=(p)=>{setPlan(p);ST.set("plan",p);savePlan(p);const fs=PLANS[p].f;if(fs.includes("12d")&&!ai["12d"])loadAI("12d");if(fs.includes("shadow")&&!ai.shadow)loadAI("shadow");if(fs.includes("weekly")&&!ai.weekly)loadAI("weekly");if(fs.includes("energy")&&!ai.energy)loadAI("energy");if(fs.includes("job")&&!ai.job)loadAI("job")};

  const exportPDF=()=>{if(!scores)return;const so=Object.entries(scores).sort((a,b)=>b[1]-a[1]);const w=window.open("","_blank");
    // Spider chart SVG for PDF
    const keys=Object.keys(scores);const vals=Object.values(scores);const n=keys.length;const sz=300,cx=150,cy=150,rad=100;
    const pt=(i,v)=>{const a=Math.PI*2*i/n-Math.PI/2;return{x:cx+Math.cos(a)*v/10*rad,y:cy+Math.sin(a)*v/10*rad}};
    const spiderSVG=`<svg viewBox="0 0 ${sz} ${sz}" style="width:280px;margin:10px auto;display:block">${[2,4,6,8,10].map(l=>`<polygon points="${keys.map((_,i)=>{const p=pt(i,l);return`${p.x},${p.y}`}).join(" ")}" fill="none" stroke="#E5E7EB" stroke-width=".6"/>`).join("")}<polygon points="${keys.map((_,i)=>{const p=pt(i,vals[i]);return`${p.x},${p.y}`}).join(" ")}" fill="rgba(99,102,241,.12)" stroke="#6366F1" stroke-width="1.8"/>${keys.map((_,i)=>{const p=pt(i,vals[i]);return`<circle cx="${p.x}" cy="${p.y}" r="2.5" fill="#6366F1" stroke="#fff" stroke-width="1.2"/>`}).join("")}${keys.map((k,i)=>{const p=pt(i,12.5);const sh=k.length>14?k.slice(0,12)+"‚Ä¶":k;return`<text x="${p.x}" y="${p.y}" text-anchor="middle" dominant-baseline="middle" style="font-size:5.5px;fill:#6B7280;font-weight:500">${sh}</text>`}).join("")}</svg>`;
    // Weekly
    const wk=ai.weekly&&typeof ai.weekly==="object"?`<h2>üìã Do & Don't ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h2><div class="g"><div class="card" style="background:#ECFDF5"><b style="color:#059669">‚úÖ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥</b>${(ai.weekly.do||[]).map(t=>`<p>‚Ä¢ ${t}</p>`).join("")}</div><div class="card" style="background:#FFF1F2"><b style="color:#EF4444">‚ùå ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á</b>${(ai.weekly.dont||[]).map(t=>`<p>‚Ä¢ ${t}</p>`).join("")}</div></div>`:"";
    // Energy with full details
    const en=ai.energy&&Array.isArray(ai.energy)?`<h2>üåô 7-Day Energy</h2>${ai.energy.map(d=>`<div class="card" style="margin:4px 0"><div style="display:flex;justify-content:space-between;margin-bottom:2px"><b>${d.day} ${d.date||""}</b><span>${d.mood||""}</span></div>${d.transit?`<div style="font-size:10px;color:#7C3AED">ü™ê ${d.transit}</div>`:""}${d.goodFor?`<div style="font-size:10px;color:#059669">‚úÖ ${d.goodFor}</div>`:""}${d.tip?`<div style="font-size:10px;color:#374151">üí° ${d.tip}</div>`:""}</div>`).join("")}`:"";
    // Job
    const jb=ai.job&&Array.isArray(ai.job)?`<h2>üíº Job Matching</h2>${ai.job.map(j=>`<div class="card"><b>${j.titleTH||j.title} (${j.match}%)</b><div style="font-size:11px;color:#64748B">${j.dims||""}</div><p>${j.reason}</p></div>`).join("")}`:"";
    // Dasha/Life Phase
    const dashaPhases=calcDasha(bday);const currentDasha=dashaPhases.find(d=>d.isCurrent);
    const dashaHTML=dashaPhases.length>0?`<h2>üó∫ Life Phase Map (Vedic Dasha)</h2>${currentDasha?`<div class="card" style="background:linear-gradient(135deg,#EEF2FF,#F5F3FF);border:2px solid #6366F1"><b style="color:#4338CA;font-size:14px">${currentDasha.icon} ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á: ${currentDasha.theme}</b><div style="font-size:11px;margin-top:4px">‡∏°‡∏´‡∏≤‡∏ó‡∏®‡∏≤${currentDasha.p} (‡∏≠‡∏≤‡∏¢‡∏∏ ${currentDasha.startAge}‚Äì${currentDasha.endAge} ‡∏õ‡∏µ | ${currentDasha.startYear}‚Äì${currentDasha.endYear})</div><div style="font-size:11px;margin-top:2px;color:#374151">${currentDasha.desc}</div><div style="font-size:11px;color:#059669;margin-top:2px">üéØ ‡πÇ‡∏ü‡∏Å‡∏±‡∏™: ${currentDasha.focus}</div><div style="font-size:11px;color:#374151;margin-top:4px;background:#FFF7ED;padding:6px 8px;border-radius:6px">${currentDasha.cheer}</div><div style="font-size:10px;color:#B45309;margin-top:4px;background:#FFFBEB;padding:4px 8px;border-radius:6px">${currentDasha.warn}</div></div>`:""}${dashaPhases.filter(d=>!d.isPast||d.isCurrent).slice(0,6).map(d=>`<div style="display:flex;align-items:center;gap:8px;padding:4px 0;border-bottom:1px solid #F1F5F9;${d.isCurrent?"font-weight:700;color:#4338CA":"color:#374151"}"><span style="font-size:14px">${d.icon}</span><span style="font-size:11px;flex:1">${d.p} ‚Äî ${d.theme}</span><span style="font-size:10px;color:#94A3B8">${d.startAge}‚Äì${d.endAge} ‡∏õ‡∏µ</span></div>`).join("")}`:"";
    // Build full PDF
    w.document.write(`<!DOCTYPE html><html><head><meta charset="utf-8"><title>HSS Report - ${nick}</title><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600;700&display=swap" rel="stylesheet"><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Noto Sans Thai',sans-serif;padding:40px;color:#1E293B;max-width:700px;margin:0 auto;font-size:13px;line-height:1.7}h1{font-size:22px;margin-bottom:8px}h2{font-size:15px;margin:24px 0 8px;color:#4338CA;border-bottom:2px solid #EEF2FF;padding-bottom:4px}.bar{height:8px;border-radius:4px;margin:4px 0 10px}.card{background:#F8FAFC;border-radius:10px;padding:12px;margin:6px 0}.g{display:grid;grid-template-columns:1fr 1fr;gap:8px}.tag{display:inline-block;padding:2px 8px;border-radius:6px;font-size:11px;font-weight:700}p{margin:3px 0}@media print{body{padding:20px}}</style></head><body>
<h1>üîÆ ${nick} ‚Äî Human System Studio</h1><p style="color:#64748B">Vedic Astrology + Psychology ¬∑ ${new Date().toLocaleDateString("th-TH")}</p>
${ai.identity?`<h2>‚ú¶ Identity Snapshot</h2><p>${ai.identity}</p>`:""}
<h2>üìä 12 Dimensions</h2>${spiderSVG}
${Object.entries(scores).map(([k,v])=>`<div style="margin:6px 0"><div style="display:flex;justify-content:space-between"><span>${DM[k]?.icon} ${k} <span style="font-size:10px;color:#94A3B8">(${DM[k]?.pl})</span></span><b style="color:${DM[k]?.c}">${v.toFixed(1)}</b></div><div class="bar" style="background:#E2E8F0"><div style="height:100%;width:${v*10}%;background:${DM[k]?.c};border-radius:4px"></div></div></div>`).join("")}
<h2>üí™ ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á</h2><div class="g">${so.slice(0,4).map(([k,v])=>`<div class="card"><span class="tag" style="background:#ECFDF5;color:#059669">${v.toFixed(1)}</span> ${DM[k]?.icon} ${k}</div>`).join("")}</div>
<h2>‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤</h2><div class="g">${so.slice(-4).map(([k,v])=>`<div class="card"><span class="tag" style="background:#FFF1F2;color:#EF4444">${v.toFixed(1)}</span> ${DM[k]?.icon} ${k}</div>`).join("")}</div>
${ai.core?`<h2>üèõ 5 Core Analysis</h2><p style="white-space:pre-wrap">${ai.core}</p>`:""}
${ai["12d"]?`<h2>üìê 12D Deep Analysis</h2><p style="white-space:pre-wrap">${ai["12d"]}</p>`:""}
${ai.shadow?`<h2>üåë Shadow Analysis</h2><p style="white-space:pre-wrap">${ai.shadow}</p>`:""}
${wk} ${en} ${jb} ${dashaHTML}
<p style="margin-top:30px;font-size:11px;color:#94A3B8;text-align:center">Human System Studio ¬∑ Vedic Astrology + Psychology ¬∑ ${new Date().toLocaleDateString("th-TH")}</p></body></html>`);w.document.close();setTimeout(()=>w.print(),500)};

  const shareProfile=()=>{if(!scores||!nick)return;
    const W=1080,H=1080;const cv=document.createElement("canvas");cv.width=W;cv.height=H;const ctx=cv.getContext("2d");
    // roundRect polyfill
    if(!ctx.roundRect){ctx.roundRect=function(x,y,w,h,r){r=Math.min(r,w/2,h/2);this.moveTo(x+r,y);this.lineTo(x+w-r,y);this.quadraticCurveTo(x+w,y,x+w,y+r);this.lineTo(x+w,y+h-r);this.quadraticCurveTo(x+w,y+h,x+w-r,y+h);this.lineTo(x+r,y+h);this.quadraticCurveTo(x,y+h,x,y+h-r);this.lineTo(x,y+r);this.quadraticCurveTo(x,y,x+r,y)}};
    // Background gradient
    const bg=ctx.createLinearGradient(0,0,W,H);bg.addColorStop(0,"#1E1B4B");bg.addColorStop(1,"#312E81");ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);
    // Decorative circles
    ctx.globalAlpha=.06;ctx.fillStyle="#A78BFA";ctx.beginPath();ctx.arc(180,180,300,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.arc(900,900,350,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;
    // Header
    ctx.fillStyle="#fff";ctx.font="bold 52px 'Noto Sans Thai',sans-serif";ctx.textAlign="center";ctx.fillText(`‚ú¶ ${nick}`,W/2,90);
    ctx.font="24px 'Noto Sans Thai',sans-serif";ctx.fillStyle="#A5B4FC";ctx.fillText("Human System Studio ¬∑ Vedic + Psychology",W/2,130);
    // Spider chart
    const so=Object.entries(scores).sort((a,b)=>b[1]-a[1]);const keys=Object.keys(scores);const vals=Object.values(scores);const n=keys.length;
    const cx=W/2,cy=370,rad=180;
    const pt=(i,v)=>{const a=Math.PI*2*i/n-Math.PI/2;return{x:cx+Math.cos(a)*v/10*rad,y:cy+Math.sin(a)*v/10*rad}};
    // Grid
    [2,4,6,8,10].forEach(l=>{ctx.beginPath();for(let i=0;i<=n;i++){const p=pt(i%n,l);i===0?ctx.moveTo(p.x,p.y):ctx.lineTo(p.x,p.y)}ctx.strokeStyle="rgba(165,180,252,.15)";ctx.lineWidth=1;ctx.stroke()});
    // Polygon fill
    ctx.beginPath();keys.forEach((_,i)=>{const p=pt(i,vals[i]);i===0?ctx.moveTo(p.x,p.y):ctx.lineTo(p.x,p.y)});ctx.closePath();ctx.fillStyle="rgba(99,102,241,.25)";ctx.fill();ctx.strokeStyle="#818CF8";ctx.lineWidth=2.5;ctx.stroke();
    // Points + labels
    keys.forEach((k,i)=>{const p=pt(i,vals[i]);ctx.beginPath();ctx.arc(p.x,p.y,4,0,Math.PI*2);ctx.fillStyle="#818CF8";ctx.fill();ctx.strokeStyle="#1E1B4B";ctx.lineWidth=2;ctx.stroke();
      const lp=pt(i,12);ctx.fillStyle="#C7D2FE";ctx.font="13px 'Noto Sans Thai',sans-serif";ctx.textAlign="center";ctx.fillText(k.length>12?k.slice(0,10)+"‚Ä¶":k,lp.x,lp.y+5)});
    // Top strengths
    const y1=580;ctx.fillStyle="#fff";ctx.font="bold 28px 'Noto Sans Thai',sans-serif";ctx.textAlign="left";ctx.fillText("üí™ ‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á",60,y1);
    so.slice(0,3).forEach(([k,v],i)=>{const y=y1+40+i*50;ctx.fillStyle="#10B981";ctx.font="bold 22px 'Noto Sans Thai',sans-serif";ctx.fillText(`${DM[k]?.icon} ${k}`,80,y);ctx.fillStyle="#6EE7B7";ctx.font="bold 20px 'Noto Sans Thai',sans-serif";ctx.fillText(`${v.toFixed(1)}/10`,900,y);
      // Bar
      ctx.fillStyle="rgba(16,185,129,.15)";const bx=80,bw=860,by2=y+8,bh=8;ctx.beginPath();ctx.roundRect(bx,by2,bw,bh,4);ctx.fill();ctx.fillStyle="#10B981";ctx.beginPath();ctx.roundRect(bx,by2,bw*v/10,bh,4);ctx.fill()});
    // Shadow work
    const shadow=so.slice(-2);const y2=y1+200;ctx.fillStyle="#fff";ctx.font="bold 28px 'Noto Sans Thai',sans-serif";ctx.fillText("üåë Shadow Work",60,y2);
    shadow.forEach(([k,v],i)=>{const y=y2+40+i*50;ctx.fillStyle="#F87171";ctx.font="bold 22px 'Noto Sans Thai',sans-serif";ctx.fillText(`${DM[k]?.icon} ${k}`,80,y);ctx.fillStyle="#FCA5A5";ctx.font="bold 20px 'Noto Sans Thai',sans-serif";ctx.fillText(`${v.toFixed(1)}/10`,900,y);
      ctx.fillStyle="rgba(248,113,113,.15)";const bx=80,bw=860,by2=y+8,bh=8;ctx.beginPath();ctx.roundRect(bx,by2,bw,bh,4);ctx.fill();ctx.fillStyle="#F87171";ctx.beginPath();ctx.roundRect(bx,by2,bw*v/10,bh,4);ctx.fill()});
    // Encouragement message
    const topName=so[0][0];const botName=shadow[0][0];
    const SHADOW_TIPS={"Shadow Pattern":"‡∏•‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏Ñ‡πà '‡∏£‡∏π‡πâ‡∏ï‡∏±‡∏ß' ‡∏Å‡πá‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß","Stress Response":"‡∏•‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏é: ‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏Å‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏°. ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏Ñ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°","Boundary System":"‡∏ù‡∏∂‡∏Å‡∏û‡∏π‡∏î‡∏ß‡πà‡∏≤ '‡∏Ç‡∏≠‡∏Ñ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô' ‡πÅ‡∏ó‡∏ô '‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢' ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏Ç‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á","Responsibility Load":"‡∏•‡∏≠‡∏á‡∏ó‡∏≥ '‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î' ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠","Emotional Regulation":"‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏•‡∏á 1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏∏‡∏Å‡πÄ‡∏ä‡πâ‡∏≤ ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô","Energy Management":"‡∏û‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏™‡∏±‡∏Å 15 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏î‡∏π‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏à‡∏∞‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì","Integration Level":"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡πÅ‡∏Ñ‡πà‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô"};
    const tip=SHADOW_TIPS[botName]||"‡∏•‡∏≠‡∏á‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏µ‡∏•‡∏∞‡∏ô‡∏¥‡∏î ‡∏ó‡∏∏‡∏Å‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç";
    const y3=y2+160;
    // Encouragement box background
    ctx.fillStyle="rgba(99,102,241,.12)";ctx.beginPath();ctx.roundRect(50,y3,W-100,120,12);ctx.fill();ctx.strokeStyle="rgba(165,180,252,.3)";ctx.lineWidth=1;ctx.stroke();
    // Encouragement text
    ctx.fillStyle="#E0E7FF";ctx.font="bold 22px 'Noto Sans Thai',sans-serif";ctx.textAlign="left";
    ctx.fillText(`üíú ‡∏™‡∏π‡πâ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ô‡∏∞ ${nick}! ‡πÄ‡∏Å‡πà‡∏á‡∏î‡πâ‡∏≤‡∏ô ${DM[topName]?.icon}${topName}`,80,y3+32);
    ctx.fillStyle="#C7D2FE";ctx.font="20px 'Noto Sans Thai',sans-serif";
    ctx.fillText(`‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ${DM[botName]?.icon}${botName}`,80,y3+62);
    ctx.fillStyle="#A5B4FC";ctx.font="18px 'Noto Sans Thai',sans-serif";
    // Wrap tip text
    const maxW=W-180;const words=tip.split("");let line="";let ly=y3+92;
    for(const ch of words){const test=line+ch;if(ctx.measureText(test).width>maxW){ctx.fillText(line,80,ly);line=ch;ly+=24}else line=test}if(line)ctx.fillText(line,80,ly);
    // Footer
    const fy=Math.max(ly+50,H-60);
    ctx.fillStyle="#64748B";ctx.font="18px 'Noto Sans Thai',sans-serif";ctx.textAlign="center";ctx.fillText("humansystemstudio.com ¬∑ Vedic Astrology √ó Psychology",W/2,fy);
    ctx.fillStyle="#A5B4FC";ctx.font="bold 18px 'Noto Sans Thai',sans-serif";ctx.fillText("‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ü‡∏£‡∏µ ‚Üí",W/2,fy+25);
    // Download
    cv.toBlob(blob=>{const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`HSS-${nick}.png`;a.click();URL.revokeObjectURL(url)},"image/png")};

  // Login/Signup Modal rendered inline with stable input refs
  const loginModalJSX=loginModal&&<div style={{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999,padding:20}} onClick={()=>{setLoginModal(false);setAuthErr("")}}><div onClick={e=>e.stopPropagation()} style={{background:"#fff",borderRadius:16,padding:24,maxWidth:360,width:"100%"}}>
  <div style={{fontSize:16,fontWeight:800,marginBottom:4}}>{authMode==="login"?"üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö":"‚ú® ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å"}</div>
  <div style={{fontSize:12,color:"#64748B",marginBottom:16}}>{authMode==="login"?"‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à":"‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)"}</div>
  {authErr&&<div style={{padding:"8px 12px",borderRadius:8,background:"#FEF2F2",border:"1px solid #FECACA",color:"#DC2626",fontSize:12,marginBottom:12}}>{authErr}</div>}
  <div style={{marginBottom:12}}><label style={{fontSize:12,fontWeight:600,color:"#64748B",display:"block",marginBottom:4}}>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label><input key="auth-email-input" ref={authEmailRef} defaultValue={email||localStorage.getItem("hss_user_email")||""} placeholder="your@email.com" type="email" autoComplete="email" style={{width:"100%",padding:"10px 14px",fontSize:14,border:"2px solid #E2E8F0",borderRadius:10,outline:"none",boxSizing:"border-box"}}/></div>
  <div style={{marginBottom:16}}><label style={{fontSize:12,fontWeight:600,color:"#64748B",display:"block",marginBottom:4}}>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input key="auth-pw-input" ref={authPwRef} defaultValue="" type="password" placeholder={authMode==="signup"?"‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß)":"‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"} autoComplete={authMode==="signup"?"new-password":"current-password"} onKeyDown={e=>{if(e.key==="Enter"){authMode==="login"?doLogin():doSignup()}}} style={{width:"100%",padding:"10px 14px",fontSize:14,border:"2px solid #E2E8F0",borderRadius:10,outline:"none",boxSizing:"border-box"}}/></div>
  <Btn onClick={authMode==="login"?doLogin:doSignup} ok={!authLoading}>{authLoading?"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...":authMode==="login"?"‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‚Üí":"‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚Üí"}</Btn>
  <div style={{textAlign:"center",marginTop:12}}><button onClick={()=>{setAuthMode(authMode==="login"?"signup":"login");setAuthErr("")}} style={{background:"none",border:"none",fontSize:12,color:"#6366F1",fontWeight:600,cursor:"pointer"}}>{authMode==="login"?"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å":"‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"}</button></div>
  <div style={{display:"flex",alignItems:"center",gap:8,margin:"12px 0"}}><div style={{flex:1,height:1,background:"#E2E8F0"}}/><span style={{fontSize:11,color:"#94A3B8"}}>‡∏´‡∏£‡∏∑‡∏≠</span><div style={{flex:1,height:1,background:"#E2E8F0"}}/></div>
  <button onClick={doGoogle} disabled={authLoading} style={{width:"100%",padding:10,borderRadius:8,border:"2px solid #E2E8F0",background:"#fff",fontSize:13,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}><svg width="18" height="18" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢ Google</button>
  </div></div>;

  // ‚îÄ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ‚îÄ
  const Landing=()=><div style={{minHeight:"100vh"}}><div style={{display:"flex",justifyContent:"flex-end",padding:"12px 20px 0"}}>{logged?<div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:11,color:"#64748B"}}>{user?.email?.split("@")[0]}</span><button onClick={doLogout} style={{fontSize:11,color:"#64748B",background:"none",border:"1px solid #E2E8F0",borderRadius:6,padding:"4px 10px",cursor:"pointer"}}>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button></div>:<button onClick={()=>{setLoginModal(true);setAuthErr("");setAuthMode("login")}} style={{fontSize:12,fontWeight:600,color:"#4338CA",background:"#EEF2FF",border:"1px solid #C7D2FE",borderRadius:8,padding:"6px 16px",cursor:"pointer"}}>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>}</div><div style={{textAlign:"center",padding:"40px 20px 40px",position:"relative",overflow:"hidden"}}><div style={{position:"absolute",inset:0,background:"radial-gradient(ellipse at 30% 20%,rgba(67,56,202,.08),transparent 60%),radial-gradient(ellipse at 70% 80%,rgba(139,92,246,.06),transparent 50%)",zIndex:0}}/><div style={{position:"relative",zIndex:1}}><div style={{width:52,height:52,borderRadius:14,background:"linear-gradient(135deg,#4338CA,#6D28D9)",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:24,color:"#fff",boxShadow:"0 8px 24px rgba(67,56,202,.3)",animation:"hfl 3s ease-in-out infinite",marginBottom:16}}>‚ú¶</div><h1 style={{fontSize:26,fontWeight:800,color:"#1E293B",marginBottom:6}}>{BRAND}</h1><p style={{fontSize:15,fontWeight:600,color:"#4338CA",marginBottom:6}}>‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</p><p style={{fontSize:13,color:"#64748B",lineHeight:1.7,maxWidth:380,margin:"0 auto 20px"}}>‡∏î‡πâ‡∏ß‡∏¢ AI + Vedic Astrology + ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 36 ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</p><div style={{maxWidth:280,margin:"0 auto"}}><Btn onClick={()=>setSc("profile")}>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ü‡∏£‡∏µ ‚Üí</Btn>{logged&&scores&&<button onClick={()=>setSc("results")} style={{width:"100%",marginTop:8,padding:10,borderRadius:8,border:"2px solid #6366F1",background:"#fff",color:"#4338CA",fontSize:13,fontWeight:700,cursor:"pointer"}}>üìä ‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏î‡∏¥‡∏°</button>}</div></div></div><div style={{padding:"0 20px",maxWidth:520,margin:"0 auto"}}><Card style={{background:"linear-gradient(135deg,#F5F3FF,#EEF2FF)",border:"1px solid #DDD6FE"}}><h3 style={{fontSize:14,fontWeight:700,color:"#4338CA",marginBottom:6}}>üîé ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ "‡∏î‡∏ß‡∏á + ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°" ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô?</h3><p style={{fontSize:12,color:"#374151",lineHeight:1.7}}>‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô "‡∏î‡∏ß‡∏á‡∏î‡∏µ" ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô ‡∏ö‡∏≤‡∏á‡∏Ñ‡∏ô "‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏•‡∏≤‡∏á" ‡πÅ‡∏ï‡πà‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏á</p><div style={{marginTop:10,padding:10,background:"#fff",borderRadius:8,textAlign:"center"}}><p style={{fontSize:14,fontWeight:700,color:"#6D28D9"}}>‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î √ó ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á</p></div></Card><div style={{marginBottom:16}}><h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>3 ‡∏ä‡∏±‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>{[{i:"ü™ê",t:"Vedic Astrology",d:"‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î"},{i:"üìã",t:"Psychology 36 ‡∏Ç‡πâ‡∏≠",d:"‡∏ß‡∏±‡∏î‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏£‡∏¥‡∏á"},{i:"ü§ñ",t:"AI Insight Engine",d:"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á"}].map((x,i)=><Card key={i} style={{display:"flex",gap:10,alignItems:"center"}}><div style={{width:38,height:38,borderRadius:10,background:"#F5F3FF",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,flexShrink:0}}>{x.i}</div><div><div style={{fontSize:13,fontWeight:700}}>{x.t}</div><div style={{fontSize:11,color:"#64748B"}}>{x.d}</div></div></Card>)}</div><h3 style={{fontSize:14,fontWeight:700,marginBottom:8}}>‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</h3>{[{p:"free",t:"üü¢ Free",pr:"‡∏ø0",d:"‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á",it:["Identity Snapshot (AI)","5 Core Scores + ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢"]},{p:"deep",t:"üü° Deep Insight",pr:"‡∏ø49",oldPr:"‡∏ø99",d:"Early Bird üî• ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û \"‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö\"",badge:"Early Bird",it:["‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á/‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤ 12 ‡∏°‡∏¥‡∏ï‡∏¥","Shadow Analysis ‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å","Do & Don't ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå","7-Day Energy Forecast"]},{p:"all",t:"üîµ All Access",pr:"‡∏ø99",oldPr:"‡∏ø249",d:"Early Bird üî• ‡πÉ‡∏ä‡πâ Insight ‡∏Å‡∏±‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á",badge:"Early Bird ‡∏Ñ‡∏∏‡πâ‡∏°‡∏™‡∏∏‡∏î",it:["Job Matching AI","Life Phase Map (Dasha)","PDF Report","Social Share Card"]}].map((x,i)=><Card key={i} style={{position:"relative",border:x.badge?`2px solid ${PLANS[x.p].c}`:"1px solid #F1F5F9"}}>{x.badge&&<span style={{position:"absolute",top:-10,right:12,background:PLANS[x.p].c,color:"#fff",fontSize:10,fontWeight:800,padding:"2px 10px",borderRadius:8}}>{x.badge}</span>}<div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}}><span style={{fontSize:14,fontWeight:700}}>{x.t}</span><div style={{textAlign:"right"}}>{x.oldPr&&<span style={{fontSize:12,color:"#94A3B8",textDecoration:"line-through",marginRight:4}}>{x.oldPr}</span>}<span style={{fontSize:17,fontWeight:800,color:PLANS[x.p].c}}>{x.pr}</span></div></div><p style={{fontSize:11,color:"#64748B",marginBottom:6}}>{x.d}</p>{x.it.map((it,j)=><div key={j} style={{fontSize:11,color:"#374151",padding:"2px 0"}}>‚úî {it}</div>)}{x.p==="free"?<button onClick={()=>setSc("profile")} style={{width:"100%",marginTop:8,padding:"8px 0",borderRadius:8,border:"2px solid #10B981",background:"#ECFDF5",color:"#059669",fontSize:12,fontWeight:700,cursor:"pointer"}}>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏ü‡∏£‡∏µ ‚Üí</button>:<button onClick={()=>tryUpgrade(x.p)} style={{width:"100%",marginTop:8,padding:"8px 0",borderRadius:8,border:"none",background:x.p==="deep"?"linear-gradient(135deg,#F59E0B,#D97706)":"linear-gradient(135deg,#4338CA,#6D28D9)",color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer",boxShadow:`0 4px 12px ${x.p==="deep"?"rgba(245,158,11,.3)":"rgba(67,56,202,.3)"}`}}>{x.p==="deep"?"‡∏ã‡∏∑‡πâ‡∏≠ Deep ‡∏ø49 ‚Üí":"‡∏ã‡∏∑‡πâ‡∏≠ All Access ‡∏ø99 ‚Üí"}</button>}</Card>)}<Card style={{padding:12,overflow:"auto"}}><table style={{width:"100%",borderCollapse:"collapse",fontSize:10}}><thead><tr style={{background:"#F8FAFC"}}><th style={{textAlign:"left",padding:"5px 6px",fontWeight:700,color:"#64748B"}}>‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå</th><th style={{textAlign:"center",padding:"5px 4px",fontWeight:700,color:"#10B981"}}>Free</th><th style={{textAlign:"center",padding:"5px 4px",fontWeight:700,color:"#F59E0B"}}>‡∏ø49</th><th style={{textAlign:"center",padding:"5px 4px",fontWeight:700,color:"#3B82F6"}}>‡∏ø99</th></tr></thead><tbody>{FT.map(([n,,f,d,a],i)=><tr key={i} style={{borderBottom:"1px solid #F1F5F9"}}><td style={{padding:"5px 6px"}}>{n}</td><td style={{textAlign:"center"}}>{f?"‚úÖ":"‚Äî"}</td><td style={{textAlign:"center"}}>{d?"‚úÖ":"‚Äî"}</td><td style={{textAlign:"center"}}>{a?"‚úÖ":"‚Äî"}</td></tr>)}</tbody></table></Card><Card style={{background:"#F0FDF4",border:"1px solid #BBF7D0"}}><div style={{fontSize:12,fontWeight:700,color:"#166534",marginBottom:4}}>üõ° ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div><div style={{fontSize:11,color:"#15803D"}}>‡πÑ‡∏°‡πà‡∏Ç‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ¬∑ ‡πÑ‡∏°‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏ú‡∏• ¬∑ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div></Card><div style={{padding:"16px 0 40px"}}><Btn onClick={()=>setSc("profile")}>‡πÄ‡∏£‡∏¥‡πà‡∏° Identity Snapshot ‡∏ü‡∏£‡∏µ ‚Üí</Btn></div></div></div>;

  // ‚îÄ‚îÄ‚îÄ PROFILE (fixed input) ‚îÄ‚îÄ‚îÄ
  const Profile=()=>{const inp={width:"100%",padding:"10px 14px",fontSize:14,border:"2px solid #E2E8F0",borderRadius:10,outline:"none",background:"#fff",boxSizing:"border-box"};const lbl={fontSize:12,fontWeight:600,color:"#64748B",marginBottom:4,display:"block"};const bp=bday.split("-");const ok=nick&&email&&bp.length===3&&bp[0]&&bp[1]&&bp[2]&&bp[0]!=="undefined"&&(knowT===true?(btime&&btime.includes(":")):(knowT===false?tSlot:false));
  return<div><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:14}}><button onClick={()=>setSc("landing")} style={{background:"none",border:"none",fontSize:18,cursor:"pointer"}}>‚Üê</button><div><div style={{fontSize:16,fontWeight:800}}>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div><div style={{fontSize:11,color:"#94A3B8"}}>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Vedic + ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</div></div></div>
  <Card>
  <div style={{marginBottom:12}}><label style={lbl}>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô *</label><input ref={nickRef} defaultValue={nick} onBlur={e=>setNick(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")e.target.blur()}} placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏¥‡∏ß" style={inp}/></div>
  <div style={{marginBottom:12}}><label style={lbl}>‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label><input ref={emailRef} defaultValue={email} onBlur={e=>setEmail(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")e.target.blur()}} placeholder="your@email.com" type="email" style={inp}/></div>
  <div style={{marginBottom:12}}><label style={lbl}>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î *</label><div style={{display:"flex",gap:6,marginBottom:6}}><select value={bp[2]||""} onChange={e=>setBday(`${bp[0]||"2000"}-${bp[1]||"01"}-${e.target.value}`)} style={{...inp,flex:1}}><option value="">‡∏ß‡∏±‡∏ô</option>{Array.from({length:31},(_,i)=>i+1).map(d=><option key={d} value={String(d).padStart(2,"0")}>{d}</option>)}</select><select value={bp[1]||""} onChange={e=>setBday(`${bp[0]||"2000"}-${e.target.value}-${bp[2]||"01"}`)} style={{...inp,flex:1.2}}><option value="">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>{["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."].map((m,i)=><option key={i} value={String(i+1).padStart(2,"0")}>{m}</option>)}</select><select value={bp[0]||""} onChange={e=>setBday(`${e.target.value}-${bp[1]||"01"}-${bp[2]||"01"}`)} style={{...inp,flex:1}}><option value="">‡∏õ‡∏µ</option>{Array.from({length:80},(_,i)=>2026-i).map(y=><option key={y} value={String(y)}>{y}({y+543})</option>)}</select></div><button onClick={()=>{const t=new Date();setBday(`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`)}} style={{fontSize:11,color:"#6366F1",background:"#EEF2FF",border:"1px solid #C7D2FE",borderRadius:6,padding:"4px 10px",cursor:"pointer"}}>üìÖ ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button></div>
  <div style={{marginBottom:12}}><label style={lbl}>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î *</label><div style={{display:"flex",gap:6,marginBottom:8}}><button onClick={()=>{setKnowT(true);setTSlot("")}} style={{flex:1,padding:8,borderRadius:8,border:`2px solid ${knowT===true?"#6366F1":"#E2E8F0"}`,background:knowT===true?"#EEF2FF":"#fff",fontSize:12,fontWeight:600,cursor:"pointer",color:knowT===true?"#4338CA":"#64748B"}}>‡∏£‡∏π‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î</button><button onClick={()=>{setKnowT(false);setBtime("")}} style={{flex:1,padding:8,borderRadius:8,border:`2px solid ${knowT===false?"#F59E0B":"#E2E8F0"}`,background:knowT===false?"#FFFBEB":"#fff",fontSize:12,fontWeight:600,cursor:"pointer",color:knowT===false?"#92400E":"#64748B"}}>‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Å‡∏¥‡∏î</button></div>{knowT===true&&<div style={{display:"flex",gap:6}}><select value={btime.split(":")[0]||""} onChange={e=>setBtime(`${e.target.value}:${btime.split(":")[1]||"00"}`)} style={{...inp,flex:1}}><option value="">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>{Array.from({length:24},(_,i)=>i).map(h=><option key={h} value={String(h).padStart(2,"0")}>{String(h).padStart(2,"0")}‡∏ô.</option>)}</select><select value={btime.split(":")[1]||""} onChange={e=>setBtime(`${btime.split(":")[0]||"00"}:${e.target.value}`)} style={{...inp,flex:1}}><option value="">‡∏ô‡∏≤‡∏ó‡∏µ</option>{[0,5,10,15,20,25,30,35,40,45,50,55].map(m=><option key={m} value={String(m).padStart(2,"0")}>{String(m).padStart(2,"0")}‡∏ô‡∏≤‡∏ó‡∏µ</option>)}</select></div>}{knowT===false&&<div style={{display:"flex",flexDirection:"column",gap:4}}>{TS.map(ts=><button key={ts.id} onClick={()=>setTSlot(ts.id)} style={{padding:"10px 12px",borderRadius:8,border:`2px solid ${tSlot===ts.id?"#F59E0B":"#E2E8F0"}`,background:tSlot===ts.id?"#FFFBEB":"#fff",textAlign:"left",cursor:"pointer"}}><div style={{fontSize:12,fontWeight:tSlot===ts.id?700:500,color:tSlot===ts.id?"#92400E":"#374151"}}>{ts.l}</div><div style={{fontSize:10,color:"#94A3B8"}}>{ts.d}</div></button>)}</div>}</div>
  <div style={{marginBottom:14}}><label style={lbl}>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label><select value={prov} onChange={e=>setProv(e.target.value)} style={{...inp,appearance:"auto"}}><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>{PV.map(p=><option key={p} value={p}>{p}</option>)}</select></div>
  <Btn ok={ok} onClick={ok?goQuiz:undefined}>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 36 ‡∏Ç‡πâ‡∏≠ ‚Üí</Btn></Card></div>};

  // ‚îÄ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ‚îÄ
  const Quiz=()=>{const q=ALL_Q[qI];const key=`${q.dim}-${q.qi}`;const pct=((qI+1)/36*100);const allD=Object.keys(ans).length>=36;
  return<div><div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}><span style={{fontSize:12,fontWeight:700,color:"#64748B"}}>{qI+1}/36</span><span style={{fontSize:10,color:"#94A3B8"}}>{q.dim}</span></div><div style={{height:4,background:"#E2E8F0",borderRadius:2,overflow:"hidden",marginBottom:12}}><div style={{height:"100%",width:`${pct}%`,background:"linear-gradient(90deg,#4338CA,#A78BFA)",borderRadius:2,transition:"width .3s"}}/></div><Card><div style={{display:"inline-flex",alignItems:"center",gap:4,padding:"2px 10px",borderRadius:10,background:`${q.c}15`,marginBottom:8,fontSize:10,fontWeight:600,color:q.c}}>{q.icon} {q.dim} ¬∑ {q.pl}</div><p style={{fontSize:14,fontWeight:500,lineHeight:1.7,marginBottom:12,color:"#1E293B"}}>{q.q}</p><div style={{display:"flex",flexDirection:"column",gap:4}}>{SCALE.map((l,i)=><button key={i} onClick={()=>answer(i)} style={{padding:"9px 12px",fontSize:12,fontWeight:ans[key]===i?700:500,border:`2px solid ${ans[key]===i?"#4338CA":"#E2E8F0"}`,borderRadius:8,cursor:"pointer",textAlign:"left",background:ans[key]===i?"#EEF2FF":"#fff",color:ans[key]===i?"#4338CA":"#374151",display:"flex",alignItems:"center",gap:8}}><span style={{width:20,height:20,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:700,background:ans[key]===i?"#4338CA":"#F1F5F9",color:ans[key]===i?"#fff":"#94A3B8",flexShrink:0}}>{i}</span>{l}</button>)}</div></Card><div style={{display:"flex",gap:8,marginTop:8}}><button onClick={()=>setQI(Math.max(0,qI-1))} disabled={qI===0} style={{flex:1,padding:10,border:"2px solid #E2E8F0",borderRadius:8,background:"#fff",fontSize:12,fontWeight:600,cursor:qI>0?"pointer":"not-allowed",color:qI>0?"#374151":"#CBD5E1"}}>‚Üê</button>{allD?<Btn onClick={finish} style={{flex:2}}>‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‚ú¶</Btn>:<button onClick={()=>{if(ans[key]!==undefined&&qI<35)setQI(qI+1)}} style={{flex:2,padding:10,borderRadius:8,border:"none",background:ans[key]!==undefined?"linear-gradient(135deg,#4338CA,#6D28D9)":"#E2E8F0",color:ans[key]!==undefined?"#fff":"#94A3B8",fontSize:12,fontWeight:600,cursor:ans[key]!==undefined?"pointer":"not-allowed"}}>‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>}</div></div>};

  // ‚îÄ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ‚îÄ
  const Sec=({fKey,title,icon,children})=>{const ok=has(fKey);return<Card style={{position:"relative"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:ok?8:4}}><div style={{display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:15}}>{icon}</span><span style={{fontSize:13,fontWeight:700}}>{title}</span></div>{!ok&&<span style={{fontSize:10,fontWeight:700,color:"#6366F1",background:"#EEF2FF",padding:"2px 8px",borderRadius:8}}>üîí</span>}</div>{ok?children:<><p style={{fontSize:11,color:"#94A3B8",marginBottom:6}}>‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π</p><div style={{display:"flex",gap:6}}>{plan==="free"&&<button onClick={()=>tryUpgrade("deep")} style={{flex:1,padding:7,borderRadius:8,border:"2px solid #F59E0B",background:"#FFFBEB",color:"#92400E",fontSize:11,fontWeight:700,cursor:"pointer"}}>Deep ‡∏ø49</button>}{plan!=="all"&&<button onClick={()=>tryUpgrade("all")} style={{flex:1,padding:7,borderRadius:8,border:"none",background:"linear-gradient(135deg,#4338CA,#6D28D9)",color:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"}}>All ‡∏ø99</button>}</div></>}</Card>};

  const Results=()=>{if(!scores)return null;const so=Object.entries(scores).sort((a,b)=>b[1]-a[1]);const c5={"Cognitive Processing":scores["Cognitive Processing"],"Emotional Regulation":scores["Emotional Regulation"],"Identity Stability":scores["Identity Stability"],"Shadow Pattern":scores["Shadow Pattern"],"Growth Orientation":scores["Growth Orientation"]};
  return<div>
  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}><div><div style={{display:"flex",alignItems:"center",gap:6}}><div style={{width:26,height:26,borderRadius:8,background:"linear-gradient(135deg,#4338CA,#6D28D9)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:"#fff"}}>‚ú¶</div><span style={{fontSize:14,fontWeight:800}}>{nick}</span></div><span style={{fontSize:10,color:"#94A3B8"}}>{PLANS[plan].name}{logged?` ¬∑ ${user?.email?.split("@")[0]}`:""}</span></div><div style={{display:"flex",alignItems:"center",gap:4}}>{plan!=="free"&&<span style={{fontSize:10,fontWeight:700,color:"#fff",background:PLANS[plan].c,padding:"3px 10px",borderRadius:8}}>{PLANS[plan].name}</span>}{logged?<button onClick={doLogout} style={{fontSize:10,color:"#94A3B8",background:"none",border:"1px solid #E2E8F0",borderRadius:6,padding:"3px 8px",cursor:"pointer"}}>‡∏≠‡∏≠‡∏Å</button>:<button onClick={()=>{setLoginModal(true);setAuthErr("");setAuthMode("login")}} style={{fontSize:10,color:"#4338CA",background:"#EEF2FF",border:"1px solid #C7D2FE",borderRadius:6,padding:"3px 8px",cursor:"pointer"}}>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>}</div></div>

  {plan==="free"&&<Card style={{background:"linear-gradient(135deg,#EEF2FF,#F5F3FF)",border:"2px solid #6366F1"}}><div style={{fontSize:12,fontWeight:700,color:"#4338CA",marginBottom:6}}>üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</div><div style={{display:"flex",gap:6}}><button onClick={()=>tryUpgrade("deep")} style={{flex:1,padding:7,borderRadius:8,border:"2px solid #F59E0B",background:"#fff",color:"#92400E",fontSize:11,fontWeight:700,cursor:"pointer"}}>Deep ‡∏ø49</button><button onClick={()=>tryUpgrade("all")} style={{flex:1,padding:7,borderRadius:8,border:"none",background:"linear-gradient(135deg,#4338CA,#6D28D9)",color:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"}}>All ‡∏ø99</button></div></Card>}

  <Sec fKey="identity" title="Identity Snapshot" icon="‚ú¶">{ai.identity?<Typer text={ai.identity}/>:aiL.identity?<Spin/>:<Spin t="‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° AI..."/>}</Sec>
  <Sec fKey="core5" title="5 Core Scores" icon="üìä">{Object.entries(c5).map(([d,s])=><div key={d} style={{marginBottom:8}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}><span style={{fontSize:11,fontWeight:600}}>{DM[d]?.icon} {d} <span style={{fontSize:9,color:"#94A3B8"}}>({DM[d]?.pl})</span></span><span style={{fontSize:11,fontWeight:700,color:DM[d]?.c}}>{s.toFixed(1)}</span></div><div style={{height:5,background:"#F1F5F9",borderRadius:3,overflow:"hidden"}}><div style={{height:"100%",width:`${s*10}%`,background:DM[d]?.c,borderRadius:3}}/></div></div>)}<div style={{marginTop:8,padding:8,background:"#F8FAFC",borderRadius:8}}>{aiL.core?<Spin/>:ai.core?<Typer text={ai.core}/>:<Spin t="‡∏£‡∏≠ AI..."/>}</div></Sec>

  {/* Locked preview: 12D */}
  {!has("12d")?<Locked planNeeded="deep" title="12D Spider Web + ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á/‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤" onUpgrade={tryUpgrade}><div style={{textAlign:"center",padding:16}}><Spider scores={scores}/></div><div style={{padding:"8px 0"}}><div style={{fontSize:12,marginBottom:4}}>üí™ ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á: {so.slice(0,3).map(([k,v])=>`${DM[k]?.icon}${k}(${v.toFixed(1)})`).join(" ¬∑ ")}</div><div style={{fontSize:12}}>‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤: {so.slice(-3).map(([k,v])=>`${DM[k]?.icon}${k}(${v.toFixed(1)})`).join(" ¬∑ ")}</div></div></Locked>:<Sec fKey="12d" title="12D Spider Web" icon="üï∏Ô∏è"><div style={{display:"flex",justifyContent:"center",marginBottom:8}}><Spider scores={scores}/></div><div style={{marginBottom:6}}><div style={{fontSize:11,fontWeight:700,color:"#10B981",marginBottom:3}}>üí™ ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á</div>{so.slice(0,4).map(([d,s])=><div key={d} style={{padding:"4px 8px",borderRadius:6,background:"#ECFDF5",border:"1px solid #A7F3D0",marginBottom:2,display:"flex",justifyContent:"space-between",fontSize:11}}><span>{DM[d]?.icon} {d}</span><span style={{fontWeight:700,color:"#059669"}}>{s.toFixed(1)}</span></div>)}</div><div><div style={{fontSize:11,fontWeight:700,color:"#EF4444",marginBottom:3}}>‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤</div>{so.slice(-4).map(([d,s])=><div key={d} style={{padding:"4px 8px",borderRadius:6,background:"#FFF1F2",border:"1px solid #FECDD3",marginBottom:2,display:"flex",justifyContent:"space-between",fontSize:11}}><span>{DM[d]?.icon} {d}</span><span style={{fontWeight:700,color:"#EF4444"}}>{s.toFixed(1)}</span></div>)}</div>{aiL["12d"]?<Spin/>:ai["12d"]?<div style={{marginTop:8,padding:8,background:"#F8FAFC",borderRadius:8}}><Typer text={ai["12d"]}/></div>:null}</Sec>}

  {/* Locked preview: Shadow */}
  {!has("shadow")?<Locked planNeeded="deep" title="Shadow Analysis ‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å" onUpgrade={tryUpgrade}><div style={{padding:12,borderRadius:10,background:"#1E293B",color:"#fff",marginBottom:8}}><div style={{fontSize:13,fontWeight:700,marginBottom:4}}>üåë Shadow Pattern: {scores["Shadow Pattern"]?.toFixed(1)}/10</div><div style={{fontSize:11,color:"#94A3B8"}}>Stress Response: {scores["Stress Response"]?.toFixed(1)} ¬∑ Boundary: {scores["Boundary System"]?.toFixed(1)}</div></div><div style={{fontSize:12,lineHeight:1.8,color:"#374151"}}>‚ö° Trigger ‡∏´‡∏•‡∏±‡∏Å: ‡∏£‡∏≤‡∏´‡∏π‡∏ä‡∏µ‡πâ‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠...<br/>üîÑ Pattern ‡∏ã‡πâ‡∏≥: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠ trigger ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...<br/>üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏ù‡∏∂‡∏Å‡∏à‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢...</div></Locked>:<Sec fKey="shadow" title="Shadow Analysis" icon="üåë"><div style={{padding:10,borderRadius:10,background:"linear-gradient(135deg,#1E293B,#334155)",color:"#fff",marginBottom:6}}><div style={{fontSize:12,fontWeight:700}}>üåë Shadow: {scores["Shadow Pattern"]?.toFixed(1)}/10</div></div>{aiL.shadow?<Spin/>:ai.shadow?<Typer text={ai.shadow}/>:<Spin t="‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏á‡∏≤‡∏°‡∏∑‡∏î..."/>}</Sec>}

  {/* Locked preview: Weekly */}
  {!has("weekly")?<Locked planNeeded="deep" title="Do & Don't ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ" onUpgrade={tryUpgrade}><div style={{marginBottom:8}}><div style={{fontSize:12,fontWeight:700,color:"#10B981",marginBottom:4}}>‚úÖ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥</div><div style={{padding:"6px 10px",borderRadius:6,background:"#ECFDF5",fontSize:11,marginBottom:3}}>‡πÉ‡∏ä‡πâ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏≤‡∏ß‡∏´‡∏ô‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà</div><div style={{padding:"6px 10px",borderRadius:6,background:"#ECFDF5",fontSize:11,marginBottom:3}}>‡∏ù‡∏∂‡∏Å‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á</div></div><div><div style={{fontSize:12,fontWeight:700,color:"#EF4444",marginBottom:4}}>‚ùå ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á</div><div style={{padding:"6px 10px",borderRadius:6,background:"#FFF1F2",fontSize:11,marginBottom:3}}>‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ</div><div style={{padding:"6px 10px",borderRadius:6,background:"#FFF1F2",fontSize:11}}>‡∏≠‡∏¢‡πà‡∏≤‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á</div></div></Locked>:<Sec fKey="weekly" title="Do & Don't ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ" icon="üìã">{aiL.weekly?<Spin/>:ai.weekly&&typeof ai.weekly==="object"?<><div style={{fontSize:11,fontWeight:700,color:"#10B981",marginBottom:3}}>‚úÖ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥</div>{(ai.weekly.do||[]).map((t,i)=><div key={i} style={{padding:"5px 8px",borderRadius:6,background:"#ECFDF5",border:"1px solid #A7F3D0",fontSize:11,marginBottom:2}}>{t}</div>)}<div style={{fontSize:11,fontWeight:700,color:"#EF4444",marginBottom:3,marginTop:6}}>‚ùå ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á</div>{(ai.weekly.dont||[]).map((t,i)=><div key={i} style={{padding:"5px 8px",borderRadius:6,background:"#FFF1F2",border:"1px solid #FECDD3",fontSize:11,marginBottom:2}}>{t}</div>)}</>:<Spin/>}</Sec>}

  {/* Locked preview: Energy */}
  {!has("energy")?<Locked planNeeded="deep" title="7-Day Energy Forecast" onUpgrade={tryUpgrade}><div style={{fontSize:12,fontWeight:700,marginBottom:8}}>üåô ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô 7 ‡∏ß‡∏±‡∏ô ‚Äî Moon + Mars + Day Lord</div>{["‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‚Äî üåü ‡∏™‡∏î‡πÉ‡∏™-‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£ ‚Äî üòä ‡∏™‡∏á‡∏ö‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á","‡∏û‡∏∏‡∏ò ‚Äî üî• ‡∏Å‡∏£‡∏∞‡∏ï‡∏∑‡∏≠‡∏£‡∏∑‡∏≠‡∏£‡πâ‡∏ô","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ ‚Äî üìö ‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏õ‡∏¥‡∏î","‡∏®‡∏∏‡∏Å‡∏£‡πå ‚Äî üíé ‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢","‡πÄ‡∏™‡∏≤‡∏£‡πå ‚Äî ‚öôÔ∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ô‡∏±‡∏¢","‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‚Äî ‚òÄÔ∏è ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á"].map((d,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",padding:"5px 8px",borderRadius:6,background:i%2===0?"#F8FAFC":"#fff",fontSize:11,marginBottom:2}}><span>{d.split("‚Äî")[0]}</span><span style={{fontWeight:700}}>{d.split("‚Äî")[1]}</span></div>)}<div style={{fontSize:10,color:"#6366F1",marginTop:6}}>üîÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å Transit ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå+‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£+‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô Vedic</div></Locked>:<Sec fKey="energy" title="7-Day Energy" icon="üåô">{aiL.energy?<Spin/>:ai.energy&&Array.isArray(ai.energy)?<>{ai.energy.map((d,i)=><div key={i} style={{padding:"8px 10px",borderRadius:8,marginBottom:3,background:i===0?"linear-gradient(135deg,#EEF2FF,#F5F3FF)":"#F8FAFC",border:i===0?"2px solid #6366F1":"1px solid #F1F5F9"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2}}><div style={{display:"flex",alignItems:"center",gap:4}}><span style={{fontSize:12,fontWeight:700}}>{i===0?"üìç ":""}{d.day}</span><span style={{fontSize:9,color:"#94A3B8",background:"#fff",padding:"1px 4px",borderRadius:4}}>{d.date}</span></div></div><div style={{fontSize:12,fontWeight:600,color:"#374151",marginBottom:2}}>{d.mood}</div>{d.transit&&<div style={{fontSize:9,color:"#7C3AED"}}>ü™ê {d.transit}</div>}{d.goodFor&&<div style={{fontSize:10,color:"#059669",background:"#ECFDF5",borderRadius:4,padding:"2px 6px",marginTop:2}}>‚úÖ {d.goodFor}</div>}{d.tip&&<div style={{fontSize:10,color:"#374151",background:"#fff",borderRadius:4,padding:"2px 6px",marginTop:2,border:"1px solid #F1F5F9"}}>üí° {d.tip}</div>}</div>)}<div style={{marginTop:6,padding:8,background:"#F5F3FF",borderRadius:8}}><div style={{fontSize:10,fontWeight:700,color:"#4338CA",marginBottom:2}}>üîÆ Vedic Jyotish 3 ‡∏ä‡∏±‡πâ‡∏ô</div><div style={{fontSize:9,color:"#64748B"}}>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πåTransit(40%) + ‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£(25%) + ‡πÄ‡∏à‡πâ‡∏≤‡∏ß‡∏±‡∏ô(35%)</div></div></>:<Spin/>}</Sec>}

  {/* Locked preview: Job */}
  {!has("job")?<Locked planNeeded="all" title="Job Matching AI" onUpgrade={tryUpgrade}><div style={{fontSize:12,fontWeight:700,marginBottom:8}}>üíº AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏à‡∏≤‡∏Å 12D Profile + Vedic</div>{[{t:"Data Analyst",m:88},{t:"Project Manager",m:82},{t:"UX Researcher",m:78}].map((j,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",padding:"8px 10px",borderRadius:6,background:"#F8FAFC",marginBottom:3,fontSize:12}}><span>{i+1}. {j.t}</span><span style={{fontWeight:700,color:"#4338CA"}}>Match {j.m}%</span></div>)}<div style={{display:"flex",gap:4,marginTop:4}}><div style={{padding:"5px 10px",borderRadius:6,background:"#0A66C2",color:"#fff",fontSize:10,fontWeight:700}}>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô LinkedIn</div></div></Locked>:<Sec fKey="job" title="Job Matching AI" icon="üíº">{aiL.job?<Spin/>:ai.job&&Array.isArray(ai.job)?ai.job.map((j,i)=><div key={i} style={{padding:10,borderRadius:8,background:"#F8FAFC",marginBottom:4}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:2}}><span style={{fontSize:13,fontWeight:700}}>{j.titleTH||j.title}</span><span style={{fontSize:10,fontWeight:700,color:"#4338CA",background:"#EEF2FF",padding:"2px 6px",borderRadius:6}}>{j.match}%</span></div>{j.dims&&<div style={{fontSize:10,color:"#6366F1",marginBottom:2}}>üìä {j.dims}</div>}<div style={{fontSize:11,color:"#64748B",lineHeight:1.5}}>{j.reason}</div><a href={`https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(j.title)}&location=Thailand`} target="_blank" rel="noopener noreferrer" style={{display:"inline-flex",alignItems:"center",gap:4,marginTop:6,padding:"5px 12px",borderRadius:6,background:"#0A66C2",color:"#fff",fontSize:11,fontWeight:700,textDecoration:"none"}}>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢ ‚Äî LinkedIn</a></div>):<Spin/>}</Sec>}

  {/* Life Phase Map (Dasha) */}
  {!has("dasha")?<Locked planNeeded="all" title="Life Phase Map (Dasha)" onUpgrade={tryUpgrade}><div style={{fontSize:12,fontWeight:700,marginBottom:6}}>üó∫ ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‚Äî Vedic Dasha System</div>{["üåÄ ‡πÄ‡∏Å‡∏ï‡∏∏ ‚Äî ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á","üíé ‡∏®‡∏∏‡∏Å‡∏£‡πå ‚Äî ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå","‚òÄÔ∏è ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‚Äî ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏ô","üåô ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‚Äî ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏à‡∏¥‡∏ï‡πÉ‡∏à"].map((d,i)=><div key={i} style={{fontSize:11,padding:"3px 0",color:"#374151"}}>{d}</div>)}<div style={{fontSize:10,color:"#6366F1",marginTop:6}}>üîÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£ + ‡∏°‡∏´‡∏≤‡∏ó‡∏®‡∏≤ Vedic Jyotish</div></Locked>:<Sec fKey="dasha" title="Life Phase Map" icon="üó∫">{(()=>{const phases=calcDasha(bday);const current=phases.find(d=>d.isCurrent);return<>{current&&<Card style={{background:"linear-gradient(135deg,#EEF2FF,#F5F3FF)",border:"2px solid #6366F1"}}><div style={{fontSize:14,fontWeight:800,color:"#4338CA",marginBottom:4}}>{current.icon} ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á: {current.theme}</div><div style={{fontSize:11,color:"#64748B"}}>‡∏°‡∏´‡∏≤‡∏ó‡∏®‡∏≤{current.p} (‡∏≠‡∏≤‡∏¢‡∏∏ {current.startAge}‚Äì{current.endAge} ‡∏õ‡∏µ | ‡∏û.‡∏®.{current.startYear+543}‚Äì{current.endYear+543})</div><div style={{fontSize:12,color:"#374151",marginTop:4}}>{current.desc}</div><div style={{fontSize:11,color:"#059669",marginTop:4,background:"#ECFDF5",padding:"6px 8px",borderRadius:6}}>üéØ ‡πÇ‡∏ü‡∏Å‡∏±‡∏™: {current.focus}</div><div style={{fontSize:11,color:"#374151",marginTop:6,background:"#FFF7ED",padding:"8px",borderRadius:6,lineHeight:1.7}}>{current.cheer}</div><div style={{fontSize:10,color:"#B45309",marginTop:4,background:"#FFFBEB",padding:"6px 8px",borderRadius:6,lineHeight:1.6}}>{current.warn}</div></Card>}<div style={{marginTop:8}}><div style={{fontSize:11,fontWeight:700,color:"#64748B",marginBottom:6}}>Timeline ‡∏ä‡πà‡∏ß‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</div>{phases.filter(d=>!d.isPast||d.isCurrent).slice(0,7).map((d,i)=><div key={i} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",borderRadius:8,marginBottom:2,background:d.isCurrent?"linear-gradient(135deg,#EEF2FF,#F5F3FF)":"#F8FAFC",border:d.isCurrent?"2px solid #6366F1":"1px solid #F1F5F9"}}><span style={{fontSize:16}}>{d.icon}</span><div style={{flex:1}}><div style={{fontSize:11,fontWeight:d.isCurrent?700:500,color:d.isCurrent?"#4338CA":"#374151"}}>{d.p} ‚Äî {d.theme}</div><div style={{fontSize:9,color:"#94A3B8"}}>{d.desc}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:10,fontWeight:600,color:d.isCurrent?"#4338CA":"#64748B"}}>{d.startAge}‚Äì{d.endAge} ‡∏õ‡∏µ</div><div style={{fontSize:9,color:"#94A3B8"}}>{d.startYear+543}‚Äì{d.endYear+543}</div></div></div>)}</div><div style={{marginTop:8,padding:8,background:"#F5F3FF",borderRadius:8}}><div style={{fontSize:10,fontWeight:700,color:"#4338CA",marginBottom:2}}>üîÆ Vedic Dasha System</div><div style={{fontSize:9,color:"#64748B"}}>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡∏Å‡∏©‡∏±‡∏ï‡∏£‡πÄ‡∏Å‡∏¥‡∏î ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡∏°‡πÇ‡∏®‡∏ï‡∏ï‡∏£‡∏µ‡∏ó‡∏®‡∏≤ 120 ‡∏õ‡∏µ ‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏£‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏û‡∏£‡∏∞‡πÄ‡∏ß‡∏ó</div></div></>})()}</Sec>}

  {!has("pdf")?<Locked planNeeded="all" title="PDF Report ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î" onUpgrade={tryUpgrade}><div style={{fontSize:12,lineHeight:1.8}}>üìÑ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:<br/>‚Ä¢ 12 Dimension Scores + Spider Chart<br/>‚Ä¢ Identity + Shadow + 5 Core Analysis<br/>‚Ä¢ Do & Don't + 7-Day Energy + transit<br/>‚Ä¢ Job Matching + Life Phase Map</div></Locked>:<Sec fKey="pdf" title="PDF Report" icon="üìÑ"><Btn onClick={exportPDF} style={{fontSize:12,padding:8}}>üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</Btn></Sec>}

  {!has("share")?<Locked planNeeded="all" title="Social Share Card" onUpgrade={tryUpgrade}><div style={{fontSize:12,lineHeight:1.8}}>üì∏ ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏û 1080√ó1080 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•<br/>‚Ä¢ Spider Chart + ‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á + Shadow Work<br/>‚Ä¢ ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏™‡∏ß‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå IG / FB / LinkedIn</div></Locked>:<Sec fKey="share" title="Social Share Card" icon="üì∏"><div style={{fontSize:11,color:"#64748B",marginBottom:8}}>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î 1080√ó1080 ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ä‡∏£‡πå Instagram, Facebook, LinkedIn</div><Btn onClick={shareProfile} style={{fontSize:12,padding:8,background:"linear-gradient(135deg,#059669,#10B981)"}}>üì∏ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÅ‡∏ä‡∏£‡πå</Btn></Sec>}

  <div style={{textAlign:"center",padding:"14px 0 40px"}}><button onClick={()=>{setSc("landing");setScores(null);setVedic(null);setAns({});setAi({});setQI(0);setPlan("free");localStorage.clear()}} style={{fontSize:11,color:"#94A3B8",background:"none",border:"none",cursor:"pointer"}}>üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button></div></div>};

  return<div style={{fontFamily:"'Noto Sans Thai','DM Sans',-apple-system,sans-serif",minHeight:"100vh",background:"#F8FAFC",color:"#1E293B"}}><style>{css}</style>{loginModalJSX}<div style={{maxWidth:520,margin:"0 auto",padding:sc==="landing"?"0":"12px 16px 40px"}}>{sc==="landing"&&<Landing/>}{sc==="profile"&&<Profile/>}{sc==="quiz"&&<Quiz/>}{sc==="results"&&<Results/>}</div></div>;
}
